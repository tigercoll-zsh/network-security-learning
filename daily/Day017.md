# Day017ï¼šæ“ä½œç³»ç»Ÿä¸è„šæœ¬ - Shell/PowerShell è„šæœ¬å…¥é—¨ä¸æ‰¹å¤„ç†

- æ—¥æœŸï¼š2026-01-10
- å‘¨æ¬¡ï¼šç¬¬ 3 å‘¨

## å­¦ä¹ ç›®æ ‡

å­¦å®Œä»Šå¤©ä½ åº”è¯¥èƒ½åšåˆ°ï¼š

- ç”¨ä¸€å¥è¯è§£é‡Šï¼š**ç®¡é“**ã€**é‡å®šå‘**ã€**å˜é‡**ã€**å¾ªç¯**åˆ†åˆ«æ˜¯å¹²å˜›çš„
- å†™ä¸€ä¸ªâ€œèƒ½é‡å¤è·‘â€çš„æ—¥å¿—æ•´ç†è„šæœ¬ï¼ˆPowerShell ç‰ˆï¼ŒWindows ç›´æ¥å¯ç”¨ï¼‰
- æŠŠç»“æœè¾“å‡ºæˆ CSVï¼ˆåé¢ Day019/Day020 åšæšä¸¾æ—¶ç›´æ¥èƒ½å¤ç”¨ï¼‰
- æŒæ¡ PowerShell çš„å¯¹è±¡ç®¡é“ã€æ¡ä»¶åˆ¤æ–­ã€å¾ªç¯ã€å‡½æ•°ã€é”™è¯¯å¤„ç†
- èƒ½ç‹¬ç«‹å®Œæˆæ—¥å¿—æ‰¹é‡å¤„ç†ã€æ•°æ®ç»Ÿè®¡ã€å¯¼å‡ºç­‰è‡ªåŠ¨åŒ–ä»»åŠ¡

---

## ä¸€ã€PowerShell åŸºç¡€è¯­æ³•ä¸å¯¹è±¡ç®¡é“

### 1.1 ä»€ä¹ˆæ˜¯ PowerShellï¼Ÿ

- Windows è‡ªå¸¦çš„å‘½ä»¤è¡Œè‡ªåŠ¨åŒ–å·¥å…·ï¼Œæ”¯æŒâ€œå¯¹è±¡ç®¡é“â€ï¼Œæ¯”ä¼ ç»Ÿ cmd å¼ºå¤§å¾ˆå¤š
- è¯­æ³•ç±»ä¼¼ C#/Pythonï¼Œæ”¯æŒå˜é‡ã€å‡½æ•°ã€æ¡ä»¶ã€å¾ªç¯ã€æ¨¡å—
- é€‚åˆåšæ‰¹é‡è¿ç»´ã€æ—¥å¿—åˆ†æã€è‡ªåŠ¨åŒ–è„šæœ¬

### 1.2 ç®¡é“ä¸é‡å®šå‘çš„åŒºåˆ«

| æ¦‚å¿µ | ä½œç”¨ | ç¤ºä¾‹ | ç»“æœ |
|------|------|------|------|
| ç®¡é“ `|` | æŠŠå‰ä¸€å‘½ä»¤çš„â€œå¯¹è±¡â€ä¼ ç»™åä¸€å‘½ä»¤ | `Get-Process | Where-Object {$_.CPU -gt 10}` | åªä¿ç•™ CPU>10 çš„è¿›ç¨‹ |
| é‡å®šå‘ `>` | æŠŠè¾“å‡ºå†™åˆ°æ–‡ä»¶ | `Get-Process > procs.txt` | æ–‡ä»¶é‡Œæ˜¯çº¯æ–‡æœ¬ |
| è¿½åŠ  `>>` | è¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾ | `echo hello >> log.txt` | æ–‡ä»¶å†…å®¹ä¸ä¼šè¢«è¦†ç›– |

### 1.3 PowerShell ä¸ Bash æœ€å¤§å·®å¼‚

- PowerShell ç®¡é“ä¼ é€’çš„æ˜¯â€œå¯¹è±¡â€ï¼Œä¸æ˜¯çº¯æ–‡æœ¬
- å¯ä»¥ç›´æ¥ç”¨ `Select-Object`ã€`Where-Object`ã€`Group-Object` ç­‰å‘½ä»¤å¤„ç†ç»“æ„åŒ–æ•°æ®

### 1.4 å˜é‡ã€ç±»å‹ä¸åŸºæœ¬è¿ç®—

```powershell
# å˜é‡å®šä¹‰
$name = "Alice"
$age = 20

# å­—ç¬¦ä¸²æ‹¼æ¥
Write-Output "å§“åï¼š$nameï¼Œå¹´é¾„ï¼š$age"

# æ•°ç»„
$nums = 1,2,3,4,5

# å“ˆå¸Œè¡¨
$dict = @{user="bob"; role="admin"}
Write-Output $dict["user"]
```

### 1.5 æ¡ä»¶åˆ¤æ–­ä¸å¾ªç¯

```powershell
# if-else
if ($age -ge 18) {
    Write-Output "æˆå¹´äºº"
} else {
    Write-Output "æœªæˆå¹´äºº"
}

# for å¾ªç¯
for ($i=0; $i -lt 5; $i++) {
    Write-Output $i
}

# foreach
foreach ($n in $nums) {
    Write-Output $n
}
```

### 1.6 å‡½æ•°ä¸æ¨¡å—

```powershell
function Add-Two {
    param($a, $b)
    return $a + $b
}

$result = Add-Two 3 5
Write-Output $result
```

---

## äºŒã€æ—¥å¿—è§£æä¸æ‰¹é‡å¤„ç†å®æˆ˜

### 2.1 ç”Ÿæˆç»ƒä¹ æ—¥å¿—æ–‡ä»¶

```powershell
# ç”Ÿæˆ 1000 è¡Œå‡æ—¥å¿—
1..1000 | ForEach-Object {
    $user = ("alice","bob","charlie","dave" | Get-Random)
    $action = ("login","logout","fail","download","upload" | Get-Random)
    $time = (Get-Date).AddMinutes(-$_)
    "$($time.ToString("yyyy-MM-dd HH:mm:ss")), $user, $action"
} | Set-Content .\demo.log
```

### 2.2 è¯»å–æ—¥å¿—å¹¶ç»Ÿè®¡æ¯ä¸ªç”¨æˆ·çš„æ“ä½œæ¬¡æ•°

```powershell
# è¯»å–æ—¥å¿—
$lines = Get-Content .\demo.log

# ç»Ÿè®¡æ¯ä¸ªç”¨æˆ·çš„æ“ä½œæ¬¡æ•°
$stats = @{}
foreach ($line in $lines) {
    $parts = $line -split ", "
    $user = $parts[1]
    if ($stats.ContainsKey($user)) {
        $stats[$user]++
    } else {
        $stats[$user] = 1
    }
}
$stats
```

### 2.3 ç”¨ç®¡é“å’Œ Group-Object å®ç°åŒæ ·åŠŸèƒ½

```powershell
Get-Content .\demo.log |
    ForEach-Object {
        ($_ -split ", ")[1]
    } |
    Group-Object | Sort-Object Count -Descending | Format-Table Name,Count
```

### 2.4 å¯¼å‡ºç»Ÿè®¡ç»“æœä¸º CSV

```powershell
Get-Content .\demo.log |
    ForEach-Object {
        $p = $_ -split ", "
        [PSCustomObject]@{User=$p[1]; Action=$p[2]}
    } |
    Group-Object User | 
    Select-Object Name, @{n="Count";e={$_.Count}} |
    Export-Csv -Path .\user_stats.csv -NoTypeInformation
```

---

## ä¸‰ã€è¿›é˜¶ï¼šé”™è¯¯å¤„ç†ã€æ­£åˆ™ã€æ‰¹é‡æ–‡ä»¶å¤„ç†

### 3.1 é”™è¯¯å¤„ç†ï¼ˆtry/catch/finallyï¼‰

```powershell
try {
    # å¯èƒ½å‡ºé”™çš„ä»£ç 
    $content = Get-Content .\not_exist.log -ErrorAction Stop
} catch {
    Write-Output "æ–‡ä»¶ä¸å­˜åœ¨ï¼"
} finally {
    Write-Output "è„šæœ¬æ‰§è¡Œå®Œæ¯•"
}
```

### 3.2 æ­£åˆ™è¡¨è¾¾å¼æå–æ—¥å¿—å­—æ®µ

```powershell
# å‡è®¾æ—¥å¿—æ ¼å¼ï¼š2026-01-01 12:00:00, alice, login
$line = "2026-01-01 12:00:00, alice, login"
if ($line -match "(?<time>\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}), (?<user>\w+), (?<action>\w+)") {
    $matches["time"]  # 2026-01-01 12:00:00
    $matches["user"]  # alice
    $matches["action"] # login
}
```

### 3.3 æ‰¹é‡å¤„ç†å¤šä¸ªæ—¥å¿—æ–‡ä»¶

```powershell
# å‡è®¾æœ‰ log1.txt, log2.txt ...
Get-ChildItem . -Filter "log*.txt" | ForEach-Object {
    $file = $_.FullName
    $lines = Get-Content $file
    # ...å¯¹æ¯ä¸ªæ–‡ä»¶åšç»Ÿè®¡
}
```

---

## å››ã€å®æˆ˜ä»»åŠ¡ï¼ˆå«å®Œæ•´ä»£ç ä¸ç­”æ¡ˆï¼‰

### ä»»åŠ¡ 1ï¼šç”Ÿæˆ 1000 è¡Œå‡æ—¥å¿—æ–‡ä»¶

**ç›®æ ‡**ï¼šæŒæ¡ ForEach-Objectã€éšæœºæ•°ã€æ—¥æœŸæ ¼å¼åŒ–

```powershell
1..1000 | ForEach-Object {
    $user = ("alice","bob","charlie","dave" | Get-Random)
    $action = ("login","logout","fail","download","upload" | Get-Random)
    $time = (Get-Date).AddMinutes(-$_)
    "$($time.ToString("yyyy-MM-dd HH:mm:ss")), $user, $action"
} | Set-Content .\demo.log
```

### ä»»åŠ¡ 2ï¼šç»Ÿè®¡æ¯ä¸ªç”¨æˆ·çš„æ“ä½œæ¬¡æ•°

**ç›®æ ‡**ï¼šæŒæ¡ç®¡é“ã€Group-Objectã€Format-Table

```powershell
Get-Content .\demo.log |
    ForEach-Object {
        ($_ -split ", ")[1]
    } |
    Group-Object | Sort-Object Count -Descending | Format-Table Name,Count
```

### ä»»åŠ¡ 3ï¼šç»Ÿè®¡æ¯ç§æ“ä½œç±»å‹çš„æ¬¡æ•°

```powershell
Get-Content .\demo.log |
    ForEach-Object {
        ($_ -split ", ")[2]
    } |
    Group-Object | Sort-Object Count -Descending | Format-Table Name,Count
```

### ä»»åŠ¡ 4ï¼šå¯¼å‡ºæ‰€æœ‰â€œfailâ€æ“ä½œçš„æ—¥å¿—åˆ° fail.csv

```powershell
Get-Content .\demo.log |
    Where-Object {$_ -like "*, fail"} |
    ForEach-Object {
        $p = $_ -split ", "
        [PSCustomObject]@{Time=$p[0]; User=$p[1]; Action=$p[2]}
    } |
    Export-Csv -Path .\fail.csv -NoTypeInformation
```

### ä»»åŠ¡ 5ï¼šå†™ä¸€ä¸ªå‡½æ•°ï¼Œç»Ÿè®¡æŒ‡å®šç”¨æˆ·çš„æ‰€æœ‰æ“ä½œ

```powershell
function Get-UserActions {
    param($username)
    Get-Content .\demo.log |
        Where-Object {$_ -like "*, $username,*"}
}

# ç”¨æ³•
Get-UserActions -username "alice"
```

---

## äº”ã€å·©å›ºç»ƒä¹ ä¸è¯„ä¼°æ ‡å‡†

### å·©å›ºç»ƒä¹ 

1. ç”¨ PowerShell å†™ä¸€ä¸ªè„šæœ¬ï¼Œç»Ÿè®¡æ¯å°æ—¶çš„ç™»å½•æ¬¡æ•°ï¼ˆæŒ‰æ—¶é—´åˆ†ç»„ï¼‰
2. å†™ä¸€ä¸ªè„šæœ¬ï¼Œæ‰¾å‡º 1 å°æ—¶å†…æ“ä½œæ¬¡æ•°æœ€å¤šçš„ç”¨æˆ·
3. ç”¨æ­£åˆ™æå–æ‰€æœ‰â€œfailâ€æ“ä½œçš„æ—¶é—´å’Œç”¨æˆ·å
4. å†™ä¸€ä¸ªå‡½æ•°ï¼Œæ‰¹é‡å¤„ç†å¤šä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œç»Ÿè®¡æ€»çš„â€œfailâ€æ¬¡æ•°
5. ç”¨ try/catch åŒ…è£¹æ–‡ä»¶è¯»å–ï¼Œé‡åˆ°ä¸å­˜åœ¨çš„æ–‡ä»¶è¾“å‡ºâ€œæ–‡ä»¶ç¼ºå¤±â€

### è¯„ä¼°æ ‡å‡†

- âœ… èƒ½ç”¨ç®¡é“å’Œ Group-Object åšåˆ†ç»„ç»Ÿè®¡
- âœ… èƒ½ç”¨ Export-Csv å¯¼å‡ºç»“æœ
- âœ… èƒ½å†™å‡ºå¸¦å‚æ•°çš„å‡½æ•°
- âœ… èƒ½ç”¨ try/catch åšé”™è¯¯å¤„ç†
- âœ… èƒ½ç”¨æ­£åˆ™æå–æ—¥å¿—å­—æ®µ

---

## å…­ã€å‚è€ƒèµ„æ–™ä¸è¿›é˜¶é˜…è¯»

- [å¾®è½¯å®˜æ–¹ PowerShell æ–‡æ¡£](https://docs.microsoft.com/zh-cn/powershell/)
- [PowerShell Gallery è„šæœ¬åº“](https://www.powershellgallery.com/)
- [PowerShell æ­£åˆ™è¡¨è¾¾å¼æ•™ç¨‹](https://docs.microsoft.com/zh-cn/powershell/scripting/learn/deep-dives/everything-about-regular-expressions)
- [PowerShell ç®¡é“ä¸å¯¹è±¡è¯¦è§£](https://docs.microsoft.com/zh-cn/powershell/scripting/learn/deep-dives/everything-about-pipelines)

---

## ä¸ƒã€å­¦ä¹ æˆæœè¾¾æˆæƒ…å†µï¼ˆç”±å­¦ä¹ è€…å¡«å†™ï¼‰

- [ ] demo.log ç”Ÿæˆæˆªå›¾
- [ ] ç»Ÿè®¡ç»“æœè¾“å‡ºæˆªå›¾
- [ ] fail.csv å¯¼å‡ºæˆªå›¾
- [ ] è‡ªå·±å†™çš„å‡½æ•°ä»£ç 
- [ ] é”™è¯¯å¤„ç†è„šæœ¬æˆªå›¾

---

**æ­å–œï¼ä½ å·²æŒæ¡ PowerShell è„šæœ¬çš„æ ¸å¿ƒæŠ€èƒ½ã€‚æ˜å¤©æˆ‘ä»¬å°†å­¦ä¹  Python è„šæœ¬ï¼Œè¿›ä¸€æ­¥æå‡è‡ªåŠ¨åŒ–ä¸æ•°æ®å¤„ç†èƒ½åŠ›ï¼** ğŸ‰
