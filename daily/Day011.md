---
title: Day011：侦察 - Nmap 端口扫描
tags:
  - 网络安全
  - Nmap
  - 端口扫描
categories:
  - 90天安全突击
stage: 筑基
abbrlink: d011
date: 2026-02-02
updated: 2026-01-28
---

# Day011：侦察 - Nmap 端口扫描

## 基本信息

| 项目 | 内容 |
|------|------|
| **所属阶段** | 筑基（第一阶段） |
| **所属周次** | Week 2：侦察——信息收集 |
| **今日主题** | 使用 Nmap 扫描目标端口和服务 |
| **预计时间** | 2-3 小时 |
| **难度等级** | 进阶 |

---

## 今日痛点场景

> **场景**：你发现了一台存活主机 192.168.56.102，但不知道上面跑了什么服务。
>
> **问题**：怎么知道目标开了哪些端口？跑的是什么服务？
>
> **今天的任务**：用 Nmap 扫描 Metasploitable2 的端口，找出所有开放的服务。

---

## 今日目标

- [ ] 理解 TCP 三次握手与端口扫描原理
- [ ] 掌握 SYN 扫描和全连接扫描
- [ ] 使用服务版本探测
- [ ] 识别常见端口对应的服务

**闯关条件**：扫描出 Metasploitable2 的 10 个以上开放端口，并识别服务版本。

---

## 实战任务（先动手！）

### 任务 1：快速端口扫描（15 分钟）

**扫描常用端口**：
```bash
nmap 192.168.56.102
```

默认扫描 1000 个最常见的端口。

**扫描全部端口**（65535 个）：
```bash
nmap -p- 192.168.56.102
```

**扫描指定端口**：
```bash
nmap -p 22,80,443 192.168.56.102
nmap -p 1-1000 192.168.56.102
```

---

### 任务 2：SYN 扫描（隐蔽扫描）（20 分钟）

**SYN 扫描**（默认，需要 root）：
```bash
sudo nmap -sS 192.168.56.102
```

**原理**：
- 发送 SYN 包
- 收到 SYN+ACK = 端口开放
- 收到 RST = 端口关闭
- 不完成三次握手，更隐蔽

**全连接扫描**（不需要 root）：
```bash
nmap -sT 192.168.56.102
```

**对比**：
| 扫描类型 | 需要 root | 隐蔽性 | 速度 |
|----------|-----------|--------|------|
| SYN (-sS) | 是 | 高 | 快 |
| 全连接 (-sT) | 否 | 低 | 慢 |

---

### 任务 3：服务版本探测（20 分钟）

**识别服务版本**：
```bash
nmap -sV 192.168.56.102
```

**示例输出**：
```
PORT     STATE SERVICE     VERSION
21/tcp   open  ftp         vsftpd 2.3.4
22/tcp   open  ssh         OpenSSH 4.7p1
80/tcp   open  http        Apache httpd 2.2.8
```

**更激进的版本探测**：
```bash
nmap -sV --version-intensity 5 192.168.56.102
```

---

### 任务 4：操作系统识别（15 分钟）

**探测操作系统**：
```bash
sudo nmap -O 192.168.56.102
```

**综合扫描**（版本 + 操作系统 + 脚本）：
```bash
sudo nmap -A 192.168.56.102
```

`-A` = `-sV -O -sC --traceroute`

---

### 任务 5：实战 - 完整扫描 Metasploitable2（20 分钟）

执行完整扫描并保存结果：

```bash
sudo nmap -sS -sV -O -p- -T4 192.168.56.102 -oN full_scan.txt
```

**分析结果**：
- 有多少端口开放？
- 有哪些高危服务？
- 有没有已知漏洞的版本？

---

## 今日闯关检查

| 检查项 | 状态 |
|--------|------|
| 理解 SYN 扫描原理 | |
| 能执行服务版本探测 | |
| 发现 10+ 开放端口 | |
| 识别出服务版本 | |
| 保存了扫描结果 | |

---

## 底层补课

### TCP 三次握手

```
客户端                服务器
  │── SYN ──────────→│  1. 客户端发起连接
  │                  │
  │←── SYN+ACK ──────│  2. 服务器确认
  │                  │
  │── ACK ──────────→│  3. 客户端确认，连接建立
```

**SYN 扫描**只完成前两步，不发最后的 ACK。

### 端口状态

| 状态 | 含义 |
|------|------|
| open | 端口开放，有服务监听 |
| closed | 端口关闭，没有服务 |
| filtered | 被防火墙过滤 |
| unfiltered | 无法确定（ACK 扫描） |
| open\|filtered | 不确定是开放还是过滤 |

### 常见端口速查

| 端口 | 服务 | 说明 |
|------|------|------|
| 21 | FTP | 文件传输 |
| 22 | SSH | 安全远程登录 |
| 23 | Telnet | 不安全远程登录 |
| 25 | SMTP | 邮件发送 |
| 53 | DNS | 域名解析 |
| 80 | HTTP | 网页 |
| 443 | HTTPS | 加密网页 |
| 3306 | MySQL | 数据库 |
| 3389 | RDP | Windows 远程桌面 |

---

## 避坑指南

| 坑点 | 症状 | 解决方案 |
|------|------|----------|
| 扫描太慢 | 卡住 | 用 -T4 或 -T5 |
| 权限不足 | SYN scan requires root | 加 sudo |
| 端口全 filtered | 看不到结果 | 目标有防火墙，换扫描方式 |
| 版本识别失败 | VERSION unknown | 加 --version-all |

---

## 知识卡片速查

### Nmap 端口扫描速查

```bash
# 快速扫描（常用端口）
nmap 192.168.56.102

# 全端口扫描
nmap -p- 192.168.56.102

# SYN 扫描（隐蔽）
sudo nmap -sS 192.168.56.102

# 版本探测
nmap -sV 192.168.56.102

# 操作系统探测
sudo nmap -O 192.168.56.102

# 综合扫描
sudo nmap -A 192.168.56.102

# 加速扫描
nmap -T4 192.168.56.102

# UDP 扫描
sudo nmap -sU 192.168.56.102

# 保存结果
nmap -oN result.txt 192.168.56.102
```

### 扫描速度

| 参数 | 速度 | 用途 |
|------|------|------|
| -T0 | 极慢 | IDS 绕过 |
| -T1 | 很慢 | IDS 绕过 |
| -T2 | 慢 | 低带宽 |
| -T3 | 正常 | 默认 |
| -T4 | 快 | 常用 |
| -T5 | 极快 | 不推荐 |

---

## 常见问题

**Q1：SYN 扫描为什么更隐蔽？**

A1：因为不完成完整的 TCP 连接，很多服务不会记录日志。但现代 IDS 还是能检测到。

**Q2：UDP 扫描为什么这么慢？**

A2：UDP 是无连接协议，没有 SYN/ACK 机制。判断端口是否开放需要等超时，很慢。

**Q3：怎么知道哪些服务有漏洞？**

A3：这就是明天的内容——漏洞初判。先收集版本信息，再查漏洞库。

---

## 明日预告

**Day 012：侦察 - 漏洞初判**

明天你将：
- 学习根据版本信息查找漏洞
- 使用 Nmap NSE 脚本检测漏洞
- 了解 CVE 漏洞数据库

---

## 学习记录

| 项目 | 内容 |
|------|------|
| 实际学习日期 | |
| 今日收获 | |

---

> **导师点评**：
>
> 今天你学会了扫端口——渗透测试最核心的技能之一。
>
> 端口就是服务，服务就是攻击面。知道目标跑了什么，才能找对应的漏洞。
>
> Metasploitable2 开了一堆端口，每个都是练习的机会。
>
> 记住：**端口扫描是侦察阶段的核心**。

```bash
echo "Day 011 Complete! 我会用 Nmap 扫端口了！"
```
