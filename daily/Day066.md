---
title: Day066：内网渗透 - 横向移动概述与信息收集
tags:
  - 网络安全
  - 渗透测试
  - 内网渗透
categories:
  - 90天安全突击
stage: 实战演练
abbrlink: 930bc
date: 2026-01-28
updated: 2026-01-28
---

# Day066：内网渗透 - 横向移动概述与信息收集

## 📋 基本信息

| 项目 | 内容 |
|------|------|
| **所属阶段** | 🏆 实战演练（第三阶段） |
| **所属周次** | Week 11-12：内网渗透基础 |
| **今日主题** | 横向移动概述与信息收集 |
| **预计时间** | 3-4 小时 |
| **难度等级** | ⭐⭐⭐⭐ 中高级 |

---

## 🔥 今日痛点场景

> **场景**：你通过 Web 漏洞拿到了一台 Windows 服务器的权限，但这只是一台普通员工的机器。你想知道：这个网络里还有什么？域控在哪？管理员的机器是哪台？
>
> **问题**：如何快速摸清内网的「家底」？
>
> **今天的任务**：掌握内网信息收集技术，为横向移动做准备。

---

## 🎯 今日目标

完成今天的学习后，你应该能够：

- [ ] 理解横向移动的概念和常见技术
- [ ] 判断当前机器是否在域环境中
- [ ] 收集域内用户、计算机、共享等信息
- [ ] 识别高价值目标（域控、管理员机器）

**闯关条件**：成功收集到域控 IP、域管理员账户列表。

---

## ⚔️ 实战任务（先动手！）

### 任务 1：判断域环境（15 分钟）

**在已控制的 Windows 机器上执行**：

```cmd
:: 查看当前用户和域
whoami
echo %USERDOMAIN%
echo %LOGONSERVER%

:: 查看域信息
net config workstation

:: 查看域控制器
nltest /dclist:%USERDOMAIN%

:: 如果输出包含域名和域控，说明在域环境中
```

**预期结果**：确认是否在域环境，获取域名和域控信息。

---

### 任务 2：域内用户和组枚举（30 分钟）

```cmd
:: 列出域用户
net user /domain

:: 查看域管理员组成员
net group "Domain Admins" /domain

:: 查看企业管理员
net group "Enterprise Admins" /domain

:: 查看域控制器组
net group "Domain Controllers" /domain

:: 详细查看某个用户
net user administrator /domain
```

**预期结果**：获取域管理员列表和关键用户信息。

---

### 任务 3：域内计算机枚举（20 分钟）

```cmd
:: 列出域内计算机
net group "Domain Computers" /domain

:: 使用 PowerShell 获取更多信息
powershell -c "Get-ADComputer -Filter * | Select Name,DNSHostName,OperatingSystem"

:: 查看共享资源
net view /domain

:: 查看特定机器的共享
net view \\dc01
```

---

### 任务 4：使用工具自动化信息收集（40 分钟）

**方法 1：BloodHound + SharpHound**

```powershell
# 运行 SharpHound 收集数据
.\SharpHound.exe -c All

# 生成 zip 文件，导入 BloodHound 分析
# 在 Kali 上启动 BloodHound
neo4j console &
bloodhound &
```

**方法 2：PowerView**

```powershell
# 加载 PowerView
Import-Module .\PowerView.ps1

# 获取域信息
Get-Domain
Get-DomainController

# 获取域用户
Get-DomainUser | Select samaccountname

# 查找域管理员
Get-DomainGroupMember "Domain Admins"

# 查找用户会话（谁登录了哪台机器）
Find-DomainUserLocation
```

---

### 任务 5：网络扫描与服务发现（30 分钟）

```bash
# 通过代理扫描内网（在 Kali 上）
proxychains4 nmap -sT -Pn 10.0.0.0/24 -p 22,80,135,139,445,3389

# 识别关键服务
# 88: Kerberos (域控)
# 389: LDAP (域控)
# 445: SMB
# 3389: RDP
# 5985: WinRM
```

---

## ✅ 今日闯关检查

| 检查项 | 状态 |
|--------|------|
| 确认域环境存在 | ⬜ |
| 获取域控制器 IP/名称 | ⬜ |
| 枚举域管理员账户 | ⬜ |
| 枚举域内计算机 | ⬜ |
| 识别高价值目标 | ⬜ |

---

## 📖 底层补课（做完实验再看）

### 什么是横向移动？

```
初始访问 → 信息收集 → 横向移动 → 权限提升 → 域控
     ↓
   当前机器      →      其他机器      →     核心目标
```

横向移动是指在内网中从一台机器「跳」到另一台机器，最终目标通常是域控。

### 域环境核心概念

| 概念 | 说明 |
|------|------|
| **域 (Domain)** | Windows 集中管理的网络 |
| **域控 (DC)** | 存储所有账户信息的服务器 |
| **域管理员** | 域内最高权限用户 |
| **域用户** | 可以登录域内任意机器的用户 |

### 高价值目标识别

| 目标 | 特征 | 价值 |
|------|------|------|
| 域控 | 开放 88/389/636 | 控制整个域 |
| 管理员机器 | 域管登录过 | 可能有 hash |
| 文件服务器 | 大量共享 | 敏感数据 |
| 邮件服务器 | 25/110/143 | 通讯记录 |

---

## ⚠️ 避坑指南

| 坑点 | 症状 | 解决方案 |
|------|------|----------|
| net 命令被禁 | 拒绝访问 | 使用 PowerShell 或 WMI |
| PowerShell 被限制 | 无法执行 | 绕过执行策略或用 C# 工具 |
| 网络隔离 | 扫描超时 | 检查是否需要额外代理 |
| 权限不足 | 枚举失败 | 需要域用户权限 |

---

## 💡 知识卡片速查

### 信息收集命令速查

| 目的 | 命令 |
|------|------|
| 当前用户 | `whoami /all` |
| 域名 | `echo %USERDOMAIN%` |
| 域控 | `nltest /dclist:domain` |
| 域用户 | `net user /domain` |
| 域管 | `net group "Domain Admins" /domain` |
| 计算机 | `net group "Domain Computers" /domain` |

### 常用工具

| 工具 | 用途 |
|------|------|
| **BloodHound** | 域关系可视化分析 |
| **PowerView** | 域枚举 PowerShell 脚本 |
| **SharpHound** | BloodHound 数据收集器 |
| **ADExplorer** | 图形化 AD 浏览 |
| **PingCastle** | AD 安全评估 |

---

## ❓ 常见问题

**Q1：不在域环境怎么办？**

A1：工作组环境下目标有限，主要收集本地账户信息和网络共享，尝试密码重用攻击。

**Q2：BloodHound 图太复杂看不懂？**

A2：使用内置查询，比如「最短路径到域管」「域管登录过的机器」。

**Q3：收集的信息怎么整理？**

A3：建议用表格记录：IP、主机名、操作系统、开放端口、登录用户、备注。

---

## 🚀 明日预告

**Day 067：内网渗透 - Pass the Hash 攻击**

明天你将：
- 理解 NTLM 认证和 Hash 原理
- 使用 Mimikatz 抓取 Hash
- 执行 Pass the Hash 横向移动

---

## 📊 学习记录（学习者填写）

| 项目 | 内容 |
|------|------|
| 实际学习日期 | ____年__月__日 |
| 实际用时 | ____ 小时 |
| 遇到的问题 | |
| 解决方法 | |
| 今日收获 | |
| 自评分数 | ⭐⭐⭐⭐⭐ (1-5星) |

---

> 💬 **导师点评**：
>
> 信息收集是横向移动的基础。没有情报，你就是个瞎子。
>
> 域环境是企业网络的标配，拿下域控 = 拿下整个公司。
>
> BloodHound 是神器，学会它能让你事半功倍。但别忘了基础命令，工具不一定能用。

```bash
echo "Day 066 Complete! 内网信息收集掌握！"
```
