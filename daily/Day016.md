# Day016：操作系统与脚本 - Windows 安全基础（傻瓜版能照做）

- 日期：2026-01-09
- 周次：第 3 周

## 学习目标

学完今天你应该能做到：

- 能说清 Windows 的“权限三件套”：**用户/组**、**UAC**、**本地安全策略**
- 会用 3 个入口做安全排查：
  - 事件查看器（安全日志）
  - 防火墙（入站规则）
  - 本地用户与组（谁能登、谁是管理员）
- 能导出一份“登录事件证据”（截图或导出结果）

## 学习内容

### 1️⃣ 你要用 Windows 做安全，不需要装一堆工具

先把系统自带的 3 个工具用熟：

- `eventvwr.msc`：事件查看器（证据）
- `wf.msc`：Windows Defender 防火墙（攻击面）
- `lusrmgr.msc`：本地用户和组（权限）

### 2️⃣ Windows 常见攻击面：你先做到“最小暴露”

- RDP（3389）：不要对公网裸开
- SMB（445）：不要对公网裸开
- WinRM（5985/5986）：只在内网/管理网使用

### 3️⃣ 事件日志：你要知道看什么

你先记住 3 个常见事件 ID（够用版）：

- **4624**：登录成功
- **4625**：登录失败（爆破线索）
- **4672**：分配了特殊权限（常见于管理员登录）

## 实践任务（合法授权范围内）

> 今天全程本机操作，不涉及攻击；是“主机自查”。

### 任务 1（必做）：列出本机用户/管理员组成员

```powershell
# 列出本机用户
Get-LocalUser | Select-Object Name, Enabled, LastLogon

# 列出 Administrators 组成员
Get-LocalGroupMember -Group "Administrators" | Select-Object Name, ObjectClass
```

你要写一句结论：

- 管理员组里有没有“你不认识”的账号？（如果是公司电脑，可能会有管理账号，别乱删，只做记录）

### 任务 2（必做）：导出最近 20 条登录失败（4625）证据

```powershell
Get-WinEvent -FilterHashtable @{LogName='Security'; Id=4625} -MaxEvents 20 |
	Select-Object TimeCreated, Id, Message |
	Format-List
```

如果你机器上没有 4625（很正常），就改看 4624：

```powershell
Get-WinEvent -FilterHashtable @{LogName='Security'; Id=4624} -MaxEvents 20 |
	Select-Object TimeCreated, Id, Message |
	Format-List
```

> 提醒：`Message` 很长，公开到 GitHub 前要打码（用户名/主机名/IP）。

### 任务 3（必做）：检查防火墙入站规则里“暴露的服务”

先列出启用的入站规则（只看 Enabled=True）：

```powershell
Get-NetFirewallRule -Direction Inbound -Enabled True |
	Select-Object DisplayName, Profile, Action |
	Sort-Object DisplayName
```

你不用看完所有，重点找：

- 远程桌面（Remote Desktop）
- 文件和打印共享（File and Printer Sharing）
- 任何你不认识但“允许(Allow)”的规则

### 任务 4（可选）：快速盘点监听端口（攻击面）

```powershell
Get-NetTCPConnection -State Listen |
	Select-Object LocalAddress, LocalPort, OwningProcess |
	Sort-Object LocalPort
```

## 巩固练习（题与复盘）

### 题 1：为什么不建议启用匿名共享？

**思路**：匿名=不鉴权 → 权限边界没了 → 容易泄露/被横向。

### 题 2：列出 5 条 Windows 主机加固项并说明原因

**思路**：账号、补丁、防火墙、远程服务、日志审计。

## 评估标准（达成判定）

- 你能列出管理员组成员并解释“谁应该在里面”
- 你能导出 4624/4625 某一类事件做证据
- 你能指出 1–2 条“可能不该对外暴露”的入站服务/端口
- 你写出 Windows 加固清单（5 条以上）

## 学习成果达成情况（由学习者填写）

### 截图与证据

- [ ] `Get-LocalGroupMember Administrators` 输出截图
- [ ] 4624/4625 事件输出截图（打码）
- [ ] 入站规则/监听端口输出截图（可选）

### 关键命令与输出

- 管理员组成员：
- 登录事件（4624/4625）关键行：
- 入站规则观察到的“可疑/不需要”项：

### 结论与反思

- 我今天确认到的 1 个事实证据：
- 我需要立刻改的 1 个设置（如果是自用电脑）：
- 我不确定但要查的 1 件事：

## 集中参考答案（含思路）

### 题 1 参考答案

- 匿名共享意味着不经过身份认证就能访问共享资源，容易造成信息泄露。
- 在内网也可能被利用做横向移动、传播恶意软件。

### 题 2 参考答案（示例 5 条）

1. 开启系统自动更新（补漏洞）。
2. 管理员账号最小化：日常用普通账号，必要时再提权。
3. 防火墙默认拒绝入站，仅放通必要服务。
4. RDP/SMB 不对公网暴露，必要时使用 VPN/堡垒机。
5. 开启并定期查看安全日志（4625 失败登录可发现爆破）。

## 学习成果示例填写（可照抄）

### 结论与反思（示例）

- 我在管理员组里只看到了预期账号；但我发现某些入站规则是 Allow，需要确认是否业务需要。
- 我以后会先看事件日志（4624/4625）判断是否有异常登录，再去看端口和防火墙规则定位暴露面。
