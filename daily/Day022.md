# Day022：漏洞扫描与基线 - 漏洞类型与编号体系

- 日期：2026-01-15
- 周次：第4周

## 学习目标

今天你将搞清楚：

- **CVE/CWE/CVSS** 三个编号体系分别做什么用
- 能根据 **CVSS 评分**初步判断漏洞风险等级
- 理解常见漏洞分类（配置类/逻辑类/输入校验类等）
- 能快速查阅官方漏洞数据库并理解缓解建议

---

## 学习内容

### 1️⃣ 漏洞编号体系三兄弟：CVE/CWE/CVSS

在网络安全领域，漏洞管理有三个核心编号体系，就像给漏洞办"身份证"：

```
漏洞管理三要素
├─ CVE  → 漏洞的"身份证号"（这是哪个漏洞）
├─ CWE  → 漏洞的"病因分类"（这是什么类型的漏洞）
└─ CVSS → 漏洞的"危险程度"（这个漏洞有多严重）
```

#### CVE（Common Vulnerabilities and Exposures）
**定义**：漏洞的唯一标识符，由 MITRE 组织维护。

**格式**：`CVE-年份-编号`
**示例**：`CVE-2021-44228`（Log4Shell）

**作用**：
- 全球统一引用标准
- 避免同一漏洞被不同厂商用不同名字描述
- 方便跨平台、跨工具追踪

**查询地址**：
- https://cve.mitre.org
- https://nvd.nist.gov（美国国家漏洞数据库，包含更详细评分和缓解建议）

#### CWE（Common Weakness Enumeration）
**定义**：软件缺陷/弱点的分类体系，描述"漏洞的根本原因"。

**格式**：`CWE-编号`
**示例**：
- `CWE-79`: Cross-site Scripting (XSS)
- `CWE-89`: SQL Injection
- `CWE-78`: OS Command Injection
- `CWE-287`: Improper Authentication

**作用**：
- 帮助开发者理解漏洞本质
- 用于代码审计工具的规则分类
- 指导安全编码规范

**查询地址**：https://cwe.mitre.org

#### CVSS（Common Vulnerability Scoring System）
**定义**：漏洞严重程度的标准化评分系统（0-10分）。

**版本**：目前主流为 **CVSS v3.1**（2019年发布）

**评分维度**（Base Score）：
1. **Attack Vector (AV)** - 攻击向量
   - Network (N): 远程攻击
   - Adjacent (A): 相邻网络攻击
   - Local (L): 本地访问
   - Physical (P): 物理接触

2. **Attack Complexity (AC)** - 攻击复杂度
   - Low (L): 容易利用
   - High (H): 需要特殊条件

3. **Privileges Required (PR)** - 所需权限
   - None (N): 无需权限
   - Low (L): 普通用户权限
   - High (H): 管理员权限

4. **User Interaction (UI)** - 用户交互
   - None (N): 无需用户操作
   - Required (R): 需要用户点击/操作

5. **Scope (S)** - 影响范围
   - Unchanged (U): 仅影响vulnerable component
   - Changed (C): 影响其他组件

6. **CIA Impact** - 机密性/完整性/可用性影响
   - None (N) / Low (L) / High (H)

**风险等级分级**：
| 分数区间 | 等级 | 描述 |
|---------|------|------|
| 0.0 | None | 无风险 |
| 0.1-3.9 | 🟢 Low | 低危 |
| 4.0-6.9 | 🟡 Medium | 中危 |
| 7.0-8.9 | 🟠 High | 高危 |
| 9.0-10.0 | 🔴 Critical | 严重 |

**查询地址**：https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator

---

### 2️⃣ 常见漏洞分类（按成因）

| 类别 | 代表性 CWE | 常见场景 | 典型案例 |
|------|-----------|----------|---------|
| **输入校验不足** | CWE-20 | 用户输入未过滤/转义 | SQL 注入、XSS、命令注入 |
| **认证/授权缺陷** | CWE-287 | 弱密码、会话劫持 | 未经认证的 API 访问 |
| **配置错误** | CWE-16 | 默认密码、权限过大 | 数据库暴露在公网 |
| **加密问题** | CWE-327 | 弱算法、硬编码密钥 | 使用 MD5 存储密码 |
| **逻辑漏洞** | CWE-840 | 业务流程绕过 | 支付金额可被篡改 |
| **资源管理** | CWE-400 | 内存泄漏、DoS | 无限制上传导致磁盘满 |
| **代码注入** | CWE-94 | 动态执行恶意代码 | eval() 执行用户输入 |

---

### 3️⃣ 实战案例：Log4Shell（CVE-2021-44228）

**漏洞信息**：
- **CVE**: CVE-2021-44228
- **CWE**: CWE-502 (Deserialization of Untrusted Data)
- **CVSS**: 10.0（满分严重）
- **影响组件**: Apache Log4j 2.x (< 2.17.0)

**CVSS 评分解析**：
```
AV:N  → 远程可利用（Network）
AC:L  → 攻击复杂度低（Low）
PR:N  → 无需权限（None）
UI:N  → 无需用户交互（None）
S:C   → 影响范围变化（Changed）
C:H / I:H / A:H → 机密性/完整性/可用性均为高影响
```

**为什么是 10.0 分？**
- 远程可利用 + 无需认证 + 容易利用 + 影响全面 = 完美风暴

**缓解措施**：
1. 立即升级到 Log4j 2.17.0+
2. 临时措施：设置 JVM 参数 `-Dlog4j2.formatMsgNoLookups=true`
3. WAF 规则拦截 `${jndi:` 特征字符串
4. 网络层面限制 LDAP/RMI 出站流量

---

### 4️⃣ 如何快速评估一个漏洞

**五步法**：

1. **查 CVE 编号** → 确认漏洞存在
2. **看 CVSS 分数** → 判断严重程度
3. **查受影响版本** → 对照自己系统版本
4. **看利用条件** → 评估自己是否满足被攻击条件
5. **找缓解方案** → 升级/打补丁/临时加固

**典型判断逻辑**：
```
CVSS >= 9.0  → 立即处理（24小时内）
CVSS 7.0-8.9 → 高优先级（1周内）
CVSS 4.0-6.9 → 规划修复（1个月内）
CVSS < 4.0   → 低优先级（视情况处理）
```

---

## 实践任务（合法授权范围内）

### 任务 1（必做）：查询 3 个真实 CVE 并分析

选择以下 3 个经典漏洞，查询并记录信息：

| CVE编号 | 名称 | CVSS | 影响组件 |
|---------|------|------|---------|
| CVE-2021-44228 | Log4Shell | 10.0 | Apache Log4j |
| CVE-2017-0144 | EternalBlue | 8.1 | Windows SMBv1 |
| CVE-2014-0160 | Heartbleed | 7.5 | OpenSSL |

**步骤**：
1. 访问 https://nvd.nist.gov
2. 搜索每个 CVE 编号
3. 记录以下信息：
   - CVSS Base Score
   - Attack Vector (AV)
   - Privileges Required (PR)
   - 影响的产品/版本
   - 官方建议的缓解措施

**记录模板**：
```
CVE-2021-44228 (Log4Shell)
├─ CVSS: 10.0 (Critical)
├─ AV: Network (远程可利用)
├─ PR: None (无需权限)
├─ 影响: Apache Log4j 2.0 - 2.14.1
└─ 缓解: 升级至 2.17.0 或设置 formatMsgNoLookups=true
```

### 任务 2（必做）：使用 CVSS 计算器评估一个漏洞

访问 https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator

**模拟场景**：
```
你发现一个 Web 应用漏洞：
- 攻击者可通过网络（无需认证）访问
- 利用复杂度低（只需发送特定 HTTP 请求）
- 无需用户交互
- 可读取数据库中所有用户信息（机密性影响高）
- 可修改数据（完整性影响高）
- 不影响可用性（可用性影响无）
```

**操作步骤**：
1. 在计算器中选择各个维度的值：
   - Attack Vector: **Network**
   - Attack Complexity: **Low**
   - Privileges Required: **None**
   - User Interaction: **None**
   - Scope: **Unchanged**
   - Confidentiality: **High**
   - Integrity: **High**
   - Availability: **None**

2. 记录生成的 CVSS 分数和向量字符串

3. 判断该漏洞的风险等级（低/中/高/严重）

### 任务 3（必做）：识别 CWE 类型

根据以下漏洞描述,匹配正确的 CWE 类型：

**场景 A**：
Web 应用登录页面允许无限次尝试密码，未实施账户锁定策略。

**场景 B**：
用户输入的文件名直接拼接到系统命令中执行，如：`os.system("cat " + filename)`

**场景 C**：
数据库密码硬编码在源代码中：`password = "admin123"`

**场景 D**：
用户可修改 URL 参数中的用户 ID 查看其他人的订单详情，系统未验证权限。

**待匹配的 CWE**：
- CWE-78: OS Command Injection
- CWE-287: Improper Authentication
- CWE-798: Use of Hard-coded Credentials
- CWE-639: Authorization Bypass Through User-Controlled Key

**提示**：访问 https://cwe.mitre.org 查看每个 CWE 的详细说明。

---

## 巩固练习（题与复盘）

### 题 1：CVSS 中的攻击向量（Attack Vector）如何影响评分？

**思路提示**：
- Network（远程）vs Physical（物理接触）哪个更危险？
- 为什么远程可利用的漏洞通常分数更高？

### 题 2：为什么需要 CWE 分类，只有 CVE 编号不够吗？

**思路提示**：
- CVE 只是"这个漏洞"的编号
- CWE 告诉我们"这类漏洞"的根本原因
- 对开发者和安全工程师分别有什么价值？

### 题 3：一个漏洞 CVSS 评分 9.5，但攻击需要物理接触设备，你会如何调整优先级？

**思路提示**：
- CVSS Base Score 只是基础评分
- 还需考虑 Temporal Score（时效性）和 Environmental Score（环境因素）
- 你的环境中物理安全控制如何？

---

## 评估标准（达成判定）

- ✅ 能解释 CVE/CWE/CVSS 三者的区别和用途
- ✅ 能在 NVD 上查询漏洞并提取关键信息
- ✅ 能使用 CVSS 计算器评估漏洞严重程度
- ✅ 能根据漏洞描述匹配正确的 CWE 分类
- ✅ 能根据 CVSS 评分初步判断修复优先级

---

## 学习成果达成情况（由学习者填写）

### 截图与证据

- [ ] NVD 查询 Log4Shell 的截图
- [ ] CVSS 计算器评分截图
- [ ] 3 个 CVE 的分析笔记

### 关键命令与输出（粘贴关键片段）

**CVE-2021-44228 查询结果**：
```
CVSS:
Attack Vector:
Privileges Required:
缓解措施:
```

**CVSS 计算器结果**：
```
Base Score:
Vector String:
Severity:
```

### 结论与反思

**我今天搞清楚了**：
- CVE 是漏洞的身份证，CWE 是病因分类，CVSS 是风险评分
- CVSS 评分越高不一定优先级越高，还要看实际环境

**我差点搞混的是**：
- 以前以为 CVE 和漏洞名称是一回事
- 不知道 CVSS 有基础评分/时效评分/环境评分三个维度

**明天我要继续补的是**：
- 实际使用漏洞扫描器（如 Nessus/OpenVAS）
- 理解漏洞扫描报告的结构

**本次学习耗时**：约 ___ 小时

**掌握程度自评**：
- [ ] 😕 看懂了但没动手
- [ ] 🙂 跑通了基础任务
- [ ] 😃 完成了所有任务并理解原理
- [ ] 🤩 额外查询了更多 CVE 案例

---

## 集中参考答案（含思路）

### 题 1 参考答案

**Attack Vector 对评分的影响**：

| Attack Vector | 说明 | 风险程度 | 示例 |
|--------------|------|---------|------|
| Network (N) | 远程可利用，无需物理接触 | 最高 | Web 应用 SQL 注入 |
| Adjacent (A) | 需要在相邻网络（如同一 VLAN） | 较高 | ARP 欺骗攻击 |
| Local (L) | 需要本地登录权限 | 中等 | 本地提权漏洞 |
| Physical (P) | 需要物理接触设备 | 较低 | 通过 USB 设备攻击 |

**为什么远程更危险？**
- 攻击面更大（全球任何人可尝试）
- 自动化扫描工具容易发现
- 传播速度快（蠕虫/勒索软件）

### 题 2 参考答案

**为什么需要 CWE 分类？**

1. **对开发者**：
   - 理解漏洞根本原因（是输入校验问题还是权限问题？）
   - 建立安全编码规范（如何避免 CWE-79 XSS？）
   - 代码审计工具基于 CWE 规则检查

2. **对安全工程师**：
   - 漏洞分类统计（我们最常见的是哪类漏洞？）
   - 培训重点（团队在 CWE-89 SQL 注入防护上薄弱）
   - 加固策略（针对 CWE-287 认证问题部署多因素认证）

3. **CVE vs CWE 的关系**：
   - 1 个 CWE 可能对应成百上千个 CVE
   - CVE 是"实例"，CWE 是"类别"
   - 类比：CWE-79 是"XSS 这类病"，CVE-2023-12345 是"某个产品的具体 XSS 漏洞"

### 题 3 参考答案

**CVSS 9.5 但需物理接触的优先级评估**：

**考虑因素**：
1. **环境评分调整**：
   - 如果设备在数据中心（物理安全严格）→ 优先级降低
   - 如果设备在公共场所（如 ATM、Kiosk）→ 优先级提升

2. **时效性评分**：
   - 是否有公开 EXP（Exploit Code）？
   - 是否已被在野利用？

3. **业务影响**：
   - 如果是关键基础设施（如工控系统），即使物理接触也应高优先级
   - 如果是办公终端且有严格的门禁控制，可降低优先级

**建议处理流程**：
- 短期：强化物理安全控制（如禁用 USB 端口、监控访问）
- 中期：规划补丁部署（在维护窗口更新）
- 长期：评估设备替换方案（如已停止支持的老旧设备）

---

## 学习成果示例填写（可照抄）

> 可将"示例"内容替换为你自己的时间与截图文件名。

### 截图与证据（示例）

- 任务 1：`images/day022_cve_log4shell.png`（NVD 上 Log4Shell 详情页）
- 任务 2：`images/day022_cvss_calculator.png`（CVSS 计算器评分结果）
- 任务 3：`images/day022_cwe_matching.png`（CWE 分类笔记）

### 关键命令与输出（示例）

**CVE-2021-44228 分析**：
```
CVE: CVE-2021-44228
名称: Log4Shell
CVSS: 10.0 (Critical)
向量: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
影响: Apache Log4j 2.0-beta9 到 2.14.1
缓解: 升级至 2.17.0 或设置 log4j2.formatMsgNoLookups=true
```

**CVSS 计算器示例**：
```
场景: 无认证远程 SQL 注入
Base Score: 9.8 (Critical)
Vector String: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
Severity: CRITICAL
```

### 结论与反思（示例）

**我今天搞清楚了**：
- CVE 是漏洞的唯一编号，CWE 是漏洞类型分类，CVSS 是风险评分标准
- CVSS 评分从攻击向量、复杂度、所需权限等多个维度综合计算
- 同一个 CWE 类型（如 CWE-79 XSS）可能有成千上万个不同的 CVE

**我差点搞混的是**：
- 以前以为 CVSS 只有一个分数，不知道还有基础/时效/环境三个评分维度
- 混淆了"漏洞严重性"和"修复优先级"（高分漏洞在不适用的环境中可降低优先级）

**明天我要继续补的是**：
- 实际操作漏洞扫描器（Nessus/OpenVAS）
- 学习如何解读扫描报告中的 CVE/CVSS 信息
- 了解漏洞生命周期管理

**本次学习耗时**：约 2 小时

**掌握程度自评**：
- [x] 😃 完成了所有任务并理解原理
