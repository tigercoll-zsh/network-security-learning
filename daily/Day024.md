---
title: Day024：漏洞扫描与基线 - 系统基线与审计
tags:
  - 网络
  - 安全
  - 学习计划
categories:
  - 网络安全
abbrlink: 87578fee
date: 2026-01-17 00:00:00
updated: 2026-01-17 00:00:00

---
# Day024：漏洞扫描与基线 - 系统基线与审计

- 日期：2026-01-17
- 周次：第4周

## 学习目标

学完今天你应该能做到：

- 能说出**什么是基线**以及**为什么需要基线检查**（合规性/安全性）
- 掌握**5条以上常见基线项**（口令策略、补丁管理、服务暴露、权限配置、日志审计）
- **编写自动化脚本（PowerShell/Bash）进行基线扫描并生成报告**
- **根据扫描结果进行风险评估，并制定加固方案**
- 理解 CIS Benchmark 等主流基线标准的核心要求

---

<!--more-->

## 🗺️ 知识图谱

### 今日内容在整体知识体系中的位置

```
网络安全学习路径
├── 第 4 周：Web 应用安全基础
│   ├── Day022：漏洞扫描与基线 (理论)
│   ├── Day023：漏洞扫描实战
│   └── Day024：系统基线与审计
│       ├── 核心概念：Baseline、Compliance、Hardening
│       ├── 实践技能：PowerShell/Bash 脚本、配置审计
│       └── 关联知识点：CIS Benchmark、等保 2.0
    ├── Day025：Web 中间件安全
```

### 今日关键词

`Baseline` · `Compliance` · `Hardening` · `Audit` · **`CIS Benchmark`** · **`Automation`**

---

## 一、什么是基线（Baseline）？

### 1.1 基线定义

**基线（Baseline）**是系统安全配置的"最低安全标准"，就像房子的"地基"：

```
基线检查的重要性
├─ 防止"默认配置"带来的风险（如：默认密码、默认服务）
├─ 确保"合规性"（如：等保、ISO27001、CIS Benchmark）
├─ 减少"攻击面"（关闭不必要的服务/端口）
└─ 便于"审计与追踪"（有标准可对比）
```

### 1.2 常见基线标准

| 标准名称 | 适用范围 | 特点 |
|---------|---------|------|
| **CIS Benchmark** | 通用（Linux/Windows/数据库/云） | 社区维护，可免费使用 |
| **NIST 800-53** | 美国政府/关键基础设施 | 非常详细，覆盖全面 |
| **ISO 27001** | 国际通用信息安全管理体系 | 侧重流程与管理 |
| **等保2.0** | 中国境内重要信息系统 | 强制性合规要求 |

---

## 二、五大基线检查项详解

### 2.1 口令策略基线

**Windows 基线项**：

```powershell
# 查看当前密码策略
net accounts

# 检查项
├─ 密码最小长度（建议 ≥ 12）
├─ 密码最长使用期限（建议 90-180 天）
├─ 密码历史（建议 ≥ 5 个）
└─ 锁定阈值（建议 5 次失败后锁定）
```

**Linux 基线项**：

```bash
# 查看密码策略（PAM配置）
cat /etc/login.defs | grep -E "PASS_MAX_DAYS|PASS_MIN_DAYS|PASS_WARN_AGE"

# 检查项
├─ PASS_MAX_DAYS ≤ 90（密码过期时间）
├─ PASS_MIN_DAYS ≥ 1（防止频繁修改密码）
└─ PASS_WARN_AGE ≥ 7（提前7天提醒）
```

**风险评估**：

| 策略 | 不安全配置 | 风险 | 加固建议 |
|------|-----------|------|---------|
| 密码长度 | < 8 位 | 容易被暴力破解 | 最少12位+复杂性 |
| 密码过期 | 永不过期 | 泄露后长期有效 | 90-180天过期 |
| 锁定策略 | 无锁定 | 暴力破解无限制 | 5次失败锁定30分钟 |

---

### 2.2 补丁与更新基线

**Windows 补丁检查**：

```powershell
# 查看已安装的补丁
wmic qfe list brief

# 或使用 PowerShell 模块
Get-HotFix | Select-Object HotFixID, InstalledOn, Description | Sort-Object InstalledOn -Descending
```

**Linux 补丁检查**：

```bash
# Ubuntu/Debian
apt list --upgradable

# CentOS/RHEL
yum check-update
```

**风险评估**：

| 场景 | 风险 | 加固建议 |
|------|------|---------|
| 系统长期未更新 | 存在已知漏洞（如 Log4Shell） | 每月更新，重要漏洞立即补 |
| 关键服务版本过旧 | CVE 评分 ≥ 9.0 | 优先处理严重漏洞 |
| 内核版本过旧 | 权限提升漏洞 | 定期更新内核 |

---

### 2.3 暴露服务基线

**检查开放端口**：

```bash
# Linux
ss -tulnp
# 或
netstat -tulnp

# Windows
netstat -ano | findstr LISTENING
```

**高风险端口清单**：

| 端口 | 服务 | 风险 | 建议 |
|------|------|------|------|
| **21** | FTP | 明文传输 | 使用 SFTP/FTP over TLS |
| **23** | Telnet | 明文传输 | 使用 SSH |
| **139/445** | SMB | 历史漏洞多 | 禁用或限制访问源 |
| **3306** | MySQL | 默认账户风险 | 限制监听IP+强密码 |
| **3389** | RDP | 远程桌面漏洞 | 仅VPN访问+强密码 |
| **6379** | Redis | 无认证风险 | 配置认证+防火墙 |

**加固脚本示例**（Linux）：

```bash
#!/bin/bash
# 检查高风险端口
HIGH_RISK_PORTS=(21 23 3306 3389 6379)

for port in "${HIGH_RISK_PORTS[@]}"; do
    if ss -tulnp | grep -q ":$port "; then
        echo "[警告] 高风险端口 $port 已开放"
    fi
done
```

---

### 2.4 权限配置基线

**SUID/SGID 检查**（Linux）：

```bash
# 查找具有 SUID 位的文件
find / -perm -4000 -type f 2>/dev/null

# 查找具有 SGID 位的文件
find / -perm -2000 -type f 2>/dev/null
```

**常见 SUID 文件风险评估**：

| 文件 | 用途 | 风险 |
|------|------|------|
| `/usr/bin/passwd` | 修改密码 | 正常（需要root权限） |
| `/usr/bin/sudo` | 执行命令 | 正常 |
| `/usr/bin/vim` | 文本编辑 | ⚠️ 不应有SUID（可提权） |
| `/bin/bash` | Shell | ⚠️ 不应有SUID（可提权） |

**Windows 权限检查**：

```powershell
# 检查管理员组成员
Get-LocalGroupMember -Group "Administrators"

# 检查文件权限（如敏感目录）
Get-Acl "C:\inetpub\wwwroot" | Format-List
```

---

### 2.5 日志审计基线

**Linux 日志检查**：

```bash
# 检查日志目录权限（应仅 root 可写）
ls -ld /var/log

# 检查关键日志文件
├─ /var/log/auth.log（认证日志）
├─ /var/log/syslog（系统日志）
└─ /var/log/secure（安全日志）
```

**Windows 日志检查**：

```powershell
# 检查日志配置
wevtutil gl Security

# 检查关键事件ID
├─ 4624/4625（登录成功/失败）
├─ 4720/4726（创建/删除用户）
├─ 4688（进程创建）
└─ 4740（账户锁定）
```

**日志保留策略**：

| 日志类型 | 最短保留时间 | 用途 |
|---------|-------------|------|
| 安全日志 | 6个月 | 取证溯源 |
| 应用日志 | 3个月 | 故障排查 |
| 审计日志 | 1年 | 合规要求 |

---

## 三、实践任务

### 任务 1：Windows 本机基线检查脚本（自动化审计）

**目标**：编写 PowerShell 脚本检查关键基线项，并输出含评分的 CSV 报告。

```powershell
# Windows 基线检查脚本 v2.0
# 保存为 check_windows_baseline.ps1

$report = @()
$score = 100

function Add-CheckItem {
    param($Item, $Status, $RiskLevel, $Recommendation, $DeductScore)

    $obj = [PSCustomObject]@{} | Select-Object Item, Status, Risk, Recommendation
    $obj.Item = $Item
    $obj.Status = $Status
    $obj.Risk = $RiskLevel
    $obj.Recommendation = $Recommendation

    # 扣分逻辑
    if ($RiskLevel -eq "高") { $script:score -= $DeductScore }
    elseif ($RiskLevel -eq "中") { $script:score -= ($DeductScore / 2) }

    return $obj
}

# 1. 密码策略检查
$passwordPolicy = net accounts
$minLen = [regex]::match($passwordPolicy, "Minimum password length:\s+(\d+)").Groups[1].Value
$report += Add-CheckItem -Item "密码最小长度" -Status "$minLen 位" -Risk (if ([int]$minLen -lt 12) { "高" } else { "低" }) -Recommendation "建议 ≥ 12 位" -DeductScore 10

# 2. 补丁检查
$lastPatch = Get-HotFix | Sort-Object InstalledOn -Descending | Select-Object -First 1
$daysSincePatch = ((Get-Date) - $lastPatch.InstalledOn).Days
$report += Add-CheckItem -Item "补丁时效性" -Status "最后更新于 $daysSincePatch 天前" -Risk (if ($daysSincePatch -gt 90) { "高" } else { "低" }) -Recommendation "建议每月更新" -DeductScore 20

# 3. 开放端口检查
$openPorts = Get-NetTCPConnection -State Listen
$riskyPorts = $openPorts | Where-Object { $_.LocalPort -in 3389, 445, 135 }
$report += Add-CheckItem -Item "高危端口暴露" -Status "发现 $($riskyPorts.Count) 个高危端口" -Risk (if ($riskyPorts) { "高" } else { "低" }) -Recommendation "限制 3389/445 端口访问" -DeductScore 20

# 4. 管理员组成员检查
$admins = Get-LocalGroupMember -Group "Administrators"
$report += Add-CheckItem -Item "管理员组人数" -Status "$($admins.Count) 人" -Risk (if ($admins.Count -gt 3) { "中" } else { "低" }) -Recommendation "仅保留必要管理员" -DeductScore 10

# 5. 防火墙状态
$firewall = Get-NetFirewallProfile | Where-Object Enabled -eq True
$report += Add-CheckItem -Item "防火墙状态" -Status "启用配置文件数: $($firewall.Count)" -Risk (if ($firewall.Count -eq 0) { "高" } else { "低" }) -Recommendation "必须启用防火墙" -DeductScore 20

# 输出结果
$report | Export-Csv -Path ".\baseline_report_$(Get-Date -Format 'yyyyMMdd').csv" -NoTypeInformation -Encoding UTF8
Write-Output "✅ 检查完成！当前系统安全评分: $score 分"
if ($score -lt 60) { Write-Warning "系统存在严重安全风险，请立即整改！" }
$report | Format-Table -AutoSize
```

**运行脚本**：
1. 以管理员身份打开 PowerShell。
2. 运行脚本：`.\check_windows_baseline.ps1`。
3. 查看生成的 CSV 报告和最终评分。

---

### 任务 2：Linux 靶机基线检查

**目标**：编写 Shell 脚本检查 Linux 基线项。

```bash
#!/bin/bash
# Linux 基线检查脚本
# 保存为 check_linux_baseline.sh

REPORT="baseline_report_$(date +%Y%m%d).txt"
echo "Linux 基线检查报告 - $(date)" > $REPORT
echo "================================" >> $REPORT

# 1. 密码策略检查
echo "" >> $REPORT
echo "【1】密码策略检查" >> $REPORT
cat /etc/login.defs | grep -E "PASS_MAX_DAYS|PASS_MIN_DAYS" >> $REPORT

# 2. 补丁检查
echo "" >> $REPORT
echo "【2】补丁检查（待更新包）" >> $REPORT
apt list --upgradable 2>/dev/null | wc -l >> $REPORT

# 3. 开放端口检查
echo "" >> $REPORT
echo "【3】开放端口" >> $REPORT
ss -tulnp >> $REPORT

# 4. SUID 文件检查
echo "" >> $REPORT
echo "【4】SUID 文件" >> $REPORT
find / -perm -4000 -type f 2>/dev/null >> $REPORT

# 5. 日志目录权限检查
echo "" >> $REPORT
echo "【5】日志目录权限" >> $REPORT
ls -ld /var/log >> $REPORT

echo "" >> $REPORT
echo "检查完成，报告已保存到: $REPORT" >> $REPORT

cat $REPORT
```

**运行脚本**：

```bash
chmod +x check_linux_baseline.sh
./check_linux_baseline.sh
```

---

### 任务 3：基线结果分析与加固

**目标**：根据基线检查结果，识别 Top 3 风险项并给出加固建议。

**示例报告**：

```
【基线检查结果分析】

高风险项：
1. [密码策略] 密码最小长度为 6 位
   建议：修改为 ≥ 12 位，增加复杂性要求

2. [开放端口] 3306 (MySQL) 对公网开放
   建议：修改 MySQL 配置，仅监听 127.0.0.1

3. [补丁管理] 超过 90 天未更新
   建议：检查重要补丁，优先修复 CVE ≥ 7.0

中风险项：
4. [管理员组] 发现 5 个成员
   建议：审查成员列表，删除临时账号

低风险项：
5. [日志配置] 日志已启用，保留策略合理
   建议：继续保持
```

---

## 四、巩固练习

### 练习 1：列举 5 条常见基线项

**参考答案**：
1. **密码策略**：最小长度、过期时间、历史记录、锁定阈值
2. **补丁管理**：系统更新频率、关键组件版本、已知漏洞修复
3. **服务暴露**：开放端口、监听地址、防火墙规则
4. **权限配置**：SUID/SGID 文件、文件权限、管理员组成员
5. **日志审计**：日志启用状态、保留时间、关键字段

### 练习 2：例外管理与持续监控（思考题）

**题目**：如果某台服务器因业务需要必须开放 3389 端口（违背了基线），作为安全管理员你应该怎么处理？

**参考答案**：
1.  **记录例外 (Exception)**：在合规系统中记录该例外，说明业务理由、有效期和责任人。
2.  **实施补偿控制 (Compensating Controls)**：虽然开放了端口，但限制仅允许特定 IP 访问（防火墙白名单），或者强制使用 VPN/跳板机，并启用 MFA。
3.  **加强监控**：对该端口的连接尝试进行重点监控，一旦发现爆破行为立即告警。

### 练习 3：如何定期自动化基线检查？

**参考答案**：
- **Windows**：使用任务计划程序（Task Scheduler）定期运行 PowerShell 脚本。
- **Linux**：使用 Cron Job 定期运行 Bash 脚本。
- **企业级**：使用 Ansible/Puppet 等配置管理工具，或专门的合规扫描平台（如 Nessus, OpenSCAP）进行周期性扫描。

---

## 五、评估标准

- ✅ 能说出什么是基线及其重要性
- ✅ 掌握 5 条以上常见基线项
- ✅ 能编写脚本检查本机/靶机的关键基线项
- ✅ **能根据检查结果进行评分和风险分级**
- ✅ **理解"基线例外"的处理流程**
- ✅ 输出结构化报告（CSV/JSON）

---

## 六、参考资料

- [CIS Benchmarks](https://www.cisecurity.org/cis-benchmarks/)
- [NIST 800-53](https://csrc.nist.gov/publications/detail/sp/800-53/rev-5/final)
- [Windows Security Baselines](https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-security-baselines)

---

## 七、学习成果达成情况（由学习者填写）

### 截图与证据

- [ ] Windows 基线检查脚本运行截图
- [ ] Linux 基线检查脚本运行截图
- [ ] 生成的 CSV 报告文件

### 关键发现

**密码策略**：
- 当前配置：
- 风险等级：
- 改进建议：

**服务暴露**：
- 开放端口：
- 高风险端口：
- 改进建议：

### 结论与反思

**我今天搞清楚了**：
- 基线是系统安全的"最低标准"，必须定期检查
- 常见的 5 大基线项：口令策略、补丁管理、服务暴露、权限配置、日志审计
- 脚本化检查可以大大提高效率，输出结构化报告便于分析

**我差点搞混的是**：
- 最初以为基线只是"检查密码"，实际上包含多个维度
- 没意识到 SUID 文件可能带来的提权风险

**明天我要继续补的是**：
- Web 中间件基线检查（Day025）
- 自动化基线检查脚本优化（Day026）

**本次学习耗时**：约 2.5 小时

**掌握程度自评**：
- [ ] 😐 理解了基本概念，但实践不熟练
- [ ] 😃 完成了所有任务并理解原理
- [ ] 🤩 能独立设计基线检查脚本并优化

---

**恭喜！你已掌握系统基线与审计的核心技能。明天我们将学习 Web 中间件与常见暴露面，继续加固你的安全堡垒！** 🎉
