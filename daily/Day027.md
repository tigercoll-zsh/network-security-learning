# Day027ï¼šæ¼æ´æ‰«æä¸åŸºçº¿ - åŠ å›ºå¤éªŒä¸å˜æ›´è®°å½•

- æ—¥æœŸï¼š2026-01-20
- å‘¨æ¬¡ï¼šç¬¬4å‘¨

## å­¦ä¹ ç›®æ ‡

ä»Šå¤©ä½ å°†æŒæ¡ï¼š

- **å»ºç«‹å¤éªŒæµç¨‹**ï¼šéªŒè¯å®‰å…¨åŠ å›ºæªæ–½æ˜¯å¦ç”Ÿæ•ˆ
- **å½¢æˆå˜æ›´è®°å½•**ï¼šè§„èŒƒè®°å½•é…ç½®å˜æ›´ï¼Œä¾¿äºå®¡è®¡å’Œå›æº¯
- **ç†è§£å›å½’é£é™©**ï¼šè¯„ä¼°åŠ å›ºæªæ–½å¯¹ä¸šåŠ¡åŠŸèƒ½çš„å½±å“
- **åˆ¶å®šå›æ»šç­–ç•¥**ï¼šåœ¨åŠ å›ºå¤±è´¥æ—¶å¿«é€Ÿæ¢å¤åŸé…ç½®
- **æŒæ¡å˜æ›´ç®¡ç†**ï¼šç†è§£ä¼ä¸šçº§å˜æ›´å®¡æ‰¹æµç¨‹

---

## å­¦ä¹ å†…å®¹

### 1ï¸âƒ£ åŠ å›ºå¤éªŒçš„é‡è¦æ€§

#### 1.1 ä¸ºä»€ä¹ˆéœ€è¦å¤éªŒï¼Ÿ

```
åŠ å›ºåå¿…é¡»å¤éªŒ
â”œâ”€ ç¡®è®¤æªæ–½ç”Ÿæ•ˆï¼ˆé…ç½®æ˜¯å¦ç”Ÿæ•ˆï¼Ÿï¼‰
â”œâ”€ æ£€æµ‹å‰¯ä½œç”¨ï¼ˆæ˜¯å¦å½±å“ä¸šåŠ¡ï¼Ÿï¼‰
â”œâ”€ éªŒè¯æ— è¯¯æŠ¥ï¼ˆæ‰«æå™¨è¯¯åˆ¤å·²ä¿®å¤ï¼Ÿï¼‰
â””â”€ å»ºç«‹åŸºçº¿ï¼ˆä½œä¸ºåç»­å¯¹æ¯”åŸºå‡†ï¼‰
```

**å¸¸è§é—®é¢˜**ï¼š

| åœºæ™¯ | é—®é¢˜ | åæœ |
|------|------|------|
| é…ç½®é”™è¯¯ | è¯­æ³•é”™è¯¯å¯¼è‡´æœåŠ¡æ— æ³•å¯åŠ¨ | ğŸ”´ æœåŠ¡ä¸­æ–­ |
| è¿‡åº¦åŠ å›º | ç¦ç”¨å¿…è¦åŠŸèƒ½å¯¼è‡´ä¸šåŠ¡å¼‚å¸¸ | ğŸŸ  åŠŸèƒ½å¤±æ•ˆ |
| æœªç”Ÿæ•ˆ | é‡å¯æœåŠ¡æ—¶é…ç½®æœªåŠ è½½ | ğŸŸ¡ æ¼æ´ä»å­˜åœ¨ |
| è¯¯æŠ¥ | æ‰«æå™¨è¯¯åˆ¤ï¼Œå®é™…æ— éœ€åŠ å›º | ğŸŸ¢ è™šæƒŠä¸€åœº |

#### 1.2 å¤éªŒæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. åŠ å›ºå‰åŸºçº¿æ‰«æï¼ˆBaseline Scanï¼‰                 â”‚
â”‚    - è®°å½•åˆå§‹çŠ¶æ€                                   â”‚
â”‚    - ä¿å­˜é…ç½®å¤‡ä»½                                   â”‚
â”‚    - è®°å½•æœåŠ¡æ­£å¸¸è¿è¡ŒçŠ¶æ€                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æ‰§è¡Œå®‰å…¨åŠ å›º                                     â”‚
â”‚    - ä¿®æ”¹é…ç½®æ–‡ä»¶                                   â”‚
â”‚    - é‡å¯æœåŠ¡                                       â”‚
â”‚    - åŸºç¡€åŠŸèƒ½æµ‹è¯•                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. åŠ å›ºåå¤éªŒæ‰«æï¼ˆRe-scanï¼‰                        â”‚
â”‚    - æ‰§è¡Œç›¸åŒæ‰«æä»»åŠ¡                               â”‚
â”‚    - å¯¹æ¯”å‰åç»“æœ                                   â”‚
â”‚    - éªŒè¯æªæ–½æ˜¯å¦ç”Ÿæ•ˆ                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ä¸šåŠ¡å›å½’æµ‹è¯•                                     â”‚
â”‚    - æµ‹è¯•æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½                               â”‚
â”‚    - éªŒè¯ç”¨æˆ·è®¿é—®æ˜¯å¦æ­£å¸¸                           â”‚
â”‚    - æ£€æŸ¥æ—¥å¿—æ— å¼‚å¸¸                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ç¡®è®¤æˆ–å›æ»š                                     â”‚
â”‚    â”œâ”€ æµ‹è¯•é€šè¿‡ â†’ ç¡®è®¤å˜æ›´ï¼Œæ›´æ–°æ–‡æ¡£                 â”‚
â”‚    â””â”€ æµ‹è¯•å¤±è´¥ â†’ ç«‹å³å›æ»šï¼Œåˆ†æåŸå›                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2ï¸âƒ£ å¤éªŒæ–¹æ³•ä¸å¯¹æ¯”æŠ€æœ¯

#### 2.1 é…ç½®æ–‡ä»¶å¯¹æ¯”

**ä½¿ç”¨ `diff` å‘½ä»¤å¯¹æ¯”é…ç½®å˜åŒ–**ï¼š

```bash
# å¤‡ä»½åŸé…ç½®
sudo cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.backup_$(date +%Y%m%d)

# ä¿®æ”¹é…ç½®...
sudo nano /etc/nginx/nginx.conf

# å¯¹æ¯”é…ç½®å˜åŒ–
diff /etc/nginx/nginx.conf.backup_20260119 /etc/nginx/nginx.conf
```

**è¾“å‡ºç¤ºä¾‹**ï¼š

```diff
--- nginx.conf.backup_20260119   2026-01-19 10:00:00
+++ nginx.conf                   2026-01-19 10:30:00
@@ -12,6 +12,9 @@
 
 http {
     include       /etc/nginx/mime.types;
+    server_tokens off;
+    add_header X-Frame-Options "SAMEORIGIN" always;
+    add_header X-Content-Type-Options "nosniff" always;
     default_type  application/octet-stream;
```

#### 2.2 æœåŠ¡çŠ¶æ€å¯¹æ¯”

**åŠ å›ºå‰åæœåŠ¡çŠ¶æ€æ£€æŸ¥**ï¼š

```bash
# åŠ å›ºå‰
systemctl status nginx | head -5
# è¾“å‡ºï¼šActive: active (running)

# åŠ å›ºåï¼ˆé‡å¯åå†æ¬¡æ£€æŸ¥ï¼‰
systemctl status nginx | head -5
# éªŒè¯æœåŠ¡çŠ¶æ€
```

#### 2.3 æ‰«æç»“æœå¯¹æ¯”

**ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·å¯¹æ¯”**ï¼š

```python
#!/usr/bin/env python3
"""
å¯¹æ¯”åŠ å›ºå‰åçš„æ‰«æç»“æœ
"""
import json
import csv
from pathlib import Path
from datetime import datetime


def compare_reports(before_file: str, after_file: str):
    """å¯¹æ¯”ä¸¤ä¸ªæ‰«ææŠ¥å‘Š
    
    Args:
        before_file: åŠ å›ºå‰æŠ¥å‘Šè·¯å¾„
        after_file: åŠ å›ºåæŠ¥å‘Šè·¯å¾„
    """
    with open(before_file, "r", encoding="utf-8") as f:
        before_data = json.load(f)
    
    with open(after_file, "r", encoding="utf-8") as f:
        after_data = json.load(f)
    
    print("=" * 60)
    print(f"åŠ å›ºå‰æ‰«ææ—¶é—´: {before_data['report_time']}")
    print(f"åŠ å›ºåæ‰«ææ—¶é—´: {after_data['report_time']}")
    print("=" * 60)
    
    # æå–æ£€æŸ¥ç»“æœ
    before_checks = before_data["targets"][0]["checks"]
    after_checks = after_data["targets"][0]["checks"]
    
    # ç»Ÿè®¡å˜åŒ–
    fixed = []
    still_failed = []
    new_failed = []
    
    # å»ºç«‹æ˜ å°„
    before_map = {c["name"]: c for c in before_checks}
    after_map = {c["name"]: c for c in after_checks}
    
    for check_name in before_map:
        before = before_map[check_name]
        after = after_map.get(check_name)
        
        if after:
            if before["status"] == "failed" and after["status"] == "passed":
                fixed.append(check_name)
            elif before["status"] == "failed" and after["status"] == "failed":
                still_failed.append(check_name)
    
    for check_name in after_map:
        if check_name not in before_map and after_map[check_name]["status"] == "failed":
            new_failed.append(check_name)
    
    # æ‰“å°ç»“æœ
    print(f"\nâœ… å·²ä¿®å¤ ({len(fixed)} ä¸ª)")
    for item in fixed:
        print(f"  - {item}")
    
    print(f"\nâŒ ä»ç„¶å¤±è´¥ ({len(still_failed)} ä¸ª)")
    for item in still_failed:
        print(f"  - {item}")
    
    print(f"\nâš ï¸  æ–°å‘ç°é—®é¢˜ ({len(new_failed)} ä¸ª)")
    for item in new_failed:
        print(f"  - {item}")
    
    # ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Š
    comparison_data = {
        "comparison_time": datetime.now().isoformat(),
        "before_report": before_file,
        "after_report": after_file,
        "summary": {
            "fixed": len(fixed),
            "still_failed": len(still_failed),
            "new_failed": len(new_failed)
        },
        "details": {
            "fixed": fixed,
            "still_failed": still_failed,
            "new_failed": new_failed
        }
    }
    
    output_file = f"comparison_{datetime.now().strftime('%Y%m%d_%H%M%S')}.json"
    with open(output_file, "w", encoding="utf-8") as f:
        json.dump(comparison_data, f, indent=2, ensure_ascii=False)
    
    print(f"\nâœ… å¯¹æ¯”æŠ¥å‘Šå·²ä¿å­˜: {output_file}")


if __name__ == "__main__":
    import sys
    
    if len(sys.argv) != 3:
        print("ç”¨æ³•: python compare_reports.py <before_report.json> <after_report.json>")
        sys.exit(1)
    
    compare_reports(sys.argv[1], sys.argv[2])
```

---

### 3ï¸âƒ£ å˜æ›´è®°å½•æ¨¡æ¿

#### 3.1 æ ‡å‡†å˜æ›´è®°å½•æ ¼å¼

```markdown
# å®‰å…¨é…ç½®å˜æ›´è®°å½•

## åŸºæœ¬ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| å˜æ›´ç¼–å· | CR-2026-001 |
| å˜æ›´æ ‡é¢˜ | Nginx æœåŠ¡å™¨å®‰å…¨åŠ å›º |
| ç”³è¯·äºº | å¼ ä¸‰ |
| ç”³è¯·éƒ¨é—¨ | ä¿¡æ¯å®‰å…¨éƒ¨ |
| ç”³è¯·æ—¥æœŸ | 2026-01-19 |
| é¢„è®¡æ‰§è¡Œæ—¥æœŸ | 2026-01-20 02:00-04:00 |
| ä¼˜å…ˆçº§ | é«˜ |

## å½±å“èŒƒå›´

| é¡¹ç›® | å†…å®¹ |
|------|------|
| å½±å“ç³»ç»Ÿ | å‰ç«¯ Web æœåŠ¡å™¨ (192.168.1.10) |
| å½±å“æœåŠ¡ | Nginx HTTP æœåŠ¡ (ç«¯å£ 80/443) |
| å½±å“ç”¨æˆ· | æ‰€æœ‰å¤–éƒ¨ç”¨æˆ· |
| å½±å“æ—¶æ®µ | ç»´æŠ¤çª—å£ï¼ˆå‡Œæ™¨ 2:00-4:00ï¼‰ |

## å˜æ›´å†…å®¹

### å˜æ›´å‰é…ç½®

```nginx
# /etc/nginx/nginx.conf
http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;
    # ... å…¶ä»–é…ç½®
}
```

### å˜æ›´åé…ç½®

```nginx
# /etc/nginx/nginx.conf
http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;
    
    # æ–°å¢å®‰å…¨é…ç½®
    server_tokens off;
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
}
```

### å˜æ›´é¡¹åˆ—è¡¨

| åºå· | å˜æ›´é¡¹ | é…ç½®æ–‡ä»¶ | é£é™©ç­‰çº§ |
|------|--------|---------|---------|
| 1 | éšè— Nginx ç‰ˆæœ¬å· | /etc/nginx/nginx.conf | ä½ |
| 2 | æ·»åŠ  X-Frame-Options å“åº”å¤´ | /etc/nginx/nginx.conf | ä¸­ |
| 3 | æ·»åŠ  X-Content-Type-Options å“åº”å¤´ | /etc/nginx/nginx.conf | ä¸­ |

## å›æ»šæ–¹æ¡ˆ

### å›æ»šæ­¥éª¤

1. æ¢å¤é…ç½®æ–‡ä»¶ï¼š
   ```bash
   sudo cp /etc/nginx/nginx.conf.backup_20260120 /etc/nginx/nginx.conf
   ```

2. æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³•ï¼š
   ```bash
   sudo nginx -t
   ```

3. é‡å¯æœåŠ¡ï¼š
   ```bash
   sudo systemctl restart nginx
   ```

4. éªŒè¯æœåŠ¡çŠ¶æ€ï¼š
   ```bash
   sudo systemctl status nginx
   ```

### å›æ»šè§¦å‘æ¡ä»¶

- [ ] æœåŠ¡å¯åŠ¨å¤±è´¥
- [ ] ä¸šåŠ¡åŠŸèƒ½å¼‚å¸¸ï¼ˆå¦‚é¡µé¢æ— æ³•åŠ è½½ï¼‰
- [ ] ç”¨æˆ·æŠ•è¯‰å¢åŠ 
- [ ] æ—¥å¿—ä¸­å‡ºç°å¤§é‡é”™è¯¯
- [ ] å“åº”æ—¶é—´æ˜æ˜¾å˜æ…¢ï¼ˆå¢åŠ è¶…è¿‡ 50%ï¼‰

## å¤éªŒè®¡åˆ’

| é¡¹ç›® | å†…å®¹ |
|------|------|
| å¤éªŒå·¥å…· | åŸºçº¿æ£€æŸ¥è„šæœ¬ (Day026) |
| å¤éªŒå†…å®¹ | ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²ã€å®‰å…¨å“åº”å¤´ |
| å¤éªŒæ—¶é—´ | 2026-01-20 04:00 |
| é€šè¿‡æ ‡å‡† | æ‰€æœ‰æ£€æŸ¥é¡¹çŠ¶æ€ä¸º "passed" |

## å®¡æ‰¹è®°å½•

| è§’è‰² | å§“å | æ„è§ | ç­¾å­— | æ—¥æœŸ |
|------|------|------|------|------|
| ç”³è¯·äºº | å¼ ä¸‰ | åŒæ„ | å¼ ä¸‰ | 2026-01-19 |
| æŠ€æœ¯å®¡æ ¸ | æå›› | å»ºè®®æµ‹è¯•ç¯å¢ƒå…ˆéªŒè¯ | æå›› | 2026-01-19 |
| å®‰å…¨å®¡æ ¸ | ç‹äº” | åŒæ„ | ç‹äº” | 2026-01-19 |
| ä¸šåŠ¡å®¡æ‰¹ | èµµå…­ | éœ€é€šçŸ¥ç”¨æˆ·ç»´æŠ¤çª—å£ | èµµå…­ | 2026-01-19 |

## æ‰§è¡Œè®°å½•

| é¡¹ç›® | å†…å®¹ |
|------|------|
| å®é™…æ‰§è¡Œæ—¶é—´ | 2026-01-20 02:15-03:30 |
| æ‰§è¡Œäºº | å¼ ä¸‰ |
| æ‰§è¡ŒçŠ¶æ€ | âœ… æˆåŠŸ |
| æ‰§è¡Œæ—¥å¿— | è§é™„ä»¶ execution_log.txt |
| å›æ»šæ“ä½œ | æœªæ‰§è¡Œ |

## å¤éªŒç»“æœ

### åŠ å›ºå‰æ‰«æï¼ˆ2026-01-19 10:00ï¼‰

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | é£é™©ç­‰çº§ | æ¶ˆæ¯ |
|--------|------|---------|------|
| ç‰ˆæœ¬ä¿¡æ¯æ³„éœ² | âŒ å¤±è´¥ | ä¸­ | Server å¤´æš´éœ²ç‰ˆæœ¬ |
| å®‰å…¨å“åº”å¤´æ£€æŸ¥ | âŒ å¤±è´¥ | é«˜ | ç¼ºå°‘ 3 ä¸ªå®‰å…¨å“åº”å¤´ |
| ç›®å½•åˆ—å‡ºæ£€æŸ¥ | âœ… é€šè¿‡ | - | æœªå‘ç°ç›®å½•åˆ—å‡º |

**é€šè¿‡ç‡**: 33.3% (1/3)

### åŠ å›ºåæ‰«æï¼ˆ2026-01-20 04:00ï¼‰

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | é£é™©ç­‰çº§ | æ¶ˆæ¯ |
|--------|------|---------|------|
| ç‰ˆæœ¬ä¿¡æ¯æ³„éœ² | âœ… é€šè¿‡ | - | æœªå‘ç°ç‰ˆæœ¬ä¿¡æ¯æ³„éœ² |
| å®‰å…¨å“åº”å¤´æ£€æŸ¥ | âœ… é€šè¿‡ | - | æ‰€æœ‰å®‰å…¨å“åº”å¤´å·²é…ç½® |
| ç›®å½•åˆ—å‡ºæ£€æŸ¥ | âœ… é€šè¿‡ | - | æœªå‘ç°ç›®å½•åˆ—å‡º |

**é€šè¿‡ç‡**: 100% (3/3)

### å¯¹æ¯”ç»“è®º

- âœ… å·²ä¿®å¤ï¼šç‰ˆæœ¬ä¿¡æ¯æ³„éœ²ã€å®‰å…¨å“åº”å¤´æ£€æŸ¥
- âœ… æ— æ–°å¢é—®é¢˜
- âœ… é€šè¿‡ç‡ä» 33.3% æå‡åˆ° 100%

## ä¸šåŠ¡å›å½’æµ‹è¯•

| æµ‹è¯•é¡¹ | æµ‹è¯•ç»“æœ | å¤‡æ³¨ |
|--------|---------|------|
| é¦–é¡µè®¿é—® | âœ… æ­£å¸¸ | å“åº”æ—¶é—´ < 500ms |
| ç”¨æˆ·ç™»å½• | âœ… æ­£å¸¸ | - |
| æ•°æ®æäº¤ | âœ… æ­£å¸¸ | - |
| é™æ€èµ„æºåŠ è½½ | âœ… æ­£å¸¸ | - |
| è·¨åŸŸè¯·æ±‚ | âœ… æ­£å¸¸ | - |

## æ€»ç»“ä¸åç»­è®¡åˆ’

**æ€»ç»“**ï¼š
æœ¬æ¬¡å˜æ›´æˆåŠŸå®Œæˆï¼ŒåŠ å›ºæªæ–½å…¨éƒ¨ç”Ÿæ•ˆï¼Œä¸šåŠ¡åŠŸèƒ½æ­£å¸¸ï¼Œæ— å‰¯ä½œç”¨ã€‚

**åç»­è®¡åˆ’**ï¼š
- 1 å‘¨ï¼šæŒç»­ç›‘æ§æœåŠ¡å™¨æ—¥å¿—å’Œç”¨æˆ·åé¦ˆ
- 1 ä¸ªæœˆï¼šå°†ç›¸åŒåŠ å›ºæªæ–½æ¨å¹¿åˆ°å…¶ä»– Web æœåŠ¡å™¨
- 3 ä¸ªæœˆï¼šå®šæœŸå¤æ ¸åŠ å›ºæªæ–½æœ‰æ•ˆæ€§

---

## 4ï¸âƒ£ å›å½’é£é™©ä¸å…¼å®¹æ€§é—®é¢˜

#### 4.1 å¸¸è§å…¼å®¹æ€§é—®é¢˜

| åŠ å›ºæªæ–½ | æ½œåœ¨å…¼å®¹æ€§é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|---------|---------------|---------|
| **å®‰å…¨å“åº”å¤´** | æŸäº›æ—§ç‰ˆæµè§ˆå™¨ä¸æ”¯æŒ CSP | é™çº§ä½¿ç”¨ Report-Only æ¨¡å¼ |
| **HTTP æ–¹æ³•é™åˆ¶** | API ç«¯ç‚¹ä¾èµ– PUT/DELETE æ–¹æ³• | ç™½åå•ç‰¹å®š API ç«¯ç‚¹ |
| **éšè—ç‰ˆæœ¬å·** | æŸäº›è‡ªåŠ¨åŒ–è„šæœ¬ä¾èµ–ç‰ˆæœ¬å·æ£€æµ‹ | ä½¿ç”¨ User-Agent æ›¿ä»£ |
| **é˜²ç«å¢™è§„åˆ™** | é˜»æ–­åˆæ³•æµé‡ | å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯è§„åˆ™ |
| **TLS åŠ å¯†** | æ—§å®¢æˆ·ç«¯ä¸æ”¯æŒæ–°åè®® | ä¿ç•™æ—§åè®®æ”¯æŒ |

#### 4.2 å›å½’æµ‹è¯•æ£€æŸ¥æ¸…å•

```markdown
## Web æœåŠ¡å™¨åŠ å›ºå›å½’æµ‹è¯•æ¸…å•

### åŠŸèƒ½æµ‹è¯•

- [ ] é¦–é¡µèƒ½æ­£å¸¸è®¿é—®
- [ ] ç”¨æˆ·ç™»å½•åŠŸèƒ½æ­£å¸¸
- [ ] æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ­£å¸¸
- [ ] API æ¥å£å“åº”æ­£å¸¸
- [ ] é™æ€èµ„æºï¼ˆå›¾ç‰‡ã€CSSã€JSï¼‰åŠ è½½æ­£å¸¸
- [ ] è¡¨å•æäº¤åŠŸèƒ½æ­£å¸¸

### å…¼å®¹æ€§æµ‹è¯•

- [ ] Chrome æœ€æ–°ç‰ˆ
- [ ] Firefox æœ€æ–°ç‰ˆ
- [ ] Safari æœ€æ–°ç‰ˆ
- [ ] Edge æœ€æ–°ç‰ˆ
- [ ] ç§»åŠ¨ç«¯æµè§ˆå™¨ï¼ˆiOS Safariã€Android Chromeï¼‰

### æ€§èƒ½æµ‹è¯•

- [ ] é¦–é¡µåŠ è½½æ—¶é—´æ— æ˜æ˜¾å¢åŠ 
- [ ] API å“åº”æ—¶é—´æ— æ˜æ˜¾å¢åŠ 
- [ ] æœåŠ¡å™¨ CPU/å†…å­˜ä½¿ç”¨ç‡æ­£å¸¸

### å®‰å…¨æµ‹è¯•

- [ ] å®‰å…¨å“åº”å¤´å·²æ·»åŠ 
- [ ] ç‰ˆæœ¬ä¿¡æ¯å·²éšè—
- [ ] ä¸å®‰å…¨ HTTP æ–¹æ³•å·²è¢«ç¦æ­¢
- [ ] ç›®å½•åˆ—å‡ºå·²å…³é—­

### æ—¥å¿—æ£€æŸ¥

- [ ] é”™è¯¯æ—¥å¿—æ— å¼‚å¸¸å¢åŠ 
- [ ] è®¿é—®æ—¥å¿—æµé‡æ­£å¸¸
- [ ] æ— ç”¨æˆ·æŠ•è¯‰åé¦ˆ
```

---

### 5ï¸âƒ£ ä¼ä¸šçº§å˜æ›´ç®¡ç†æµç¨‹

#### 5.1 å˜æ›´ç®¡ç†æœ€ä½³å®è·µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å˜æ›´è¯·æ±‚                         â”‚
â”‚  - è¯„ä¼°å˜æ›´å¿…è¦æ€§                                  â”‚
â”‚  - ç¼–å†™å˜æ›´ææ¡ˆ                                    â”‚
â”‚  - é£é™©è¯„ä¼°                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æŠ€æœ¯è¯„å®¡                         â”‚
â”‚  - æŠ€æœ¯å¯è¡Œæ€§åˆ†æ                                  â”‚
â”‚  - èµ„æºè¯„ä¼°ï¼ˆæ—¶é—´ã€äººåŠ›ï¼‰                          â”‚
â”‚  - å½±å“èŒƒå›´è¯„ä¼°                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å®‰å…¨è¯„å®¡                         â”‚
â”‚  - å®‰å…¨åŠ å›ºæœ‰æ•ˆæ€§è¯„ä¼°                              â”‚
â”‚  - æ½œåœ¨å®‰å…¨é£é™©è¯„ä¼°                                â”‚
â”‚  - åˆè§„æ€§æ£€æŸ¥                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ä¸šåŠ¡å®¡æ‰¹                         â”‚
â”‚  - ä¸šåŠ¡å½±å“è¯„ä¼°                                    â”‚
â”‚  - ç”¨æˆ·é€šçŸ¥è®¡åˆ’                                    â”‚
â”‚  - ç»´æŠ¤çª—å£ç¡®è®¤                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   é¢„å‘å¸ƒæµ‹è¯•                       â”‚
â”‚  - åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯                                  â”‚
â”‚  - æ‰§è¡Œå›å½’æµ‹è¯•                                    â”‚
â”‚  - æ€§èƒ½æµ‹è¯•                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ­£å¼å‘å¸ƒ                         â”‚
â”‚  - æ‰§è¡Œå˜æ›´                                        â”‚
â”‚  - å¤éªŒåŠ å›ºæ•ˆæœ                                    â”‚
â”‚  - ç›‘æ§ç³»ç»ŸçŠ¶æ€                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å‘å¸ƒåå®¡æŸ¥                       â”‚
â”‚  - 24 å°æ—¶ç›‘æ§æœŸ                                   â”‚
â”‚  - ç”¨æˆ·åé¦ˆæ”¶é›†                                    â”‚
â”‚  - å˜æ›´è®°å½•å½’æ¡£                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 5.2 å˜æ›´åˆ†ç±»ä¸å®¡æ‰¹æƒé™

| å˜æ›´ç±»å‹ | é£é™©ç­‰çº§ | å®¡æ‰¹æµç¨‹ | ç¤ºä¾‹ |
|---------|---------|---------|------|
| **æ ‡å‡†å˜æ›´** | ä½ | æŠ€æœ¯å®¡æ‰¹ | ä¿®æ”¹å¯†ç ç­–ç•¥ã€æ·»åŠ é˜²ç«å¢™è§„åˆ™ |
| **é‡å¤§å˜æ›´** | ä¸­ | æŠ€æœ¯ + å®‰å…¨ + ä¸šåŠ¡ | å‡çº§ Nginx ç‰ˆæœ¬ã€ä¿®æ”¹æ ¸å¿ƒé…ç½® |
| **ç´§æ€¥å˜æ›´** | é«˜ | ç´§æ€¥å®¡æ‰¹ + äº‹åæŠ¥å‘Š | ä¿®å¤å·²åˆ©ç”¨çš„ 0-day æ¼æ´ |

---

## å®è·µä»»åŠ¡ï¼ˆåˆæ³•æˆæƒèŒƒå›´å†…ï¼‰

> **æ³¨æ„**ï¼šè¯·åœ¨ä½ è‡ªå·±çš„æµ‹è¯•ç¯å¢ƒæˆ–æˆæƒé¶åœºä¸­æ‰§è¡Œä»¥ä¸‹ä»»åŠ¡ã€‚

---

### ä»»åŠ¡ 1ï¼ˆå¿…åšï¼‰ï¼šåŠ å›ºå‰åŸºçº¿æ‰«æ

**ç›®æ ‡**ï¼šå¯¹æµ‹è¯• Web æœåŠ¡å™¨æ‰§è¡ŒåŠ å›ºå‰çš„åŸºçº¿æ‰«æï¼Œå»ºç«‹åŸºçº¿æ•°æ®ã€‚

**æ­¥éª¤**ï¼š

1. **å¯åŠ¨æµ‹è¯•æœåŠ¡å™¨**

```bash
# ä½¿ç”¨ Python å¯åŠ¨ç®€å• HTTP æœåŠ¡å™¨ï¼ˆæ¨¡æ‹ŸæœªåŠ å›ºçŠ¶æ€ï¼‰
python -m http.server 8080
```

2. **æ‰§è¡ŒåŸºçº¿æ£€æŸ¥**

```bash
cd baseline_checker
python main.py --config config/targets.json --output results/before
```

**é¢„æœŸè¾“å‡º**ï¼š

```
åŠ è½½äº† 1 ä¸ªæ‰«æç›®æ ‡

============================================================
æ‰«æç›®æ ‡: æœ¬æœºæµ‹è¯• (web)
============================================================
  âŒ [ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²] å‘ç°ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²
  âŒ [å®‰å…¨å“åº”å¤´æ£€æŸ¥] ç¼ºå°‘ 3 ä¸ªå®‰å…¨å“åº”å¤´

============================================================
æŠ¥å‘Šç”Ÿæˆå®Œæˆï¼
============================================================
âœ… CSV æŠ¥å‘Š: results/before/baseline_report_20260120_100000.csv
âœ… JSON æŠ¥å‘Š: results/before/baseline_report_20260120_100000.json
```

3. **è®°å½•åŸºçº¿æ•°æ®**

```bash
# å¤åˆ¶æŠ¥å‘Šåˆ°åŸºçº¿ç›®å½•
mkdir baseline
cp results/before/baseline_report_*.json baseline/
cp results/before/baseline_report_*.csv baseline/

# è®°å½•å½“å‰æœåŠ¡çŠ¶æ€
systemctl status nginx > baseline/nginx_status_before.txt
```

---

### ä»»åŠ¡ 2ï¼ˆå¿…åšï¼‰ï¼šæ‰§è¡Œå®‰å…¨åŠ å›º

**ç›®æ ‡**ï¼šæ ¹æ® Day025 çš„å†…å®¹é…ç½® Web æœåŠ¡å™¨å®‰å…¨åŠ å›ºã€‚

**æ­¥éª¤**ï¼š

1. **å¤‡ä»½å½“å‰é…ç½®**

```bash
# Nginx
sudo cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.backup_$(date +%Y%m%d_%H%M%S)

# æˆ–ç®€å• HTTP æœåŠ¡å™¨æ— éœ€é…ç½®ï¼Œç›´æ¥è¿›å…¥ä¸‹ä¸€æ­¥
```

2. **åº”ç”¨åŠ å›ºæªæ–½**

å¦‚æœä½¿ç”¨ Nginxï¼ŒæŒ‰ç…§ Day025 çš„å†…å®¹ä¿®æ”¹é…ç½®ï¼š

```nginx
http {
    server_tokens off;
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
}
```

**æ³¨æ„**ï¼šå¦‚æœä½¿ç”¨ Python HTTP æœåŠ¡å™¨ï¼Œæ— æ³•ç›´æ¥é…ç½®å®‰å…¨å“åº”å¤´ã€‚å»ºè®®ï¼š
- ä½¿ç”¨ Nginx åå‘ä»£ç†
- æˆ–ä½¿ç”¨ Flask/FastAPI ç¼–å†™ç®€å•çš„å®‰å…¨ Web æœåŠ¡å™¨

**ç¤ºä¾‹ï¼šä½¿ç”¨ Flask æ·»åŠ å®‰å…¨å“åº”å¤´**

```python
from flask import Flask

app = Flask(__name__)

@app.route('/')
def index():
    response = app.make_response('Hello, World!')
    response.headers['X-Frame-Options'] = 'SAMEORIGIN'
    response.headers['X-Content-Type-Options'] = 'nosniff'
    response.headers['X-XSS-Protection'] = '1; mode=block'
    return response

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080)
```

3. **é‡å¯æœåŠ¡**

```bash
# Nginx
sudo systemctl restart nginx
sudo systemctl status nginx

# Flaskï¼ˆç›´æ¥è¿è¡Œï¼‰
python secure_server.py
```

4. **å¤‡ä»½åŠ å›ºåé…ç½®**

```bash
# Nginx
sudo cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.hardened_$(date +%Y%m%d_%H%M%S)
```

---

### ä»»åŠ¡ 3ï¼ˆå¿…åšï¼‰ï¼šåŠ å›ºåå¤éªŒæ‰«æ

**ç›®æ ‡**ï¼šæ‰§è¡ŒåŠ å›ºåçš„åŸºçº¿æ£€æŸ¥ï¼ŒéªŒè¯åŠ å›ºæ•ˆæœã€‚

**æ­¥éª¤**ï¼š

1. **æ‰§è¡Œå¤éªŒæ‰«æ**

```bash
python main.py --config config/targets.json --output results/after
```

**é¢„æœŸè¾“å‡º**ï¼š

```
åŠ è½½äº† 1 ä¸ªæ‰«æç›®æ ‡

============================================================
æ‰«æç›®æ ‡: æœ¬æœºæµ‹è¯• (web)
============================================================
  âœ… [ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²] æœªå‘ç°ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²
  âœ… [å®‰å…¨å“åº”å¤´æ£€æŸ¥] æ‰€æœ‰å®‰å…¨å“åº”å¤´å·²é…ç½®

============================================================
æŠ¥å‘Šç”Ÿæˆå®Œæˆï¼
============================================================
âœ… CSV æŠ¥å‘Š: results/after/baseline_report_20260120_103000.csv
âœ… JSON æŠ¥å‘Š: results/after/baseline_report_20260120_103000.json
```

2. **è®°å½•å¤éªŒæ•°æ®**

```bash
# å¤åˆ¶æŠ¥å‘Šåˆ°å¤éªŒç›®å½•
mkdir retest
cp results/after/baseline_report_*.json retest/
cp results/after/baseline_report_*.csv retest/

# è®°å½•æœåŠ¡çŠ¶æ€
systemctl status nginx > retest/nginx_status_after.txt
```

---

### ä»»åŠ¡ 4ï¼ˆå¿…åšï¼‰ï¼šå¯¹æ¯”åŠ å›ºæ•ˆæœ

**ç›®æ ‡**ï¼šå¯¹æ¯”åŠ å›ºå‰åçš„æ‰«æç»“æœï¼Œåˆ†æåŠ å›ºæ•ˆæœã€‚

**æ­¥éª¤**ï¼š

1. **ä½¿ç”¨å¯¹æ¯”è„šæœ¬**

å°†å¯¹æ¯”è„šæœ¬ä¿å­˜ä¸º `compare_reports.py`ï¼š

```python
#!/usr/bin/env python3
import json
import sys
from pathlib import Path

def compare_reports(before_file: str, after_file: str):
    with open(before_file, "r", encoding="utf-8") as f:
        before_data = json.load(f)
    
    with open(after_file, "r", encoding="utf-8") as f:
        after_data = json.load(f)
    
    print("=" * 60)
    print("åŠ å›ºæ•ˆæœå¯¹æ¯”æŠ¥å‘Š")
    print("=" * 60)
    print(f"åŠ å›ºå‰: {before_data['report_time']}")
    print(f"åŠ å›ºå: {after_data['report_time']}")
    print("=" * 60)
    
    before_checks = before_data["targets"][0]["checks"]
    after_checks = after_data["targets"][0]["checks"]
    
    before_map = {c["name"]: c for c in before_checks}
    after_map = {c["name"]: c for c in after_checks}
    
    fixed = []
    still_failed = []
    new_failed = []
    
    for check_name in before_map:
        before = before_map[check_name]
        after = after_map.get(check_name)
        
        if after:
            if before["status"] == "failed" and after["status"] == "passed":
                fixed.append(check_name)
            elif before["status"] == "failed" and after["status"] == "failed":
                still_failed.append(check_name)
    
    for check_name in after_map:
        if check_name not in before_map and after_map[check_name]["status"] == "failed":
            new_failed.append(check_name)
    
    print(f"\nâœ… å·²ä¿®å¤ ({len(fixed)} ä¸ª)")
    for item in fixed:
        print(f"  + {item}")
    
    print(f"\nâŒ ä»ç„¶å¤±è´¥ ({len(still_failed)} ä¸ª)")
    for item in still_failed:
        print(f"  - {item}")
    
    print(f"\nâš ï¸  æ–°å‘ç°é—®é¢˜ ({len(new_failed)} ä¸ª)")
    for item in new_failed:
        print(f"  ! {item}")
    
    # è®¡ç®—é€šè¿‡ç‡
    before_passed = sum(1 for c in before_checks if c["status"] == "passed")
    after_passed = sum(1 for c in after_checks if c["status"] == "passed")
    
    before_rate = before_passed / len(before_checks) * 100 if before_checks else 0
    after_rate = after_passed / len(after_checks) * 100 if after_checks else 0
    
    print(f"\n{'=' * 60}")
    print(f"é€šè¿‡ç‡æå‡: {before_rate:.1f}% â†’ {after_rate:.1f}% (+{after_rate - before_rate:.1f}%)")
    print(f"{'=' * 60}")

if __name__ == "__main__":
    if len(sys.argv) != 3:
        print("ç”¨æ³•: python compare_reports.py <before.json> <after.json>")
        sys.exit(1)
    
    compare_reports(sys.argv[1], sys.argv[2])
```

2. **è¿è¡Œå¯¹æ¯”**

```bash
python compare_reports.py \
    baseline/baseline_report_20260120_100000.json \
    retest/baseline_report_20260120_103000.json
```

**é¢„æœŸè¾“å‡º**ï¼š

```
============================================================
åŠ å›ºæ•ˆæœå¯¹æ¯”æŠ¥å‘Š
============================================================
åŠ å›ºå‰: 2026-01-20T10:00:00
åŠ å›ºå: 2026-01-20T10:30:00
============================================================

âœ… å·²ä¿®å¤ (2 ä¸ª)
  + ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²
  + å®‰å…¨å“åº”å¤´æ£€æŸ¥

âŒ ä»ç„¶å¤±è´¥ (0 ä¸ª)

âš ï¸  æ–°å‘ç°é—®é¢˜ (0 ä¸ª)

============================================================
é€šè¿‡ç‡æå‡: 33.3% â†’ 100.0% (+66.7%)
============================================================
```

---

### ä»»åŠ¡ 5ï¼ˆå¿…åšï¼‰ï¼šä¸šåŠ¡å›å½’æµ‹è¯•

**ç›®æ ‡**ï¼šéªŒè¯åŠ å›ºæªæ–½æ˜¯å¦å½±å“ä¸šåŠ¡åŠŸèƒ½ã€‚

**æ­¥éª¤**ï¼š

1. **åŠŸèƒ½æµ‹è¯•**

```bash
# æµ‹è¯•é¦–é¡µè®¿é—®
curl -I http://localhost:8080/

# æµ‹è¯•é™æ€èµ„æº
curl -I http://localhost:8080/style.css

# æµ‹è¯• API ç«¯ç‚¹ï¼ˆå¦‚æœæœ‰ï¼‰
curl http://localhost:8080/api/status
```

2. **æµè§ˆå™¨æµ‹è¯•**

- æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:8080`
- æ£€æŸ¥é¡µé¢æ˜¯å¦æ­£å¸¸åŠ è½½
- ä½¿ç”¨å¼€å‘è€…å·¥å…·æ£€æŸ¥å“åº”å¤´

3. **æ£€æŸ¥æ—¥å¿—**

```bash
# æŸ¥çœ‹è®¿é—®æ—¥å¿—
tail -f /var/log/nginx/access.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/error.log
```

---

### ä»»åŠ¡ 6ï¼ˆå¿…åšï¼‰ï¼šæ’°å†™å˜æ›´è®°å½•

**ç›®æ ‡**ï¼šæ ¹æ®å®é™…æ‰§è¡Œæƒ…å†µï¼Œæ’°å†™å®Œæ•´çš„å˜æ›´è®°å½•ã€‚

**æ­¥éª¤**ï¼š

åˆ›å»ºå˜æ›´è®°å½•æ–‡ä»¶ `change_record_CR-2026-001.md`ï¼š

```markdown
# å®‰å…¨é…ç½®å˜æ›´è®°å½•

## åŸºæœ¬ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| å˜æ›´ç¼–å· | CR-2026-001 |
| å˜æ›´æ ‡é¢˜ | Web æœåŠ¡å™¨å®‰å…¨åŠ å›º |
| ç”³è¯·äºº | [ä½ çš„å§“å] |
| ç”³è¯·æ—¥æœŸ | 2026-01-20 |
| æ‰§è¡Œæ—¥æœŸ | 2026-01-20 |
| ä¼˜å…ˆçº§ | é«˜ |

## å˜æ›´å†…å®¹

| åºå· | å˜æ›´é¡¹ | é£é™©ç­‰çº§ |
|------|--------|---------|
| 1 | éšè—ç‰ˆæœ¬ä¿¡æ¯ | ä½ |
| 2 | æ·»åŠ  X-Frame-Options å“åº”å¤´ | ä¸­ |
| 3 | æ·»åŠ  X-Content-Type-Options å“åº”å¤´ | ä¸­ |
| 4 | æ·»åŠ  X-XSS-Protection å“åº”å¤´ | ä½ |

## å›æ»šæ–¹æ¡ˆ

### å¤‡ä»½æ–‡ä»¶
- `/etc/nginx/nginx.conf.backup_20260120_100000`

### å›æ»šæ­¥éª¤
1. æ¢å¤é…ç½®æ–‡ä»¶
2. æµ‹è¯•é…ç½®è¯­æ³•
3. é‡å¯æœåŠ¡
4. éªŒè¯æœåŠ¡çŠ¶æ€

## å¤éªŒç»“æœ

| æ£€æŸ¥é¡¹ | åŠ å›ºå‰ | åŠ å›ºå | çŠ¶æ€ |
|--------|-------|-------|------|
| ç‰ˆæœ¬ä¿¡æ¯æ³„éœ² | âŒ å¤±è´¥ | âœ… é€šè¿‡ | å·²ä¿®å¤ |
| å®‰å…¨å“åº”å¤´æ£€æŸ¥ | âŒ å¤±è´¥ | âœ… é€šè¿‡ | å·²ä¿®å¤ |

é€šè¿‡ç‡æå‡: 33.3% â†’ 100.0%

## ä¸šåŠ¡å›å½’æµ‹è¯•

| æµ‹è¯•é¡¹ | ç»“æœ |
|--------|------|
| é¦–é¡µè®¿é—® | âœ… æ­£å¸¸ |
| å“åº”å¤´æ£€æŸ¥ | âœ… æ­£å¸¸ |

## æ€»ç»“

æœ¬æ¬¡å˜æ›´æˆåŠŸå®Œæˆï¼ŒåŠ å›ºæªæ–½å…¨éƒ¨ç”Ÿæ•ˆï¼Œä¸šåŠ¡åŠŸèƒ½æ­£å¸¸ã€‚
```

---

### ä»»åŠ¡ 7ï¼ˆè¿›é˜¶ï¼‰ï¼šé…ç½®æ–‡ä»¶å·®å¼‚åˆ†æ

**ç›®æ ‡**ï¼šä½¿ç”¨ä¸“ä¸šå·¥å…·åˆ†æé…ç½®æ–‡ä»¶çš„å˜åŒ–ã€‚

**æ­¥éª¤**ï¼š

1. **ä½¿ç”¨ `git diff` å¯¹æ¯”**

```bash
# å¦‚æœé…ç½®æ–‡ä»¶åœ¨ Git ä»“åº“ä¸­
git diff /etc/nginx/nginx.conf
```

2. **ä½¿ç”¨ `vimdiff` å¯è§†åŒ–å¯¹æ¯”**

```bash
vimdiff /etc/nginx/nginx.conf.backup /etc/nginx/nginx.conf
```

3. **ç”Ÿæˆå˜æ›´æŠ¥å‘Š**

```bash
diff -u /etc/nginx/nginx.conf.backup /etc/nginx/nginx.conf > config_change.diff
```

---

## å·©å›ºç»ƒä¹ ï¼ˆé¢˜ä¸å¤ç›˜ï¼‰

---

### ç»ƒä¹  1ï¼šå¦‚ä½•å¤„ç†åŠ å›ºå¼•å‘çš„å…¼å®¹é—®é¢˜ï¼Ÿ

**æ€è·¯æç¤º**ï¼š

- é—®é¢˜å®šä½ï¼ˆæ—¥å¿—ã€é”™è¯¯ä¿¡æ¯ï¼‰
- å½±å“èŒƒå›´è¯„ä¼°ï¼ˆå“ªäº›ç”¨æˆ·/åŠŸèƒ½å—å½±å“ï¼‰
- è§£å†³æ–¹æ¡ˆé€‰æ‹©ï¼ˆé™çº§ã€é…ç½®è°ƒæ•´ã€ç»•è¿‡ï¼‰
- å›æ»šå†³ç­–ï¼ˆæ˜¯å¦ç«‹å³å›æ»šï¼‰

---

### ç»ƒä¹  2ï¼šæ’°å†™å˜æ›´è®°å½•ç¤ºä¾‹

**ä»»åŠ¡**ï¼šä¸ºä»¥ä¸‹åœºæ™¯æ’°å†™å˜æ›´è®°å½•ã€‚

**åœºæ™¯**ï¼šæ•°æ®åº“æœåŠ¡å™¨åŠ å›ºï¼Œä¿®æ”¹ MySQL é…ç½®ï¼š
- ç¦ç”¨ç¬¦å·é“¾æ¥
- é™åˆ¶æœ€å¤§è¿æ¥æ•°
- å¯ç”¨æŸ¥è¯¢æ—¥å¿—

**è¦æ±‚**ï¼šåŒ…å«å˜æ›´å†…å®¹ã€å›æ»šæ–¹æ¡ˆã€å¤éªŒç»“æœã€‚

---

### ç»ƒä¹  3ï¼šè®¾è®¡å˜æ›´å®¡æ‰¹æµç¨‹

**ä»»åŠ¡**ï¼šä¸ºä½ çš„å›¢é˜Ÿè®¾è®¡ä¸€ä¸ªå˜æ›´å®¡æ‰¹æµç¨‹ã€‚

**è¦æ±‚**ï¼š
- å®šä¹‰å˜æ›´ç±»å‹ï¼ˆæ ‡å‡†ã€é‡å¤§ã€ç´§æ€¥ï¼‰
- æ˜ç¡®å„ç±»å‹çš„å®¡æ‰¹è·¯å¾„
- å®šä¹‰å›æ»šè§¦å‘æ¡ä»¶

**æ€è·¯æç¤º**ï¼š

```
å˜æ›´ç±»å‹ â†’ é£é™©ç­‰çº§ â†’ å®¡æ‰¹æµç¨‹
æ ‡å‡†å˜æ›´ â†’ ä½ â†’ æŠ€æœ¯ä¸»ç®¡å®¡æ‰¹
é‡å¤§å˜æ›´ â†’ ä¸­ â†’ æŠ€æœ¯ + å®‰å…¨ + ä¸šåŠ¡å®¡æ‰¹
ç´§æ€¥å˜æ›´ â†’ é«˜ â†’ ç´§æ€¥å®¡æ‰¹ + äº‹åæŠ¥å‘Š
```

---

### ç»ƒä¹  4ï¼šå›æ»šæ¼”ç»ƒ

**ä»»åŠ¡**ï¼šåœ¨æµ‹è¯•ç¯å¢ƒä¸­æ¼”ç»ƒå›æ»šæµç¨‹ã€‚

**æ­¥éª¤**ï¼š
1. åº”ç”¨åŠ å›ºé…ç½®
2. æ¨¡æ‹ŸåŠ å›ºå¤±è´¥ï¼ˆå¦‚ä¿®æ”¹ç«¯å£ä¸ºæ— æ•ˆå€¼ï¼‰
3. æ‰§è¡Œå›æ»šæ“ä½œ
4. éªŒè¯å›æ»šæ˜¯å¦æˆåŠŸ

---

## è¯„ä¼°æ ‡å‡†ï¼ˆè¾¾æˆåˆ¤å®šï¼‰

- âœ… å®Œæˆäº†åŠ å›ºå‰åŸºçº¿æ‰«æ
- âœ… æ‰§è¡Œäº†å®‰å…¨åŠ å›ºé…ç½®
- âœ… å®Œæˆäº†åŠ å›ºåå¤éªŒæ‰«æ
- âœ… ç”Ÿæˆäº†åŠ å›ºæ•ˆæœå¯¹æ¯”æŠ¥å‘Š
- âœ… å®Œæˆäº†ä¸šåŠ¡å›å½’æµ‹è¯•
- âœ… æ’°å†™äº†å®Œæ•´çš„å˜æ›´è®°å½•
- âœ… æ˜ç¡®äº†å›æ»šæ–¹æ¡ˆ

---

## å­¦ä¹ æˆæœè¾¾æˆæƒ…å†µï¼ˆç”±å­¦ä¹ è€…å¡«å†™ï¼‰

---

### æˆªå›¾ä¸è¯æ®

- [ ] åŠ å›ºå‰åŸºçº¿æ‰«æè¾“å‡ºæˆªå›¾
- [ ] åŠ å›ºåå¤éªŒæ‰«æè¾“å‡ºæˆªå›¾
- [ ] é…ç½®æ–‡ä»¶å¯¹æ¯”ï¼ˆdiff è¾“å‡ºï¼‰
- [ ] åŠ å›ºæ•ˆæœå¯¹æ¯”æŠ¥å‘Šè¾“å‡º
- [ ] ä¸šåŠ¡å›å½’æµ‹è¯•æˆªå›¾
- [ ] å˜æ›´è®°å½•æ–‡æ¡£ï¼ˆMarkdown æ–‡ä»¶ï¼‰

---

### å…³é”®å‘½ä»¤ä¸è¾“å‡ºï¼ˆç²˜è´´å…³é”®ç‰‡æ®µï¼‰

**åŠ å›ºå‰æ‰«æ**ï¼š

```bash
$ python main.py --config config/targets.json --output results/before
åŠ è½½äº† 1 ä¸ªæ‰«æç›®æ ‡

============================================================
æ‰«æç›®æ ‡: æœ¬æœºæµ‹è¯• (web)
============================================================
  âŒ [ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²] å‘ç°ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²
  âŒ [å®‰å…¨å“åº”å¤´æ£€æŸ¥] ç¼ºå°‘ 3 ä¸ªå®‰å…¨å“åº”å¤´

============================================================
æŠ¥å‘Šç”Ÿæˆå®Œæˆï¼
============================================================
âœ… CSV æŠ¥å‘Š: results/before/baseline_report_20260120_100000.csv
âœ… JSON æŠ¥å‘Š: results/before/baseline_report_20260120_100000.json
```

**é…ç½®æ–‡ä»¶å¯¹æ¯”**ï¼š

```bash
$ diff nginx.conf.backup nginx.conf
12c12,15
<     include       /etc/nginx/mime.types;
---
>     include       /etc/nginx/mime.types;
>     server_tokens off;
>     add_header X-Frame-Options "SAMEORIGIN" always;
>     add_header X-Content-Type-Options "nosniff" always;
```

**åŠ å›ºåæ‰«æ**ï¼š

```bash
$ python main.py --config config/targets.json --output results/after
åŠ è½½äº† 1 ä¸ªæ‰«æç›®æ ‡

============================================================
æ‰«æç›®æ ‡: æœ¬æœºæµ‹è¯• (web)
============================================================
  âœ… [ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²] æœªå‘ç°ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²
  âœ… [å®‰å…¨å“åº”å¤´æ£€æŸ¥] æ‰€æœ‰å®‰å…¨å“åº”å¤´å·²é…ç½®

============================================================
æŠ¥å‘Šç”Ÿæˆå®Œæˆï¼
============================================================
```

**åŠ å›ºæ•ˆæœå¯¹æ¯”**ï¼š

```bash
$ python compare_reports.py \
    baseline/baseline_report_20260120_100000.json \
    retest/baseline_report_20260120_103000.json
============================================================
åŠ å›ºæ•ˆæœå¯¹æ¯”æŠ¥å‘Š
============================================================
åŠ å›ºå‰: 2026-01-20T10:00:00
åŠ å›ºå: 2026-01-20T10:30:00
============================================================

âœ… å·²ä¿®å¤ (2 ä¸ª)
  + ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²
  + å®‰å…¨å“åº”å¤´æ£€æŸ¥

âŒ ä»ç„¶å¤±è´¥ (0 ä¸ª)

âš ï¸  æ–°å‘ç°é—®é¢˜ (0 ä¸ª)

============================================================
é€šè¿‡ç‡æå‡: 33.3% â†’ 100.0% (+66.7%)
============================================================
```

**å›å½’æµ‹è¯•**ï¼š

```bash
$ curl -I http://localhost:8080/
HTTP/1.1 200 OK
Server: nginx
Date: Mon, 20 Jan 2026 10:35:00 GMT
Content-Type: text/html
X-Frame-Options: SAMEORIGIN
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
```

---

### ç»“è®ºä¸åæ€

**æˆ‘ä»Šå¤©ææ¸…æ¥šäº†**ï¼š

- åŠ å›ºå¤éªŒæ˜¯ç¡®è®¤å®‰å…¨æªæ–½æ˜¯å¦ç”Ÿæ•ˆçš„å…³é”®æ­¥éª¤
- å˜æ›´è®°å½•å¯¹äºå®¡è®¡ã€å›æº¯å’Œåˆè§„éå¸¸é‡è¦
- å¿…é¡»æœ‰æ˜ç¡®çš„å›æ»šæ–¹æ¡ˆï¼Œä»¥åº”å¯¹åŠ å›ºå¤±è´¥çš„é£é™©
- ä¸šåŠ¡å›å½’æµ‹è¯•å¯ä»¥æ£€æµ‹åŠ å›ºæªæ–½æ˜¯å¦å½±å“æ­£å¸¸åŠŸèƒ½

**æˆ‘å·®ç‚¹ææ··çš„æ˜¯**ï¼š

- æœ€åˆä¸ç†è§£"å¤éªŒ"å’Œ"å›å½’æµ‹è¯•"çš„åŒºåˆ«
- ä»¥ä¸ºåŠ å›ºååªè¦æ‰«æé€šè¿‡å°±è¡Œäº†ï¼Œå¿½ç•¥äº†ä¸šåŠ¡åŠŸèƒ½æµ‹è¯•
- ä¸æ¸…æ¥šå˜æ›´è®°å½•åº”è¯¥åŒ…å«å“ªäº›å†…å®¹

**æ˜å¤©æˆ‘è¦ç»§ç»­è¡¥çš„æ˜¯**ï¼š

- å­¦ä¹  WAFï¼ˆWeb åº”ç”¨é˜²ç«å¢™ï¼‰çš„åŸç†ä¸é…ç½®ï¼ˆDay028ï¼‰
- äº†è§£å¸¸è§ Web æ¼æ´ï¼ˆSQL æ³¨å…¥ã€XSSã€CSRFï¼‰çš„æ£€æµ‹ä¸é˜²æŠ¤ï¼ˆDay029-031ï¼‰
- å­¦ä¹ å®‰å…¨åŠ å›ºçš„æŒç»­æ€§ç›‘æ§ï¼ˆDay032ï¼‰

**æœ¬æ¬¡å­¦ä¹ è€—æ—¶**ï¼šçº¦ 3 å°æ—¶

**æŒæ¡ç¨‹åº¦è‡ªè¯„**ï¼š

- [ ] ğŸ˜• ç†è§£äº†åŸºæœ¬æ¦‚å¿µï¼Œä½†å®è·µä¸ç†Ÿç»ƒ
- [ ] ğŸ™‚ å®Œæˆäº†åŠ å›ºå‰åæ‰«æ
- [ ] ğŸ˜ƒ å®Œæˆäº†æ‰€æœ‰ä»»åŠ¡å¹¶ç†è§£å¤éªŒæµç¨‹
- [ ] ğŸ¤© é¢å¤–è®¾è®¡äº†è‡ªåŠ¨åŒ–å›æ»šè„šæœ¬

---

## é›†ä¸­å‚è€ƒç­”æ¡ˆï¼ˆå«æ€è·¯ï¼‰

---

### ç»ƒä¹  1 å‚è€ƒç­”æ¡ˆï¼šå¦‚ä½•å¤„ç†åŠ å›ºå¼•å‘çš„å…¼å®¹é—®é¢˜ï¼Ÿ

**é—®é¢˜å®šä½**ï¼š

```bash
# 1. æ£€æŸ¥é”™è¯¯æ—¥å¿—
tail -100 /var/log/nginx/error.log

# 2. æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status nginx -l

# 3. æ£€æŸ¥ç«¯å£ç›‘å¬
ss -tlnp | grep :80

# 4. æµ‹è¯•æœåŠ¡å“åº”
curl -v http://localhost/
```

**å½±å“èŒƒå›´è¯„ä¼°**ï¼š

| é—®é¢˜ç±»å‹ | å½±å“èŒƒå›´ | è¯„ä¼°æ–¹æ³• |
|---------|---------|---------|
| æœåŠ¡æ— æ³•å¯åŠ¨ | æ‰€æœ‰ç”¨æˆ· | systemctl statusã€curl æµ‹è¯• |
| éƒ¨åˆ†é¡µé¢åŠ è½½å¤±è´¥ | ç‰¹å®šåŠŸèƒ½ | æµè§ˆå™¨æµ‹è¯•ã€ç›‘æ§æ—¥å¿— |
| æ€§èƒ½ä¸‹é™ | æ‰€æœ‰ç”¨æˆ· | æ€§èƒ½æµ‹è¯•ã€å“åº”æ—¶é—´ç›‘æ§ |
| æŸäº›æµè§ˆå™¨æ— æ³•è®¿é—® | ç‰¹å®šç”¨æˆ· | å…¼å®¹æ€§æµ‹è¯•ï¼ˆChrome/Firefox/Safariï¼‰ |

**è§£å†³æ–¹æ¡ˆé€‰æ‹©**ï¼š

```
é—®é¢˜ä¸¥é‡ç¨‹åº¦ â†’ è§£å†³ç­–ç•¥
â”œâ”€ æœåŠ¡ä¸­æ–­ â†’ ç«‹å³å›æ»š
â”œâ”€ éƒ¨åˆ†åŠŸèƒ½å¤±æ•ˆ â†’ è¯„ä¼°å›æ»š vs ä¸´æ—¶ç»•è¿‡
â”œâ”€ æ€§èƒ½ä¸‹é™ â†’ ç›‘æ§è§‚å¯Ÿï¼Œå¿…è¦æ—¶å›æ»š
â””â”€ å…¼å®¹æ€§é—®é¢˜ â†’ é…ç½®é™çº§æˆ–å…¼å®¹æ¨¡å¼
```

**ç¤ºä¾‹ï¼šCSP å¼•èµ·çš„å…¼å®¹æ€§é—®é¢˜**

```nginx
# é—®é¢˜ï¼šæŸäº›æ—§æµè§ˆå™¨ä¸æ”¯æŒ CSPï¼Œå¯¼è‡´èµ„æºåŠ è½½å¤±è´¥
add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline';";

# è§£å†³æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ Report-Only æ¨¡å¼æµ‹è¯•
add_header Content-Security-Policy-Report-Only "default-src 'self'; script-src 'self' 'unsafe-inline';";

# è§£å†³æ–¹æ¡ˆ 2ï¼šä¸ºæ—§æµè§ˆå™¨é™çº§
map $http_user_agent $csp_policy {
    default "default-src 'self';";
    "~*MSIE [6-9]" "";
}

add_header Content-Security-Policy $csp_policy always;
```

**å›æ»šå†³ç­–çŸ©é˜µ**ï¼š

| åœºæ™¯ | ç«‹å³å›æ»š | è§‚å¯Ÿåå›æ»š | ä¸å›æ»š |
|------|---------|-----------|-------|
| æœåŠ¡æ— æ³•å¯åŠ¨ | âœ… | - | - |
| æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½å¤±æ•ˆ | âœ… | - | - |
| æ¬¡è¦åŠŸèƒ½å¤±æ•ˆ | - | âœ… | - |
| æ€§èƒ½ä¸‹é™ > 50% | âœ… | - | - |
| æ€§èƒ½ä¸‹é™ < 30% | - | âœ… | - |
| å°‘æ•°ç”¨æˆ·æŠ¥å‘Šé—®é¢˜ | - | - | âœ… |

**å›æ»šæ­¥éª¤æ ‡å‡†æµç¨‹**ï¼š

```bash
# 1. é€šçŸ¥ç›¸å…³äººå‘˜
echo "æ‰§è¡Œç´§æ€¥å›æ»šï¼šCR-2026-001" | sendmail admin@example.com

# 2. åœæ­¢æœåŠ¡
sudo systemctl stop nginx

# 3. æ¢å¤å¤‡ä»½é…ç½®
sudo cp /etc/nginx/nginx.conf.backup_20260120 /etc/nginx/nginx.conf

# 4. æµ‹è¯•é…ç½®
sudo nginx -t

# 5. å¯åŠ¨æœåŠ¡
sudo systemctl start nginx

# 6. éªŒè¯æœåŠ¡çŠ¶æ€
sudo systemctl status nginx

# 7. éªŒè¯åŠŸèƒ½
curl -I http://localhost/

# 8. è®°å½•å›æ»šæ“ä½œ
echo "$(date): å›æ»š CR-2026-001" >> /var/log/change_management.log
```

---

### ç»ƒä¹  2 å‚è€ƒç­”æ¡ˆï¼šæ’°å†™å˜æ›´è®°å½•ç¤ºä¾‹

**å˜æ›´è®°å½•æ¨¡æ¿ï¼ˆæ•°æ®åº“æœåŠ¡å™¨åŠ å›ºï¼‰**ï¼š

```markdown
# å®‰å…¨é…ç½®å˜æ›´è®°å½• - æ•°æ®åº“æœåŠ¡å™¨

## åŸºæœ¬ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| å˜æ›´ç¼–å· | CR-2026-002 |
| å˜æ›´æ ‡é¢˜ | MySQL æœåŠ¡å™¨å®‰å…¨åŠ å›º |
| ç”³è¯·äºº | [ä½ çš„å§“å] |
| éƒ¨é—¨ | ä¿¡æ¯å®‰å…¨éƒ¨ |
| ç”³è¯·æ—¥æœŸ | 2026-01-20 |
| é¢„è®¡æ‰§è¡Œæ—¥æœŸ | 2026-01-21 02:00-04:00 |
| ä¼˜å…ˆçº§ | é«˜ |

## å½±å“èŒƒå›´

| é¡¹ç›® | å†…å®¹ |
|------|------|
| å½±å“ç³»ç»Ÿ | æ•°æ®åº“æœåŠ¡å™¨ (192.168.1.50) |
| å½±å“æœåŠ¡ | MySQL æ•°æ®åº“æœåŠ¡ (ç«¯å£ 3306) |
| å½±å“ç”¨æˆ· | æ‰€æœ‰åº”ç”¨ç³»ç»Ÿ |
| å½±å“æ—¶æ®µ | ç»´æŠ¤çª—å£ï¼ˆå‡Œæ™¨ 2:00-4:00ï¼‰ |

## å˜æ›´å†…å®¹

### å˜æ›´å‰é…ç½®

```ini
# /etc/mysql/my.cnf
[mysqld]
bind-address = 0.0.0.0
max_connections = 151
```

### å˜æ›´åé…ç½®

```ini
# /etc/mysql/my.cnf
[mysqld]
bind-address = 127.0.0.1
max_connections = 200
symbolic-links = 0
general_log = 1
general_log_file = /var/log/mysql/general.log
```

### å˜æ›´é¡¹åˆ—è¡¨

| åºå· | å˜æ›´é¡¹ | é…ç½®æ–‡ä»¶ | é£é™©ç­‰çº§ | è¯´æ˜ |
|------|--------|---------|---------|------|
| 1 | ç¦ç”¨ç¬¦å·é“¾æ¥ | /etc/mysql/my.cnf | ä¸­ | é˜²æ­¢ç¬¦å·é“¾æ¥æ”»å‡» |
| 2 | é™åˆ¶ç›‘å¬åœ°å€ | /etc/mysql/my.cnf | é«˜ | ä»…å…è®¸æœ¬åœ°è¿æ¥ |
| 3 | è°ƒæ•´æœ€å¤§è¿æ¥æ•° | /etc/mysql/my.cnf | ä½ | æé«˜è¿æ¥ä¸Šé™ |
| 4 | å¯ç”¨æŸ¥è¯¢æ—¥å¿— | /etc/mysql/my.cnf | ä¸­ | ä¾¿äºå®¡è®¡ |

## å›æ»šæ–¹æ¡ˆ

### å¤‡ä»½æ–‡ä»¶

- `/etc/mysql/my.cnf.backup_20260121`

### å›æ»šæ­¥éª¤

1. åœæ­¢ MySQL æœåŠ¡ï¼š
   ```bash
   sudo systemctl stop mysql
   ```

2. æ¢å¤é…ç½®æ–‡ä»¶ï¼š
   ```bash
   sudo cp /etc/mysql/my.cnf.backup_20260121 /etc/mysql/my.cnf
   ```

3. å¯åŠ¨ MySQL æœåŠ¡ï¼š
   ```bash
   sudo systemctl start mysql
   ```

4. éªŒè¯æœåŠ¡çŠ¶æ€ï¼š
   ```bash
   sudo systemctl status mysql
   mysql -u root -p -e "SHOW VARIABLES LIKE 'max_connections';"
   ```

### å›æ»šè§¦å‘æ¡ä»¶

- [ ] åº”ç”¨æ— æ³•è¿æ¥æ•°æ®åº“
- [ ] æŸ¥è¯¢æ€§èƒ½æ˜æ˜¾ä¸‹é™ï¼ˆè¶…è¿‡ 50%ï¼‰
- [ ] æ—¥å¿—ç£ç›˜ç©ºé—´ä¸è¶³
- [ ] è¿æ¥æ•°å¼‚å¸¸å¢åŠ 

## å¤éªŒç»“æœ

### åŠ å›ºå‰åŸºçº¿æ‰«æ

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | é£é™©ç­‰çº§ | æ¶ˆæ¯ |
|--------|------|---------|------|
| ç›‘å¬åœ°å€ | âŒ å¤±è´¥ | é«˜ | å¯¹ 0.0.0.0 ç›‘å¬ |
| ç¬¦å·é“¾æ¥ | âŒ å¤±è´¥ | ä¸­ | ç¬¦å·é“¾æ¥å·²å¯ç”¨ |
| æœ€å¤§è¿æ¥æ•° | âš ï¸ è­¦å‘Š | ä½ | è¿æ¥æ•°åå° |

é€šè¿‡ç‡: 0% (0/3)

### åŠ å›ºåå¤éªŒæ‰«æ

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | é£é™©ç­‰çº§ | æ¶ˆæ¯ |
|--------|------|---------|------|
| ç›‘å¬åœ°å€ | âœ… é€šè¿‡ | - | ä»…ç›‘å¬ 127.0.0.1 |
| ç¬¦å·é“¾æ¥ | âœ… é€šè¿‡ | - | ç¬¦å·é“¾æ¥å·²ç¦ç”¨ |
| æœ€å¤§è¿æ¥æ•° | âœ… é€šè¿‡ | - | è¿æ¥æ•°å·²è°ƒæ•´ |

é€šè¿‡ç‡: 100% (3/3)

### å¯¹æ¯”ç»“è®º

- âœ… å·²ä¿®å¤ï¼šç›‘å¬åœ°å€ã€ç¬¦å·é“¾æ¥ã€æœ€å¤§è¿æ¥æ•°
- âœ… æ— æ–°å¢é—®é¢˜
- âœ… é€šè¿‡ç‡ä» 0% æå‡åˆ° 100%

## ä¸šåŠ¡å›å½’æµ‹è¯•

| æµ‹è¯•é¡¹ | æµ‹è¯•ç»“æœ | å¤‡æ³¨ |
|--------|---------|------|
| åº”ç”¨è¿æ¥æ•°æ®åº“ | âœ… æ­£å¸¸ | è¿æ¥æˆåŠŸ |
| åŸºç¡€æŸ¥è¯¢ | âœ… æ­£å¸¸ | å“åº”æ—¶é—´ < 100ms |
| å¹¶å‘è¿æ¥æµ‹è¯• | âœ… æ­£å¸¸ | 200 è¿æ¥æ— å¼‚å¸¸ |
| äº‹åŠ¡æäº¤ | âœ… æ­£å¸¸ | - |

## æ€»ç»“

æœ¬æ¬¡å˜æ›´æˆåŠŸå®Œæˆï¼ŒåŠ å›ºæªæ–½å…¨éƒ¨ç”Ÿæ•ˆï¼Œä¸šåŠ¡åŠŸèƒ½æ­£å¸¸ï¼Œæ— å‰¯ä½œç”¨ã€‚

**åç»­è®¡åˆ’**ï¼š
- 1 å‘¨ï¼šç›‘æ§æ•°æ®åº“æ€§èƒ½å’Œæ—¥å¿—
- 1 ä¸ªæœˆï¼šå®šæœŸæ£€æŸ¥æ—¥å¿—ç£ç›˜ç©ºé—´
- 3 ä¸ªæœˆï¼šè¯„ä¼°æ˜¯å¦éœ€è¦è¿›ä¸€æ­¥åŠ å›º
```

---

### ç»ƒä¹  3 å‚è€ƒç­”æ¡ˆï¼šè®¾è®¡å˜æ›´å®¡æ‰¹æµç¨‹

**å˜æ›´å®¡æ‰¹æµç¨‹è®¾è®¡**ï¼š

```mermaid
graph TD
    A[å˜æ›´è¯·æ±‚] --> B{å˜æ›´ç±»å‹}
    B -->|æ ‡å‡†å˜æ›´| C[æŠ€æœ¯è¯„å®¡]
    B -->|é‡å¤§å˜æ›´| D[æŠ€æœ¯è¯„å®¡]
    B -->|ç´§æ€¥å˜æ›´| E[ç´§æ€¥å®¡æ‰¹]
    
    C --> F[æ‰§è¡Œå˜æ›´]
    D --> G[å®‰å…¨è¯„å®¡]
    D --> H[ä¸šåŠ¡å®¡æ‰¹]
    G --> F
    H --> F
    E --> F
    
    F --> I{æµ‹è¯•ç»“æœ}
    I -->|é€šè¿‡| J[ç¡®è®¤å˜æ›´]
    I -->|å¤±è´¥| K[æ‰§è¡Œå›æ»š]
    
    J --> L[å˜æ›´å½’æ¡£]
    K --> M[äº‹ååˆ†æ]
    M --> L
```

**å˜æ›´ç±»å‹å®šä¹‰**ï¼š

| ç±»å‹ | é£é™©ç­‰çº§ | å½±å“èŒƒå›´ | å®¡æ‰¹æµç¨‹ | ç¤ºä¾‹ |
|------|---------|---------|---------|------|
| **æ ‡å‡†å˜æ›´** | ä½ | å•ä¸ªç³»ç»Ÿ | æŠ€æœ¯ä¸»ç®¡å®¡æ‰¹ | ä¿®æ”¹å¯†ç ç­–ç•¥ã€æ·»åŠ å•ä¸ªé˜²ç«å¢™è§„åˆ™ |
| **é‡å¤§å˜æ›´** | ä¸­-é«˜ | å¤šä¸ªç³»ç»Ÿ/æ ¸å¿ƒä¸šåŠ¡ | æŠ€æœ¯ + å®‰å…¨ + ä¸šåŠ¡ | å‡çº§æ ¸å¿ƒä¸­é—´ä»¶ã€ä¿®æ”¹ç½‘ç»œæ¶æ„ |
| **ç´§æ€¥å˜æ›´** | é«˜ | å·²å‘ç”Ÿå®‰å…¨äº‹ä»¶/ä¸¥é‡æ•…éšœ | ç´§æ€¥å®¡æ‰¹ + äº‹åæŠ¥å‘Š | ä¿®å¤è¢«åˆ©ç”¨çš„ 0-day æ¼æ´ã€æ¢å¤å®•æœºæœåŠ¡ |

**å®¡æ‰¹æƒé™çŸ©é˜µ**ï¼š

| è§’è‰² | æ ‡å‡†å˜æ›´ | é‡å¤§å˜æ›´ | ç´§æ€¥å˜æ›´ |
|------|---------|---------|---------|
| æŠ€æœ¯ä¸»ç®¡ | âœ… ç­¾æ‰¹ | âœ… ç­¾æ‰¹ | âœ… ç­¾æ‰¹ |
| å®‰å…¨è´Ÿè´£äºº | - | âœ… ç­¾æ‰¹ | âœ… äº‹åå®¡æ ¸ |
| ä¸šåŠ¡è´Ÿè´£äºº | - | âœ… ç­¾æ‰¹ | - |
| CTO | - | âœ… æœ€ç»ˆæ‰¹å‡† | âœ… ç´§æ€¥æ‰¹å‡† |

**å›æ»šè§¦å‘æ¡ä»¶æ¸…å•**ï¼š

```markdown
## å›æ»šå†³ç­–æ¸…å•

### ç«‹å³å›æ»šï¼ˆæ— éœ€å®¡æ‰¹ï¼‰
- [ ] æœåŠ¡æ— æ³•å¯åŠ¨
- [ ] æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½å®Œå…¨å¤±æ•ˆ
- [ ] æ•°æ®ä¸¢å¤±æˆ–æŸå
- [ ] å®‰å…¨äº‹ä»¶è¢«è§¦å‘

### è§‚å¯Ÿåå›æ»šï¼ˆéœ€è¯„ä¼°ï¼‰
- [ ] æ¬¡è¦åŠŸèƒ½å¤±æ•ˆ
- [ ] æ€§èƒ½ä¸‹é™è¶…è¿‡ 50%
- [ ] é”™è¯¯ç‡æ˜¾è‘—å¢åŠ 
- [ ] å¤§é‡ç”¨æˆ·æŠ•è¯‰

### ä¸å›æ»šï¼ˆéœ€ç›‘æ§ï¼‰
- [ ] æ€§èƒ½ä¸‹é™ä½äº 30%
- [ ] å°‘æ•°ç”¨æˆ·åé¦ˆé—®é¢˜
- [ ] éæ ¸å¿ƒåŠŸèƒ½å¼‚å¸¸
```

---

### ç»ƒä¹  4 å‚è€ƒç­”æ¡ˆï¼šå›æ»šæ¼”ç»ƒ

**å›æ»šæ¼”ç»ƒè„šæœ¬**ï¼š

```bash
#!/bin/bash
# å›æ»šæ¼”ç»ƒè„šæœ¬
# ç”¨é€”ï¼šåœ¨æµ‹è¯•ç¯å¢ƒä¸­æ¼”ç»ƒå›æ»šæµç¨‹

set -e  # é‡åˆ°é”™è¯¯ç«‹å³é€€å‡º

echo "==================================="
echo "å¼€å§‹å›æ»šæ¼”ç»ƒ"
echo "==================================="

# 1. åº”ç”¨"ç ´åæ€§"é…ç½®ï¼ˆæ¨¡æ‹ŸåŠ å›ºå¤±è´¥ï¼‰
echo "[1/5] åº”ç”¨ç ´åæ€§é…ç½®..."
sudo cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.before_rollback
sudo tee /etc/nginx/nginx.conf > /dev/null <<EOF
# æ¨¡æ‹Ÿé”™è¯¯é…ç½®
http {
    listen 999999;  # æ— æ•ˆç«¯å£å·
    server_tokens off;
}
EOF

# 2. æµ‹è¯•é…ç½®ï¼ˆåº”è¯¥å¤±è´¥ï¼‰
echo "[2/5] æµ‹è¯•é…ç½®ï¼ˆé¢„æœŸå¤±è´¥ï¼‰..."
if sudo nginx -t 2>&1 | grep -q "invalid"; then
    echo "âœ… é…ç½®è¯­æ³•é”™è¯¯æ£€æµ‹æˆåŠŸ"
else
    echo "âŒ é…ç½®è¯­æ³•é”™è¯¯æ£€æµ‹å¤±è´¥"
    exit 1
fi

# 3. å°è¯•é‡å¯æœåŠ¡ï¼ˆåº”è¯¥å¤±è´¥ï¼‰
echo "[3/5] å°è¯•é‡å¯æœåŠ¡ï¼ˆé¢„æœŸå¤±è´¥ï¼‰..."
if ! sudo systemctl restart nginx 2>&1; then
    echo "âœ… æœåŠ¡é‡å¯å¤±è´¥ï¼ˆç¬¦åˆé¢„æœŸï¼‰"
else
    echo "âŒ æœåŠ¡é‡å¯æˆåŠŸï¼ˆä¸ç¬¦åˆé¢„æœŸï¼‰"
    exit 1
fi

# 4. æ‰§è¡Œå›æ»š
echo "[4/5] æ‰§è¡Œå›æ»š..."
sudo cp /etc/nginx/nginx.conf.before_rollback /etc/nginx/nginx.conf
sudo nginx -t && echo "âœ… é…ç½®è¯­æ³•æ£€æŸ¥é€šè¿‡"
sudo systemctl restart nginx && echo "âœ… æœåŠ¡é‡å¯æˆåŠŸ"

# 5. éªŒè¯æœåŠ¡çŠ¶æ€
echo "[5/5] éªŒè¯æœåŠ¡çŠ¶æ€..."
sudo systemctl status nginx | grep -q "active (running)" && echo "âœ… æœåŠ¡è¿è¡Œæ­£å¸¸"
curl -I http://localhost/ 2>&1 | grep -q "200 OK" && echo "âœ… æœåŠ¡å“åº”æ­£å¸¸"

echo "==================================="
echo "å›æ»šæ¼”ç»ƒå®Œæˆ"
echo "==================================="
```

**è¿è¡Œæ¼”ç»ƒ**ï¼š

```bash
chmod +x rollback_drill.sh
sudo ./rollback_drill.sh
```

**é¢„æœŸè¾“å‡º**ï¼š

```
===================================
å¼€å§‹å›æ»šæ¼”ç»ƒ
===================================
[1/5] åº”ç”¨ç ´åæ€§é…ç½®...
[2/5] æµ‹è¯•é…ç½®ï¼ˆé¢„æœŸå¤±è´¥ï¼‰...
âœ… é…ç½®è¯­æ³•é”™è¯¯æ£€æµ‹æˆåŠŸ
[3/5] å°è¯•é‡å¯æœåŠ¡ï¼ˆé¢„æœŸå¤±è´¥ï¼‰...
Job for nginx.service failed because the control process exited with error code.
See "systemctl status nginx.service" and "journalctl -xe" for details.
âœ… æœåŠ¡é‡å¯å¤±è´¥ï¼ˆç¬¦åˆé¢„æœŸï¼‰
[4/5] æ‰§è¡Œå›æ»š...
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
âœ… é…ç½®è¯­æ³•æ£€æŸ¥é€šè¿‡
âœ… æœåŠ¡é‡å¯æˆåŠŸ
[5/5] éªŒè¯æœåŠ¡çŠ¶æ€...
âœ… æœåŠ¡è¿è¡Œæ­£å¸¸
âœ… æœåŠ¡å“åº”æ­£å¸¸
===================================
å›æ»šæ¼”ç»ƒå®Œæˆ
===================================
```

---

## å­¦ä¹ æˆæœç¤ºä¾‹å¡«å†™ï¼ˆå¯ç…§æŠ„ï¼‰

> å¯å°†"ç¤ºä¾‹"å†…å®¹æ›¿æ¢ä¸ºä½ è‡ªå·±çš„æ—¶é—´ä¸æˆªå›¾æ–‡ä»¶åã€‚

---

### æˆªå›¾ä¸è¯æ®ï¼ˆç¤ºä¾‹ï¼‰

- åŠ å›ºå‰æ‰«æï¼š`images/day027_before_scan.png`
- åŠ å›ºåæ‰«æï¼š`images/day027_after_scan.png`
- å¯¹æ¯”æŠ¥å‘Šï¼š`images/day027_comparison_report.png`
- é…ç½®å¯¹æ¯”ï¼š`images/day027_config_diff.png`
- å›å½’æµ‹è¯•ï¼š`images/day027_regression_test.png`
- å˜æ›´è®°å½•ï¼š`change_record_CR-2026-001.md`

---

### å…³é”®å‘½ä»¤ä¸è¾“å‡ºï¼ˆç¤ºä¾‹ï¼‰

**åŠ å›ºå‰æ‰«æ**ï¼š

```bash
$ python main.py --config config/targets.json --output results/before
åŠ è½½äº† 1 ä¸ªæ‰«æç›®æ ‡

============================================================
æ‰«æç›®æ ‡: æœ¬æœºæµ‹è¯• (web)
============================================================
  âŒ [ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²] å‘ç°ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²
  âŒ [å®‰å…¨å“åº”å¤´æ£€æŸ¥] ç¼ºå°‘ 3 ä¸ªå®‰å…¨å“åº”å¤´

é€šè¿‡ç‡: 33.3% (1/3)
```

**åŠ å›ºæ•ˆæœå¯¹æ¯”**ï¼š

```bash
$ python compare_reports.py before.json after.json
============================================================
åŠ å›ºæ•ˆæœå¯¹æ¯”æŠ¥å‘Š
============================================================

âœ… å·²ä¿®å¤ (2 ä¸ª)
  + ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²
  + å®‰å…¨å“åº”å¤´æ£€æŸ¥

âŒ ä»ç„¶å¤±è´¥ (0 ä¸ª)

âš ï¸  æ–°å‘ç°é—®é¢˜ (0 ä¸ª)

é€šè¿‡ç‡æå‡: 33.3% â†’ 100.0% (+66.7%)
```

---

### ç»“è®ºä¸åæ€ï¼ˆç¤ºä¾‹ï¼‰

**æˆ‘ä»Šå¤©ææ¸…æ¥šäº†**ï¼š

- åŠ å›ºå¤éªŒæ˜¯ç¡®è®¤å®‰å…¨æªæ–½æ˜¯å¦ç”Ÿæ•ˆçš„å…³é”®æ­¥éª¤
- å¿…é¡»å»ºç«‹åŸºçº¿æ•°æ®ï¼Œæ‰èƒ½è¯„ä¼°åŠ å›ºæ•ˆæœ
- å˜æ›´è®°å½•å¯¹äºå®¡è®¡å’Œå›æº¯éå¸¸é‡è¦
- ä¸šåŠ¡å›å½’æµ‹è¯•å¯ä»¥æ£€æµ‹åŠ å›ºæªæ–½çš„å‰¯ä½œç”¨
- å¿…é¡»æå‰åˆ¶å®šå›æ»šæ–¹æ¡ˆï¼Œä»¥åº”å¯¹åŠ å›ºå¤±è´¥çš„æƒ…å†µ

**æˆ‘å·®ç‚¹ææ··çš„æ˜¯**ï¼š

- æœ€åˆä¸ç†è§£"å¤éªŒ"å’Œ"å›å½’æµ‹è¯•"çš„åŒºåˆ«
- ä»¥ä¸ºåªè¦æ‰«æé€šè¿‡å°±è¡Œäº†ï¼Œå¿½ç•¥äº†ä¸šåŠ¡åŠŸèƒ½æµ‹è¯•
- ä¸æ¸…æ¥šå˜æ›´è®°å½•åº”è¯¥åŒ…å«å“ªäº›è¯¦ç»†å†…å®¹

**æ˜å¤©æˆ‘è¦ç»§ç»­è¡¥çš„æ˜¯**ï¼š

- å­¦ä¹  WAFï¼ˆWeb åº”ç”¨é˜²ç«å¢™ï¼‰çš„åŸç†ä¸é…ç½®ï¼ˆDay028ï¼‰
- äº†è§£å¸¸è§ Web æ¼æ´ï¼ˆSQL æ³¨å…¥ã€XSSã€CSRFï¼‰çš„æ£€æµ‹ä¸é˜²æŠ¤ï¼ˆDay029-031ï¼‰
- å­¦ä¹ å®‰å…¨åŠ å›ºçš„æŒç»­æ€§ç›‘æ§å’Œå‘Šè­¦ï¼ˆDay032ï¼‰

**æœ¬æ¬¡å­¦ä¹ è€—æ—¶**ï¼šçº¦ 3.5 å°æ—¶

**æŒæ¡ç¨‹åº¦è‡ªè¯„**ï¼š

- [x] ğŸ˜ƒ å®Œæˆäº†æ‰€æœ‰ä»»åŠ¡å¹¶ç†è§£å¤éªŒæµç¨‹
