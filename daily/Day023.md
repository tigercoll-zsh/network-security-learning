# Day023:漏洞扫描器(合规用途)安装与配置,报告解读

- 日期:2026-01-16
- 周次:第 4 周

## 学习目标

今天是第 4 周的第一天,你应该能做到:

- **理解漏洞扫描的合法边界**:能清楚说明授权范围、扫描窗口、合规要求
- **完成 OpenVAS/Nessus Essentials 安装**:能在 Windows 或 Linux 环境下完成部署
- **执行一次标准扫描**:针对授权目标(本机/VM)执行基础漏洞扫描
- **解读扫描报告**:能识别高/中/低危漏洞,理解 CVSS 评分体系
- **形成可复用流程**:记录扫描 SOP,为后续基线检查打基础

> **核心原则**:漏洞扫描器是强大的工具,必须在合法授权范围内使用。未经授权扫描他人系统属于违法行为。

---

## 学习内容

### 1️⃣ 漏洞扫描的合法授权框架

#### 什么情况下可以使用漏洞扫描器?

| 场景 | 合法性 | 前置条件 |
|------|--------|----------|
| 扫描自己的设备(个人电脑/虚拟机) | ✅ 合法 | 无需额外授权 |
| 扫描公司内部系统(受雇于该公司) | ✅ 合法 | 需书面授权+扫描窗口+范围界定 |
| 扫描客户系统(安全测试/渗透测试) | ✅ 合法 | 需签订合同+明确范围+责任免责条款 |
| 扫描实验室靶场(如 Hack The Box) | ✅ 合法 | 平台 ToS 已授权,限平台内部 |
| 扫描公网随机 IP | 🚨 违法 | 无授权,可能触发刑法 |
| 扫描学校/邻居网络(即使出于好意) | 🚨 违法 | 无授权,可能被起诉 |

#### 企业级授权流程(示例)

```
┌─────────────────────────────────────────────────────┐
│ 1. 提交扫描申请                                     │
│    - 扫描目的(合规检查/安全评估/渗透测试前置)      │
│    - 目标范围(IP 段/域名/主机列表)                  │
│    - 扫描窗口(开始时间/结束时间)                    │
│    - 预期影响(是否会影响业务)                       │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│ 2. 审批环节                                         │
│    - 资产负责人签字                                 │
│    - 信息安全部门审批                               │
│    - 如涉及生产环境,需业务部门确认                  │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│ 3. 执行扫描                                         │
│    - 记录扫描开始/结束时间                          │
│    - 监控扫描过程(是否触发告警/影响业务)            │
│    - 保存原始日志                                   │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│ 4. 报告与归档                                       │
│    - 导出扫描报告(PDF/HTML/CSV)                     │
│    - 脱敏处理(隐藏真实 IP/账号)                     │
│    - 提交给相关方并归档                             │
└─────────────────────────────────────────────────────┘
```

---

### 2️⃣ 漏洞扫描器对比:OpenVAS vs Nessus

| 特性 | OpenVAS | Nessus Essentials |
|------|---------|-------------------|
| **许可证** | GPL(开源) | 免费版(限 16 IP) |
| **适用场景** | 企业内部/学习 | 个人学习/小规模测试 |
| **漏洞库更新** | 社区维护,更新较慢 | Tenable 官方,更新快 |
| **支持平台** | Linux(推荐 Kali/Ubuntu) | Windows/Linux/macOS |
| **安装难度** | 中等(需配置 PostgreSQL) | 简单(一键安装) |
| **Web 界面** | Greenbone Security Assistant | Nessus Web UI |
| **报告格式** | PDF/HTML/XML/CSV | PDF/HTML/CSV/Nessus |
| **推荐用途** | 学习 + 企业预算有限 | 学习 + 快速上手 |

**本课程选型**:优先使用 **Nessus Essentials**(安装简单,适合 Windows 学习者)。如有 Linux 环境可选 OpenVAS。

---

### 3️⃣ CVSS 评分体系速览

**CVSS(Common Vulnerability Scoring System)** 是通用漏洞评分系统,范围 0-10。

#### 评分等级

| CVSS 分数 | 严重等级 | 图标 | 典型示例 |
|-----------|----------|------|----------|
| 9.0-10.0 | 🔴 严重(Critical) | 🚨 | 远程代码执行(RCE)、未授权访问数据库 |
| 7.0-8.9 | 🟠 高危(High) | ⚠️ | SQL 注入、权限提升、敏感信息泄露 |
| 4.0-6.9 | 🟡 中危(Medium) | ℹ️ | 弱口令、过时的组件版本、信息泄露 |
| 0.1-3.9 | 🟢 低危(Low) | ✓ | Banner 泄露、不安全的配置建议 |
| 0.0 | ⚪ 信息(Info) | 📋 | 开放端口、服务版本信息 |

#### CVSS v3 计算要素

```
CVSS v3 = f(攻击向量, 攻击复杂度, 权限要求, 用户交互, 机密性影响, 完整性影响, 可用性影响)

示例:CVE-2021-44228(Log4Shell)
- 攻击向量(AV): Network(可远程利用)
- 攻击复杂度(AC): Low(易于利用)
- 权限要求(PR): None(无需权限)
- 用户交互(UI): None(无需用户操作)
- 机密性(C): High(可读取敏感数据)
- 完整性(I): High(可修改数据)
- 可用性(A): High(可造成服务中断)
→ CVSS 3.1 分数: 10.0(严重)
```

---

### 4️⃣ Nessus 架构与工作原理

```
┌───────────────────────────────────────────────────────┐
│                    Nessus 扫描器                      │
│                                                       │
│  ┌─────────────┐       ┌─────────────┐              │
│  │  Web UI     │◄─────►│  扫描引擎   │              │
│  │ (8834 端口) │       │  (nessusd)  │              │
│  └─────────────┘       └─────────────┘              │
│         │                     │                      │
│         ▼                     ▼                      │
│  ┌─────────────────────────────────────┐            │
│  │         漏洞插件库(Plugins)         │            │
│  │  - 网络服务漏洞                     │            │
│  │  - Web 应用漏洞                     │            │
│  │  - 操作系统漏洞                     │            │
│  │  - 配置审计(CIS Benchmark)          │            │
│  └─────────────────────────────────────┘            │
└───────────────────────────────────────────────────────┘
                    │
                    ▼
          ┌──────────────────┐
          │   目标主机       │
          │   (被扫描对象)   │
          └──────────────────┘
```

**扫描流程**:

1. **端口探测**:识别开放端口(类似 Nmap)
2. **服务识别**:确定运行的服务与版本
3. **漏洞匹配**:根据插件库匹配已知漏洞
4. **深度检测**:发送 Payload 验证漏洞是否真实存在
5. **生成报告**:汇总漏洞信息、修复建议、参考链接

---

## 实践任务(合法授权范围内)

> **今天仅扫描自己的设备或虚拟机,严禁扫描未授权目标。**

### 任务 1(必做):安装 Nessus Essentials

#### Windows 安装步骤

**步骤 1:注册并下载**

1. 访问 [Tenable 官网](https://www.tenable.com/products/nessus/nessus-essentials)
2. 注册账号,获取激活码(Activation Code)
3. 下载 Windows 安装包(约 80MB)

**步骤 2:安装**

```powershell
# 运行安装程序(双击 .msi 文件)
# 安装路径默认:C:\Program Files\Tenable\Nessus

# 安装完成后,Nessus 服务会自动启动
Get-Service -Name "Tenable Nessus"
```

**步骤 3:初始化配置**

```
1. 打开浏览器访问:https://localhost:8834
2. 信任自签名证书(点击"高级" → "继续访问")
3. 选择 "Nessus Essentials"
4. 输入激活码
5. 创建管理员账号(用户名/密码,务必记录)
6. 等待插件下载(约 30-60 分钟,取决于网络)
```

**验证安装**:

```powershell
# 检查 Nessus 服务状态
Get-Service -Name "Tenable Nessus" | Select-Object Name, Status, StartType

# 检查监听端口
Get-NetTCPConnection -LocalPort 8834 | Select-Object LocalAddress, LocalPort, State
```

---

### 任务 2(必做):执行第一次扫描(本机)

**步骤 1:创建扫描任务**

```
1. 登录 Nessus Web UI(https://localhost:8834)
2. 点击 "New Scan"
3. 选择模板 "Basic Network Scan"
4. 配置扫描参数:
   - Name: Day023_LocalScan
   - Targets: 127.0.0.1(本机)
   - Schedule: 立即运行
5. 点击 "Save" 保存
```

**步骤 2:启动扫描**

```
1. 在 "My Scans" 中找到 Day023_LocalScan
2. 点击 "Launch" 启动
3. 观察扫描进度(状态栏会显示进度百分比)
```

**扫描时长预估**:

- 本机扫描:5-15 分钟
- 虚拟机扫描:10-30 分钟(取决于开放端口数量)

---

### 任务 3(必做):解读扫描报告

**步骤 1:导出报告**

```
1. 扫描完成后,点击扫描任务名称
2. 点击右上角 "Export" → "PDF"
3. 保存为:Day023_Report.pdf
```

**步骤 2:分析报告结构**

报告通常包含以下部分:

```
1. Executive Summary(执行摘要)
   - 漏洞总数
   - 严重等级分布(Critical/High/Medium/Low/Info)
   - 风险评分

2. Vulnerability Details(漏洞详情)
   - 漏洞名称
   - CVE 编号(如果有)
   - CVSS 分数
   - 受影响的端口/服务
   - 描述
   - 解决方案
   - 参考链接

3. Remediations(修复建议)
   - 按优先级排序的修复措施
```

**步骤 3:填写漏洞清单**

| CVE 编号 | 漏洞名称 | CVSS | 等级 | 受影响端口 | 修复建议 |
|----------|----------|------|------|------------|----------|
| CVE-XXXX-XXXX | [示例] SMBv1 启用 | 7.5 | 🟠 高危 | 445/tcp | 禁用 SMBv1 |
| N/A | [示例] TLS 1.0 启用 | 5.3 | 🟡 中危 | 443/tcp | 禁用 TLS 1.0/1.1 |
| ... | ... | ... | ... | ... | ... |

---

### 任务 4(进阶):使用 PowerShell 提取关键信息

虽然 Nessus 提供了 Web 界面,但我们可以用 PowerShell 解析导出的 CSV 报告。

**步骤 1:导出 CSV 格式报告**

```
1. Export → CSV
2. 保存为:Day023_Report.csv
```

**步骤 2:用 PowerShell 分析**

```powershell
# 读取 CSV
$vulns = Import-Csv -Path ".\Day023_Report.csv"

# 统计各等级漏洞数量
$vulns | Group-Object Risk | Sort-Object Name | Select-Object Name, Count

# 提取高危及以上漏洞
$critical = $vulns | Where-Object { $_.Risk -in @("Critical", "High") }
$critical | Select-Object Risk, Name, Host, Port | Format-Table -AutoSize

# 导出高危漏洞清单
$critical | Export-Csv -Path ".\Day023_Critical.csv" -NoTypeInformation

Write-Host "✅ 已导出 $($critical.Count) 个高危及以上漏洞" -ForegroundColor Green
```

---

### 任务 5(可选):扫描虚拟机

如果你有虚拟机(如 Windows Server/Ubuntu),可以进行跨主机扫描。

**前置条件**:

```
1. 虚拟机网络模式:桥接模式或 NAT(确保主机能 ping 通虚拟机)
2. 虚拟机防火墙:暂时允许 ICMP 和常见端口(扫描后恢复)
```

**扫描配置**:

```
1. 创建新扫描任务
2. Targets: 192.168.x.x(虚拟机 IP)
3. Credentials: 如果提供凭据,可以执行"认证扫描"(更准确)
   - Windows: 本地管理员账号
   - Linux: root 或 sudo 用户
4. 启动扫描
```

**认证扫描 vs 非认证扫描**:

| 类型 | 优点 | 缺点 |
|------|------|------|
| 非认证扫描 | 无需账号,快速 | 只能检测外部可见漏洞 |
| 认证扫描 | 可检测补丁缺失、配置错误 | 需要管理员权限,速度较慢 |

---

## 巩固练习

### 题 1:CVSS 分数 8.1 的漏洞应该优先修复吗?

**思路提示**:

- CVSS 8.1 属于"高危"等级
- 但修复优先级还需考虑:
  - 是否可远程利用?
  - 是否已有公开 Exploit?
  - 资产重要性(核心业务系统 vs 测试环境)
  - 修复成本与业务影响

### 题 2:为什么 Nessus 扫描结果中会有"False Positive"(误报)?

**思路提示**:

- 漏洞扫描器基于"特征匹配",可能误判
- 常见误报原因:
  - Banner 伪装(服务器故意修改版本号)
  - 补丁已打但 Banner 未更新
  - 扫描器插件过时

### 题 3:未经授权扫描公网 IP 有什么法律后果?

**思路提示**:

- 涉及法律:《网络安全法》、《刑法》第 285 条、第 286 条
- 即使"没有恶意"也可能构成犯罪

### 题 4:认证扫描和非认证扫描的主要区别是什么?

**思路提示**:

- 认证扫描:提供系统凭据,可以登录系统检查内部配置
- 非认证扫描:仅从外部探测,无法检测需要登录才能发现的问题
- 准确性、覆盖范围、所需权限的差异

### 题 5:如何判断一个漏洞是否需要立即修复?

**思路提示**:

- CVSS 分数只是参考,不是唯一标准
- 需要考虑:可利用性、资产重要性、业务影响、是否有补偿控制措施

---

## 评估标准

- ✅ 你能清楚说明漏洞扫描的合法授权边界
- ✅ 你能在 Windows 上完成 Nessus Essentials 安装并启动服务
- ✅ 你能对本机或虚拟机执行一次完整扫描
- ✅ 你能解读扫描报告,识别高危漏洞并提取修复建议
- ✅ 你能用 PowerShell 提取扫描报告中的关键信息
- ✅ 你能解释 CVSS 评分体系与修复优先级判断

---

## 学习成果达成情况(由学习者填写)

### 截图与证据

- [ ] Nessus 服务运行截图(`Get-Service` 输出)
- [ ] Nessus Web UI 登录截图
- [ ] 扫描任务配置截图
- [ ] 扫描完成后的结果总览截图
- [ ] 导出的 PDF 报告(Day023_Report.pdf)
- [ ] PowerShell 提取的高危漏洞清单(Day023_Critical.csv)

### 关键命令与输出

**Nessus 服务状态**:

```
Name            Status   StartType
----            ------   ---------
Tenable Nessus  Running  Automatic
```

**扫描结果统计**:

- Critical: ___ 个
- High: ___ 个
- Medium: ___ 个
- Low: ___ 个
- Info: ___ 个

**高危漏洞示例**:

| CVE | 漏洞名称 | CVSS | 受影响端口 |
|-----|----------|------|------------|
| ... | ... | ... | ... |

### 结论与反思

**我今天搞清楚了**:

- (例如:漏洞扫描必须在授权范围内,CVSS 评分不是唯一的修复依据)

**我差点搞混的是**:

- (例如:误以为"低危"漏洞可以不管,实际上组合利用也可能造成严重后果)

**明天我要继续补的是**:

- (例如:学习如何配置认证扫描,提高漏洞检测准确率)

**本次学习耗时**:约 ___ 小时

**掌握程度自评**:

- [ ] 😕 看懂了但没动手
- [ ] 🙂 完成了 Nessus 安装和基础扫描
- [ ] 😃 完成了所有任务并理解报告结构
- [ ] 🤩 额外做了认证扫描或虚拟机扫描

---

## 集中参考答案

### 题 1 参考答案

CVSS 8.1 属于高危,但修复优先级需综合考虑:

- 可利用性(是否有公开 Exploit)
- 资产重要性(生产环境 vs 测试环境)
- 暴露面(外网可访问 vs 仅内网)
- 修复成本(是否需要停机)

**决策矩阵**:

| 条件 | 优先级 |
|------|--------|
| 远程可利用 + 有 Exploit + 生产环境 | 🔴 立即修复 |
| 远程可利用 + 无 Exploit + 生产环境 | 🟠 7 天内修复 |
| 仅本地可利用 + 测试环境 | 🟡 下次维护窗口修复 |

---

### 题 2 参考答案

误报原因:

1. **Banner 匹配不准确**:版本号未更新但已打补丁
2. **插件检测逻辑不严谨**:未实际验证漏洞
3. **环境差异**:某些漏洞仅特定配置可利用

**降低误报的方法**:

- 启用认证扫描(可检查实际补丁状态)
- 手动验证高危漏洞
- 使用多个扫描器交叉验证

---

### 题 3 参考答案

未授权扫描可能触犯:

- 《刑法》第 285 条(非法侵入计算机信息系统罪):3 年以下有期徒刑或拘役
- 《刑法》第 286 条(破坏计算机信息系统罪):5 年以下有期徒刑或拘役

**真实案例**:

- 2018 年某大学生"练手"扫描学校服务器,被判缓刑
- 2020 年某安全从业者扫描客户系统但未签合同,被起诉索赔

**合法途径**:

- 扫描自己的设备
- 获得书面授权后扫描企业内部系统
- 参与合法的 SRC/漏洞赏金计划
- 使用官方靶场练习

---

### 题 4 参考答案

| 类型 | 认证扫描 | 非认证扫描 |
|------|----------|------------|
| **需要凭据** | 是(管理员账号) | 否 |
| **检测深度** | 深(可检查补丁、配置、本地漏洞) | 浅(仅外部可见漏洞) |
| **准确性** | 高(误报率低) | 中(依赖 Banner) |
| **速度** | 慢 | 快 |
| **典型用途** | 合规审计、内部评估 | 外部渗透测试前期侦查 |

**推荐做法**:

- 内部系统:优先使用认证扫描
- 外部系统:先非认证扫描,发现问题后再申请认证扫描

---

### 题 5 参考答案

**修复优先级判断矩阵**:

```
优先级 = f(CVSS 分数, 可利用性, 资产重要性, 暴露面, 补偿控制)

示例:
- 漏洞 A: CVSS 9.8, 已有公开 Exploit, 影响外网 Web 服务器
  → 🔴 P0: 立即修复(24 小时内)

- 漏洞 B: CVSS 8.1, 无公开 Exploit, 影响内网测试环境
  → 🟡 P2: 下次维护窗口修复(30 天内)

- 漏洞 C: CVSS 7.5, 已有防火墙限制访问, 仅内网可达
  → 🟢 P3: 计划修复(90 天内)
```

**补偿控制措施**:

- 防火墙规则限制访问
- WAF/IPS 规则拦截已知攻击
- 网络隔离(VLAN 分段)
- 监控告警(检测异常访问)

---

## 学习成果示例填写

### 截图与证据(示例)

- Nessus 服务运行截图:`images/day023_nessus_service.png`
- 扫描结果总览:`images/day023_scan_summary.png`
- 高危漏洞清单:`Day023_Critical.csv`(3 个高危漏洞)

### 关键命令与输出(示例)

**扫描结果统计**:

- Critical: 0 个
- High: 3 个
- Medium: 12 个
- Low: 8 个
- Info: 25 个

**高危漏洞示例**:

| CVE | 漏洞名称 | CVSS | 受影响端口 |
|-----|----------|------|------------|
| CVE-2017-0143 | MS17-010 (EternalBlue) | 8.1 | 445/tcp |
| N/A | TLS 1.0 Enabled | 7.5 | 443/tcp |
| CVE-2019-0708 | BlueKeep (RDP RCE) | 9.8 | 3389/tcp |

### 结论与反思(示例)

**我今天搞清楚了**:

- 漏洞扫描必须在合法授权范围内,否则可能触犯刑法
- CVSS 分数是参考,不是唯一的修复依据
- 认证扫描比非认证扫描更准确,但需要管理员权限
- 误报是常见现象,需要手动验证

**我差点搞混的是**:

- 以为"信息级"漏洞可以忽略,实际上 Banner 泄露可能帮助攻击者制定攻击策略
- 以为 CVSS 10.0 就一定要立即修复,但还要看是否真实可利用和资产重要性

**明天我要继续补的是**:

- 学习如何配置 Windows 认证扫描(提供凭据)
- 研究如何手动验证漏洞(避免误报)
- 建立漏洞修复跟踪流程
- 学习系统基线检查项

**本次学习耗时**:约 3 小时(含 Nessus 插件下载时间)

**掌握程度自评**:

- [x] 😃 完成了所有任务并理解报告结构
