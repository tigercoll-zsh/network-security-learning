---
title: Day015：SQL 注入 - 理解原理
tags:
  - 网络安全
  - SQL注入
  - Web安全
categories:
  - 90天安全突击
stage: 筑基
abbrlink: d015
date: 2026-02-06
updated: 2026-01-28
---

# Day015：SQL 注入 - 理解原理

## 基本信息

| 项目 | 内容 |
|------|------|
| **所属阶段** | 筑基（第一阶段） |
| **所属周次** | Week 3：SQL 注入入门 |
| **今日主题** | 理解 SQL 注入的本质和危害 |
| **预计时间** | 2 小时 |
| **难度等级** | 入门 |

---

## 今日痛点场景

> **场景**：你在测试一个登录页面，输入用户名 `admin`，密码随便填 `123`，登录失败。但输入 `admin' --`，居然登录成功了！
>
> **问题**：为什么一个单引号加两个横杠就能绕过登录？
>
> **今天的任务**：理解 SQL 注入的原理，知道为什么它如此危险。

---

## 今日目标

- [ ] 理解什么是 SQL 注入
- [ ] 知道为什么会产生 SQL 注入
- [ ] 识别可能存在注入的输入点
- [ ] 理解注入的危害等级

**闯关条件**：能用自己的话解释"SQL 注入是怎么回事"。

---

## 实战任务（先动手！）

### 任务 1：搭建 DVWA 靶场（20 分钟）

DVWA（Damn Vulnerable Web Application）是练习 Web 漏洞的经典靶场。

**方法 1：使用 Docker（推荐）**：
```bash
docker run -d -p 80:80 vulnerables/web-dvwa
```

**方法 2：手动安装**：
1. 下载 DVWA：https://github.com/digininja/DVWA
2. 放入 Web 目录（如 `/var/www/html/`）
3. 配置数据库连接

**默认登录**：
- 用户名：admin
- 密码：password

登录后，点击 "DVWA Security"，将安全级别设为 "Low"。

---

### 任务 2：体验第一个 SQL 注入（15 分钟）

1. 在 DVWA 左侧菜单点击 "SQL Injection"
2. 输入框里输入 `1`，观察结果
3. 输入 `1'`，观察报错信息
4. 输入 `1' OR '1'='1`，观察结果

**问自己**：
- 输入 `1` 和 `1' OR '1'='1` 结果有什么不同？
- 报错信息暴露了什么？

---

### 任务 3：理解背后的 SQL 语句（15 分钟）

假设后端代码是这样的：
```php
$id = $_GET['id'];
$sql = "SELECT first_name, last_name FROM users WHERE user_id = '$id'";
```

当你输入 `1` 时，SQL 变成：
```sql
SELECT first_name, last_name FROM users WHERE user_id = '1'
```

当你输入 `1' OR '1'='1` 时，SQL 变成：
```sql
SELECT first_name, last_name FROM users WHERE user_id = '1' OR '1'='1'
```

**关键洞察**：`'1'='1'` 永远为真，所以返回所有用户！

---

### 任务 4：尝试登录绕过（15 分钟）

回到你熟悉的登录场景。假设登录 SQL 是：
```sql
SELECT * FROM users WHERE username = '$user' AND password = '$pass'
```

如果用户名输入 `admin' --`：
```sql
SELECT * FROM users WHERE username = 'admin' --' AND password = '任意'
```

`--` 是 SQL 注释符，后面的密码检查被注释掉了！

---

## 今日闯关检查

| 检查项 | 状态 |
|--------|------|
| DVWA 靶场搭建成功 | |
| 成功执行 `1' OR '1'='1` 注入 | |
| 能解释为什么注入会生效 | |
| 知道 `--` 注释符的作用 | |

---

## 底层补课

### 什么是 SQL 注入？

**定义**：攻击者通过在输入中插入恶意 SQL 代码，欺骗后端执行非预期的数据库操作。

**本质**：用户输入被当作代码执行了，而不是当作数据处理。

### 为什么会产生 SQL 注入？

| 原因 | 说明 |
|------|------|
| 拼接 SQL | 直接把用户输入拼进 SQL 语句 |
| 无过滤 | 没有对特殊字符（如 `'`）做处理 |
| 无参数化 | 没有使用预编译语句 |

### SQL 注入的危害

| 危害 | 说明 |
|------|------|
| 数据泄露 | 获取所有用户信息、密码 |
| 认证绕过 | 不需要密码就能登录 |
| 数据篡改 | 修改、删除数据库内容 |
| 提权 | 获取数据库管理员权限 |
| 执行命令 | 某些数据库可执行系统命令 |

### 常见注入点

- 登录表单（用户名、密码）
- 搜索框
- URL 参数（如 `?id=1`）
- Cookie 值
- HTTP 头（User-Agent、Referer）

---

## 避坑指南

| 坑点 | 症状 | 解决方案 |
|------|------|----------|
| 单引号报错 | 页面崩溃或显示错误 | 可能存在注入，但需要闭合引号 |
| 没有回显 | 注入后页面无变化 | 可能是盲注，后面会学 |
| 被拦截 | 输入被过滤或拒绝 | 需要绕过技巧，Week 3 后面会讲 |

---

## 知识卡片速查

### SQL 注入测试基础 Payload

```sql
-- 判断是否存在注入
'
''
1' OR '1'='1
1' OR '1'='1' --
1' OR '1'='1' #

-- 闭合方式测试
1'
1"
1)
1')
1")

-- 注释符
-- (MySQL, PostgreSQL, Oracle)
#  (MySQL)
/* */ (所有数据库)
```

### 常见数据库注释符

| 数据库 | 注释符 |
|--------|--------|
| MySQL | `--` `#` `/* */` |
| PostgreSQL | `--` `/* */` |
| Oracle | `--` `/* */` |
| SQL Server | `--` `/* */` |

---

## 常见问题

**Q1：为什么输入单引号会报错？**

A1：因为你的单引号破坏了 SQL 语句的语法结构。原本的 SQL 期望的是一个值，你的单引号让引号数量不匹配了。

**Q2：所有网站都能 SQL 注入吗？**

A2：不是。现代网站大多使用参数化查询（预编译语句），可以有效防止 SQL 注入。但仍有大量老旧系统或开发不规范的网站存在漏洞。

**Q3：SQL 注入违法吗？**

A3：未经授权对他人系统进行 SQL 注入是违法的。只能在：
- 自己搭建的靶场
- 获得授权的渗透测试
- CTF 比赛
- 漏洞赏金平台

---

## 明日预告

**Day 016：SQL 注入 - 手工注入技术**

明天你将：
- 学习判断注入类型（数字型 vs 字符型）
- 使用 ORDER BY 判断列数
- 使用 UNION SELECT 获取数据

---

## 学习记录

| 项目 | 内容 |
|------|------|
| 实际学习日期 | |
| 今日收获 | |

---

> **导师点评**：
>
> 今天你理解了 SQL 注入的本质——把用户输入当代码执行。
>
> 这是 Web 安全最经典的漏洞之一，虽然"老掉牙"，但至今仍是 OWASP Top 10 的常客。
>
> 为什么？因为总有人用字符串拼接写 SQL。
>
> 记住：**永远不要信任用户输入**。

```bash
echo "Day 015 Complete! 我理解 SQL 注入了！"
```
