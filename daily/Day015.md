# Day015：操作系统与脚本 - Linux 安全基础（傻瓜版能照做）

- 日期：2026-01-08
- 周次：第 3 周

## 学习目标

学完今天你应该能做到：

- 能用一句话解释 Linux 的三件套：**用户/组**、**权限**、**服务**
- 看懂比如 `-rwxr-xr-x` 这种权限字符串，能算出 `755/644`
- 在“自建或明确授权”的 Linux 环境里完成最小加固动作：
  - 新建一个普通用户
  - 禁止 root 直接登录（只做记录/理解；具体改动要谨慎）
  - 看一眼安全日志并能说出“这条记录代表什么”

> 没有 Linux 也能学：你可以用 WSL 或虚拟机；如果都没有，先把“权限/概念/清单”写出来也算达成。

## 学习内容

### 1️⃣ 用户/组/权限：你只要记住一条规律

Linux 文件权限看 3 类人：

- u：owner（文件拥有者）
- g：group（所属组）
- o：others（其他人）

每类人 3 个权限位：

- r=4（读）
- w=2（写）
- x=1（执行）

所以：

- **755** = `rwx r-x r-x`
- **644** = `rw- r-- r--`

> “看懂权限”不是为了背，是为了你以后看到敏感文件权限过宽时能立刻警觉。

### 2️⃣ sudo：为什么要“普通用户登录 + sudo 提权”

核心目的：

- 把高权限入口收紧
- 让操作更可审计

### 3️⃣ 日志：你至少要知道去哪看

常见位置（不同发行版略有差异）：

- `/var/log/auth.log`（Debian/Ubuntu 常见认证日志）
- `/var/log/secure`（RHEL/CentOS 常见认证日志）
- `journalctl`（systemd 日志，现代系统常用）

### 4️⃣ 服务与开机项：攻击面从这儿冒出来

你要形成习惯：

- “这台机器到底开了哪些服务？”
- “哪些服务真的需要对外？”（最小暴露原则）

## 实践任务（合法授权范围内）

> 必须强调：下面所有操作只在自建/授权的 Linux 环境执行，不要对陌生主机操作。

### 任务 0（准备环境，三选一）

- A. WSL（Windows 上最省事）
- B. 虚拟机（VirtualBox/VMware）
- C. 云主机（必须是你自己的账号/明确授权）

### 任务 1（必做）：看懂权限（不改系统也能做）

在 Linux 里执行：

```bash
ls -l /etc/passwd
ls -l /etc/shadow
```

你要观察：

- `/etc/shadow` 通常权限更严格（因为里面是密码哈希）

### 任务 2（必做）：新建普通用户 + 加入 sudo（仅自建环境）

```bash
sudo useradd -m alice
sudo passwd alice
```

把用户加入 sudo 组（Ubuntu 常见是 sudo 组）：

```bash
sudo usermod -aG sudo alice
```

验证用户信息：

```bash
id alice
```

### 任务 3（必做）：列出正在监听的服务（最小暴露）

```bash
sudo ss -lntup
```

你要记录：

- 哪些端口在 LISTEN
- 是哪个进程在监听（服务名）
- 这些端口是否真的需要（写一句判断）

### 任务 4（必做）：看一眼认证日志（知道去哪查）

Ubuntu/Debian：

```bash
sudo tail -n 50 /var/log/auth.log
```

RHEL 系：

```bash
sudo tail -n 50 /var/log/secure
```

或用 systemd：

```bash
sudo journalctl -u ssh --no-pager | tail -n 50
```

## 巩固练习（题与复盘）

### 题 1：解释 755/644 权限含义

**思路**：把它拆成三段（owner/group/others）+ 用 4/2/1 对应。

### 题 2：写 5 条 Linux 主机加固检查项（只写“你能做到的”）

**思路**：从账号、服务、更新、日志、网络五个角度写。

## 评估标准（达成判定）

- 能正确把 `rwx` 转成 `755/644`（至少举 2 个例子）
- 能输出“监听端口清单”并解释哪些不该对外
- 能在日志里找到 1 条与 ssh/登录相关的记录（或明确说你环境里没有）
- 形成 Linux 加固清单（5 条以上）

## 学习成果达成情况（由学习者填写）

### 截图与证据

- [ ] `ls -l /etc/shadow` 权限截图
- [ ] `ss -lntup` 监听端口截图
- [ ] `auth.log/secure/journalctl` 任意一条关键日志截图

### 关键命令与输出

- 权限：
  - `/etc/passwd`：
  - `/etc/shadow`：
- 监听端口：
  - 端口/进程摘要：
- 日志：
  - 关键行摘录：

### 结论与反思

- 我今天确认到的 1 个事实证据：
- 我最容易搞错的是：
- 明天我想进一步做的是：

## 集中参考答案（含思路）

### 题 1 参考答案

- 755：owner=rwx(7)，group=r-x(5)，others=r-x(5)。文件拥有者可读写执行，其它人只可读/执行。
- 644：owner=rw-(6)，group=r--(4)，others=r--(4)。拥有者可读写，其它人只读。

### 题 2 参考答案（示例 5 条）

1. 禁止 root 远程直登（配合普通用户 + sudo）。
2. 关闭不需要的服务/端口（最小暴露）。
3. 系统及时更新补丁。
4. 开启并定期检查认证日志（发现爆破/异常登录）。
5. 配置防火墙仅放通必要端口（如 22 仅限白名单）。

## 学习成果示例填写（可照抄）

### 截图与证据（示例）

- `images/day015_shadow_perm.png`：`/etc/shadow` 权限是 `-rw-r-----`
- `images/day015_listen_ports.png`：只看到 22/80 等必要端口

### 结论与反思（示例）

- 我以前只会装系统，不会查“监听了哪些端口”；现在知道先用 `ss -lntup` 做攻击面盘点。
- 下次我会先建普通用户 + sudo，再考虑 ssh 加固，避免把自己锁死。
