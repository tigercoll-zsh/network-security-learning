---
title: Week 02：安全协议与加密 - 周度总结
tags:
  - 学习总结
  - 阶段复盘
categories:
  - 网络安全
date: 2026-02-05
---

# Week 02：安全协议与加密 - 周度总结

## 📅 本周学习概览

本周我们从“裸奔”的网络通信迈向了“武装到牙齿”的安全通信。如果说第一周是教你如何把网线接通，那么第二周就是教你如何给管道加上防盗门和密码锁。

我们深入研究了保护互联网的三大支柱：**TLS/HTTPS**（保护 Web）、**SSH**（保护运维）、**加密算法**（保护数据）。这些是任何安全从业者必须烂熟于心的基本功。

<!--more-->

---

## 📚 每日核心知识回顾

### Day 008：TLS 概念与握手
-   **TLS (Transport Layer Security)**：HTTPS 的幕后英雄。
-   **握手流程**：Client Hello -> Server Hello -> Certificate -> Key Exchange -> Finished。
-   **SNI**：解决了单 IP 托管多域名的证书匹配问题。
-   **安全要点**：**前向保密 (PFS)** 是通过 Ephemeral DH 算法实现的，防止长期私钥泄露导致历史数据被解密；**版本降级攻击** 利用了对旧协议（如 SSL 3.0）的兼容性。

### Day 009：证书与信任链
-   **PKI 体系**：公钥基础设施。
-   **证书结构 (X.509)**：Subject、Issuer、Validity、Public Key、Signature。
-   **信任链 (Chain of Trust)**：Root CA -> Intermediate CA -> Server。
-   **安全要点**：**证书吊销机制 (CRL/OCSP)** 用于处理私钥泄露或证书误发的情况；**自签名证书** 不被浏览器信任，容易被中间人伪造。

### Day 010：HTTPS 抓包与安全特性
-   **抓包现象**：Wireshark 只能看到乱码，除非拥有私钥或 SSLKEYLOGFILE。
-   **HSTS**：强制浏览器只用 HTTPS 访问，防止 SSL 剥离攻击。
-   **安全要点**：**中间人攻击 (MITM)** 及其防御是 HTTPS 的核心价值；**SSL Pinning (证书固定)** 是移动端应用防止中间人抓包和攻击的重要手段。

### Day 011：SSH 与密钥认证
-   **SSH**：加密的远程登录协议（端口 22）。
-   **认证方式**：密码认证 vs 密钥认证（推荐）。
-   **安全要点**：**SSH 服务端加固**（禁用 Root、禁用密码、修改端口）是服务器安全的第一道防线；**SSH 端口转发** 功能强大但也可能被用于内网穿透攻击。

### Day 012：加密基础
-   **哈希 (Hash)**：不可逆，用于指纹校验（MD5, SHA-256）。
-   **对称加密**：一把钥匙开两扇门，速度快（AES）。
-   **非对称加密**：公钥加密私钥解（保密），私钥签名公钥验（认证）。速度慢（RSA, ECC）。
-   **安全要点**：**弱加密算法**（如 MD5, DES, RC4）应被淘汰；**彩虹表攻击** 威胁未加盐的哈希密码；**密钥管理** 是加密系统中最脆弱的环节。

### Day 013：加密应用与场景
-   **误区**：Base64 只是编码，不是加密！
-   **密码存储**：使用 **Bcrypt / Argon2** (慢哈希 + 随机盐)。
-   **数据状态**：传输中（TLS）、存储中（AES）、使用中（机密计算）。
-   **安全要点**：**数据生命周期安全**；**JWT 安全**（防范算法篡改、密钥泄露）；**ECB 模式** 的不安全性。

### Day 014：综合与复盘
-   **纵深防御**：不仅仅靠加密，还要靠权限控制、日志审计、边界防护。
-   **最佳实践**：不要硬编码密钥，使用 KMS，定期轮换密钥。
-   **安全要点**：**安全架构设计** 需要综合考虑各个层面的风险；**应急响应** 思维（假设已经被攻破，如何止损）。

---

## 📝 巩固练习题 (Level 2)

完成以下题目来检验你对第二周内容的掌握程度。

### 一、 概念速查（单选/简答）

1.  **以下哪种算法适合用于存储用户的登录密码？**
    A) AES-256
    B) SHA-256
    C) Base64
    D) Bcrypt
2.  **HTTPS 握手过程中，服务器发送证书是在哪一步之后？**
    A) Client Hello
    B) Client Key Exchange
    C) Change Cipher Spec
    D) Finished
3.  **HSTS 的主要作用是防御哪种攻击？**
    A) SQL 注入
    B) XSS 跨站脚本
    C) SSL 剥离 / 降级攻击
    D) 暴力破解
4.  **SSH 密钥认证中，私钥应该保存在哪里？**
    A) 服务器的 `authorized_keys` 文件中
    B) 客户端本地，且权限必须严格（600）
    C) 公开发布在网上
    D) 服务器的 `/etc/ssh/` 目录下
5.  **如果根证书（Root CA）的私钥泄露了，会发生什么？**

### 二、 场景分析与安全实践（实战模拟）

6.  **场景：中间人攻击**
    你在咖啡厅连 WiFi，访问 `https://www.bank.com`。浏览器突然弹出全屏红色的警告：“您的连接不是私密连接 (NET::ERR_CERT_AUTHORITY_INVALID)”。
    *   攻击者可能正在做什么？
    *   为什么浏览器能发现攻击？
    *   此时如果你点击“继续访问（不安全）”，会发生什么？

7.  **场景：SSH 登录失败与加固**
    你配置了 SSH 密钥登录，但把公钥上传后，依然提示要输入密码。检查发现服务器上 `~/.ssh/authorized_keys` 文件的权限是 `777`。
    *   为什么会失败？
    *   应该改成多少？
    *   **思考**：除了权限问题，为了服务器安全，你还应该修改 `/etc/ssh/sshd_config` 中的哪些配置？

8.  **场景：加密选型与弱点识别**
    开发团队要开发一个聊天软件，要求：
    1. 聊天内容只有发送方和接收方能看（端到端加密）。
    2. 传输大文件要快。
    3. 以前他们用的是 AES-ECB 模式，你认为有问题吗？
    请设计一个简单的混合加密方案，并指出 AES-ECB 的问题。

9.  **场景：应用层安全**
    你发现某个 Web 应用的 API 认证使用了 JWT，但你解密 JWT 后发现 Header 中的 `alg` 字段是 `HS256`，且密钥看起来很短（如 "secret"）。
    *   这存在什么安全风险？
    *   作为攻击者，你可能会尝试什么攻击？
    *   作为防御者，你应该怎么做？

### 三、 深度思考与综合分析

10. **为什么 TLS 1.3 废弃了 RSA 密钥交换，只保留了 DH (Diffie-Hellman) 系列？请结合“前向保密 (PFS)”和“中间人攻击”进行分析。**

---

## 🔑 参考答案

### 一、 概念速查
1.  **D) Bcrypt**。AES 可逆（危险），SHA-256 太快（怕显卡爆破），Base64 是裸奔。
2.  **A) Client Hello**。客户端打招呼后，服务端回应 Hello 并发送证书。
3.  **C) SSL 剥离 / 降级攻击**。HSTS 强制浏览器内部跳转 HTTPS，不给 HTTP 请求发出的机会。
4.  **B) 客户端本地**。私钥是你的命根子，绝不能离身。
5.  **信任体系崩塌**。黑客可以用这个私钥签发任意网站的合法证书（比如签发一个假的 google.com），全球所有浏览器都会信任它，中间人攻击将畅通无阻。该根证书必须立即被全球吊销。

### 二、 场景分析与安全实践
6.  **中间人攻击**。
    *   攻击者正在拦截你的流量，并向你展示一张他伪造的证书。
    *   因为这张伪造证书不是由系统受信任的 CA 签发的，浏览器验签失败。
    *   如果点击继续，加密通道将建立在你是黑客之间，你的账号密码将全部暴露给黑客。
7.  **权限过宽与 SSH 加固**。
    *   SSH 的 `StrictModes` 检查发现权限太松（777 意味着谁都能改这个文件，黑客可以把自己公钥加进去），所以为了安全拒绝使用该文件。
    *   应改为 `600`。
    *   **加固配置**：`PermitRootLogin no`（禁 Root 直登），`PasswordAuthentication no`（禁密码），`Port 2222`（改端口）。
8.  **加密方案与 ECB 问题**：
    *   **方案**：**握手阶段**用非对称加密（如 ECC/RSA）协商临时对称密钥（Session Key）；**传输阶段**用 Session Key 配合对称加密（如 AES-GCM）加密数据。
    *   **AES-ECB 问题**：ECB 模式相同的明文块会生成相同的密文块，无法隐藏数据模式（如“企鹅图”），不安全。应使用 CBC 或 GCM 模式。
9.  **JWT 安全风险**。
    *   **风险**：弱密钥容易被暴力破解。
    *   **攻击**：离线暴力破解密钥，然后伪造任意用户的 JWT（如修改 payload 中的 `user_id` 为管理员 ID）。
    *   **防御**：使用强密钥（至少 32 字节随机字符），或改用非对称加密（RS256/ES256）。

### 三、 深度思考
10. **为了强制前向保密 (PFS)**。
    *   **RSA 缺陷**：客户端用服务器公钥加密“预主密钥”发过去。如果将来服务器的私钥泄露了，黑客可以用它解密所有历史截获的流量，算出当年的会话密钥，看光所有历史数据。
    *   **DH 优势**：DH (尤其是 Ephemeral DH) 每次握手都临时生成一对密钥，用完即焚。即使长期私钥泄露，也解不开历史数据，只能伪造现在的身份。TLS 1.3 为了安全，彻底堵死了非 PFS 的路。
