# Day020ï¼šæ“ä½œç³»ç»Ÿä¸è„šæœ¬ - æœåŠ¡æšä¸¾ä¸æŒ‡çº¹è¯†åˆ«

- æ—¥æœŸï¼š2026-01-13
- å‘¨æ¬¡ï¼šç¬¬ 3 å‘¨

## å­¦ä¹ ç›®æ ‡

å­¦å®Œä»Šå¤©ä½ åº”è¯¥èƒ½åšåˆ°ï¼š

- èƒ½è§£é‡Š"æšä¸¾"åœ¨åšä»€ä¹ˆï¼š**ç¡®è®¤æœåŠ¡æ˜¯ä»€ä¹ˆ+ç‰ˆæœ¬æ˜¯ä»€ä¹ˆ+å“åº”ç‰¹å¾æ˜¯ä»€ä¹ˆ**
- çŸ¥é“ Banner ä¸å¯é ï¼Œå¹¶èƒ½ç”¨"ä¸¤ç§æ–¹æ³•äº¤å‰éªŒè¯"
- ç”¨æœ€å°è„šæœ¬æŠŠæ‰«æç»“æœæ•´ç†æˆ"æœåŠ¡çŸ©é˜µ"ï¼ˆhostÃ—portÃ—serviceÃ—versionï¼‰
- æŒæ¡å¸¸è§æœåŠ¡çš„æŒ‡çº¹è¯†åˆ«æŠ€å·§ï¼ˆHTTP/SSH/MySQL/RDPï¼‰
- èƒ½è¾“å‡ºä¸€ä»½ç»“æ„åŒ–çš„æœåŠ¡æ¸…å•ï¼ˆCSV/JSONï¼‰

---

## ä¸€ã€ä»€ä¹ˆæ˜¯æœåŠ¡æšä¸¾ï¼Ÿ

### 1.1 ç«¯å£æ‰«æ vs æœåŠ¡æšä¸¾

```
ç«¯å£æ‰«æï¼ˆDay019ï¼‰
â”œâ”€ ç›®æ ‡ï¼šå‘ç°å“ªäº›ç«¯å£å¼€æ”¾
â”œâ”€ æ–¹æ³•ï¼šå‘é€ SYN/TCP æ¢æµ‹
â””â”€ ç»“æœï¼šç«¯å£å· + çŠ¶æ€ï¼ˆopen/closed/filteredï¼‰

æœåŠ¡æšä¸¾ï¼ˆDay020ï¼‰
â”œâ”€ ç›®æ ‡ï¼šç¡®è®¤æœåŠ¡ç±»å‹ã€ç‰ˆæœ¬ã€é…ç½®
â”œâ”€ æ–¹æ³•ï¼šå‘é€åè®®ç‰¹å®šçš„æ¡æ‰‹/è¯·æ±‚
â””â”€ ç»“æœï¼šæœåŠ¡å + ç‰ˆæœ¬å· + Banner + å“åº”ç‰¹å¾
```

### 1.2 ä¸ºä»€ä¹ˆ Banner ä¸å¯é ï¼Ÿ

| åœºæ™¯ | Banner æ˜¾ç¤º | çœŸå®æƒ…å†µ | åŸå›  |
|------|-------------|----------|------|
| **ä¼ªè£…** | `Apache/2.4.41` | å®é™…æ˜¯ Nginx | ç®¡ç†å‘˜æ‰‹åŠ¨ä¿®æ”¹å“åº”å¤´ |
| **ä»£ç†** | `Microsoft-IIS/10.0` | åç«¯æ˜¯ Tomcat | å‰ç«¯æœ‰ IIS åå‘ä»£ç† |
| **éšè—ç‰ˆæœ¬** | `nginx` | Nginx 1.18.0 | ç¼–è¯‘æ—¶å…³é—­ç‰ˆæœ¬æ˜¾ç¤º |
| **WAF** | `Cloudflare` | åç«¯æœªçŸ¥ | CDN/WAF å±è”½çœŸå®æŒ‡çº¹ |

**ç»“è®º**ï¼šBanner åªèƒ½å½“çº¿ç´¢ï¼Œå¿…é¡»äº¤å‰éªŒè¯ï¼

---

## äºŒã€å¸¸è§æœåŠ¡çš„æšä¸¾æŠ€å·§

### 2.1 HTTP/HTTPS æœåŠ¡

#### æ–¹æ³• 1ï¼šcurl æŸ¥çœ‹å“åº”å¤´
```bash
# Windows PowerShell
curl.exe -I http://192.168.1.100

# Linux/macOS
curl -I http://192.168.1.100
```

**å…³é”®å­—æ®µ**ï¼š
- `Server: Apache/2.4.41 (Ubuntu)`ï¼ˆæœåŠ¡å™¨ç±»å‹ä¸ç‰ˆæœ¬ï¼‰
- `X-Powered-By: PHP/7.4.3`ï¼ˆåç«¯è¯­è¨€ï¼‰
- `Set-Cookie: PHPSESSID=...`ï¼ˆä¼šè¯ç®¡ç†æ–¹å¼ï¼‰

#### æ–¹æ³• 2ï¼šæµè§ˆå™¨å¼€å‘è€…å·¥å…·
```
1. æ‰“å¼€ Chrome/Firefox
2. æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·
3. è®¿é—® http://192.168.1.100
4. æŸ¥çœ‹ Network æ ‡ç­¾ â†’ Headers
```

#### æ–¹æ³• 3ï¼šNmap NSE è„šæœ¬
```bash
nmap -p 80 --script http-headers 192.168.1.100
nmap -p 80 --script http-title 192.168.1.100
nmap -p 80 --script http-methods 192.168.1.100
```

---

### 2.2 SSH æœåŠ¡

#### æ–¹æ³• 1ï¼šTelnet/Netcat è·å– Banner
```bash
# Windows
telnet 192.168.1.100 22

# Linux/macOS
nc 192.168.1.100 22
```

**é¢„æœŸè¾“å‡º**ï¼š
```
SSH-2.0-OpenSSH_8.9p1 Ubuntu-3ubuntu0.1
```

**è§£è¯»**ï¼š
- `SSH-2.0`ï¼šåè®®ç‰ˆæœ¬
- `OpenSSH_8.9p1`ï¼šæœåŠ¡è½¯ä»¶ä¸ç‰ˆæœ¬
- `Ubuntu-3ubuntu0.1`ï¼šæ“ä½œç³»ç»Ÿä¸è¡¥ä¸çº§åˆ«

#### æ–¹æ³• 2ï¼šssh å‘½ä»¤è¯¦ç»†æ¨¡å¼
```bash
ssh -vvv 192.168.1.100 2>&1 | grep "remote software version"
```

---

### 2.3 MySQL/MariaDB

#### æ–¹æ³• 1ï¼šNmap æ¢æµ‹
```bash
nmap -p 3306 --script mysql-info 192.168.1.100
```

**é¢„æœŸè¾“å‡º**ï¼š
```
3306/tcp open  mysql
| mysql-info:
|   Protocol: 10
|   Version: 5.7.42-0ubuntu0.18.04.1
|   Thread ID: 123
|   Capabilities flags: 65535
|   Some Capabilities: SupportsTransactions, LongColumnFlag, Support41Auth
|   Status: Autocommit
|   Salt: xxx
```

#### æ–¹æ³• 2ï¼šMySQL å®¢æˆ·ç«¯è¿æ¥
```bash
mysql -h 192.168.1.100 -u root -p
```

**å¦‚æœå…è®¸åŒ¿åç™»å½•**ï¼ˆæä¸å®‰å…¨ï¼‰ï¼š
```bash
mysql -h 192.168.1.100
```

---

### 2.4 RDPï¼ˆè¿œç¨‹æ¡Œé¢ï¼‰

#### æ–¹æ³• 1ï¼šNmap æ¢æµ‹
```bash
nmap -p 3389 --script rdp-ntlm-info 192.168.1.100
```

**é¢„æœŸè¾“å‡º**ï¼š
```
3389/tcp open  ms-wbt-server
| rdp-ntlm-info:
|   Target_Name: WIN-SERVER
|   NetBIOS_Domain_Name: WORKGROUP
|   DNS_Domain_Name: WIN-SERVER
|   DNS_Computer_Name: WIN-SERVER
|   Product_Version: 10.0.17763
```

#### æ–¹æ³• 2ï¼šrdesktop/mstsc è¿æ¥æµ‹è¯•
```bash
# Linux
rdesktop -u test 192.168.1.100

# Windows
mstsc /v:192.168.1.100
```

---

### 2.5 SMBï¼ˆæ–‡ä»¶å…±äº«ï¼‰

#### æ–¹æ³• 1ï¼šNmap æ¢æµ‹
```bash
nmap -p 445 --script smb-os-discovery 192.168.1.100
```

**é¢„æœŸè¾“å‡º**ï¼š
```
445/tcp open  microsoft-ds
| smb-os-discovery:
|   OS: Windows Server 2019 Standard 17763
|   Computer name: WIN-SERVER
|   NetBIOS computer name: WIN-SERVER\x00
|   Workgroup: WORKGROUP\x00
```

#### æ–¹æ³• 2ï¼šsmbclient æšä¸¾å…±äº«
```bash
smbclient -L 192.168.1.100 -N
```

---

## ä¸‰ã€è‡ªåŠ¨åŒ–è„šæœ¬ï¼šè§£æ Nmap ç»“æœ

### 3.1 Python è„šæœ¬è§£æ Nmap XML

**ç›®æ ‡**ï¼šå°† Nmap XML è¾“å‡ºè½¬æ¢ä¸º CSV è¡¨æ ¼ã€‚

**æ­¥éª¤ 1**ï¼šç”¨ Nmap æ‰«æå¹¶è¾“å‡º XML
```bash
nmap -sV -oX scan.xml 192.168.1.100
```

**æ­¥éª¤ 2**ï¼šPython è„šæœ¬è§£æ
```python
import xml.etree.ElementTree as ET
import csv

# è§£æ XML
tree = ET.parse("scan.xml")
root = tree.getroot()

# æå–ç»“æœ
results = []
for host in root.findall("host"):
    ip = host.find("address").get("addr")
    for port in host.find("ports").findall("port"):
        portid = port.get("portid")
        state = port.find("state").get("state")
        service = port.find("service")
        service_name = service.get("name", "unknown") if service is not None else "unknown"
        version = service.get("product", "") if service is not None else ""
        results.append([ip, portid, state, service_name, version])

# å†™å…¥ CSV
with open("scan_results.csv", "w", newline="", encoding="utf-8") as f:
    writer = csv.writer(f)
    writer.writerow(["IP", "Port", "State", "Service", "Version"])
    writer.writerows(results)

print(f"âœ… å·²å¯¼å‡º {len(results)} æ¡ç»“æœåˆ° scan_results.csv")
```

---

### 3.2 PowerShell è„šæœ¬è§£æ Nmap æ–‡æœ¬è¾“å‡º

**ç›®æ ‡**ï¼šä» `day019_scan.txt` æå–ç«¯å£/æœåŠ¡/ç‰ˆæœ¬ã€‚

```powershell
$results = @()

Get-Content .\day019_scan.txt | ForEach-Object {
    if ($_ -match "(\d+)/tcp\s+(\w+)\s+(\S+)\s+(.*)") {
        $results += [PSCustomObject]@{
            Port = $matches[1]
            State = $matches[2]
            Service = $matches[3]
            Version = $matches[4]
        }
    }
}

$results | Export-Csv -Path .\scan_summary.csv -NoTypeInformation
Write-Output "âœ… å·²å¯¼å‡º $($results.Count) æ¡ç»“æœ"
```

---

## å››ã€å®æˆ˜ä»»åŠ¡

### ä»»åŠ¡ 1ï¼šæšä¸¾æœ¬æœºå¼€æ”¾çš„ Web æœåŠ¡

**åœºæ™¯**ï¼šæœ¬æœºè¿è¡Œäº†ä¸€ä¸ª Web æœåŠ¡ï¼ˆå¦‚ IIS/Apache/Nginxï¼‰ï¼Œéœ€è¦ç¡®è®¤ç‰ˆæœ¬ã€‚

**æ­¥éª¤ 1**ï¼šç¡®è®¤ Web æœåŠ¡æ­£åœ¨è¿è¡Œ
```bash
nmap -p 80,443,8080 127.0.0.1
```

**æ­¥éª¤ 2**ï¼šè·å– HTTP å“åº”å¤´
```bash
curl.exe -I http://127.0.0.1
```

**æ­¥éª¤ 3**ï¼šè®°å½•å…³é”®ä¿¡æ¯
- Server å­—æ®µï¼š
- X-Powered-By å­—æ®µï¼š
- å…¶ä»–ç‰¹å¾å­—æ®µï¼š

---

### ä»»åŠ¡ 2ï¼šæšä¸¾è™šæ‹Ÿæœºçš„ SSH æœåŠ¡

**åœºæ™¯**ï¼šæœ‰ä¸€å° Linux è™šæ‹Ÿæœºï¼Œéœ€è¦ç¡®è®¤ SSH ç‰ˆæœ¬ã€‚

**æ­¥éª¤ 1**ï¼šè·å– SSH Banner
```bash
nc 192.168.1.100 22
# æˆ–
telnet 192.168.1.100 22
```

**æ­¥éª¤ 2**ï¼šç”¨ Nmap éªŒè¯
```bash
nmap -p 22 -sV 192.168.1.100
```

**æ­¥éª¤ 3**ï¼šå¯¹æ¯”ç»“æœ
- Netcat Bannerï¼š
- Nmap æ¢æµ‹ç»“æœï¼š
- æ˜¯å¦ä¸€è‡´ï¼š

---

### ä»»åŠ¡ 3ï¼šæ‰¹é‡æšä¸¾å¤šä¸ªä¸»æœº

**åœºæ™¯**ï¼šæœ‰ 3 å°ä¸»æœºï¼ˆ192.168.1.100-102ï¼‰ï¼Œæ‰¹é‡æšä¸¾ã€‚

**æ­¥éª¤ 1**ï¼šæ‰¹é‡æ‰«æ
```bash
nmap -sV -oX multi_scan.xml 192.168.1.100-102
```

**æ­¥éª¤ 2**ï¼šç”¨ Python è„šæœ¬è§£æï¼ˆå‚è€ƒ 3.1ï¼‰

**æ­¥éª¤ 3**ï¼šæ•´ç†æˆè¡¨æ ¼
| IP | Port | Service | Version |
|----|------|---------|---------|
| ... | ... | ... | ... |

---

## äº”ã€å·©å›ºç»ƒä¹ 

### ç»ƒä¹  1ï¼šè§£é‡Šä¸ºä»€ä¹ˆéœ€è¦äº¤å‰éªŒè¯

**å‚è€ƒç­”æ¡ˆ**ï¼š
- Banner å¯ä»¥è¢«ä¼ªè£…ï¼ˆç®¡ç†å‘˜æ‰‹åŠ¨ä¿®æ”¹ï¼‰
- åå‘ä»£ç†ä¼šæ”¹å˜å“åº”å¤´
- WAF/CDN ä¼šå±è”½çœŸå®æŒ‡çº¹
- å› æ­¤éœ€è¦ç”¨å¤šç§æ–¹æ³•ï¼ˆNmap/curl/æ‰‹åŠ¨è¿æ¥ï¼‰äº¤å‰éªŒè¯

---

### ç»ƒä¹  2ï¼šè¯†åˆ«ä»¥ä¸‹ HTTP å“åº”å¤´çš„å…³é”®ä¿¡æ¯

```
HTTP/1.1 200 OK
Server: Apache/2.4.41 (Ubuntu)
X-Powered-By: PHP/7.4.3
Set-Cookie: PHPSESSID=abc123
```

**å‚è€ƒç­”æ¡ˆ**ï¼š
- Web æœåŠ¡å™¨ï¼šApache 2.4.41
- æ“ä½œç³»ç»Ÿï¼šUbuntu
- åç«¯è¯­è¨€ï¼šPHP 7.4.3
- ä¼šè¯ç®¡ç†ï¼šä½¿ç”¨ Cookieï¼ˆPHPSESSIDï¼‰

---

### ç»ƒä¹  3ï¼šè®¾è®¡ä¸€å¥—æœåŠ¡æšä¸¾æµç¨‹

**å‚è€ƒç­”æ¡ˆ**ï¼š
1. ç«¯å£æ‰«æï¼š`nmap -sV -oX scan.xml target`
2. HTTP æšä¸¾ï¼š`curl -I http://target`
3. SSH æšä¸¾ï¼š`nc target 22`
4. æ•°æ®åº“æšä¸¾ï¼š`nmap --script mysql-info target`
5. äº¤å‰éªŒè¯ï¼šå¯¹æ¯” Nmap å’Œæ‰‹åŠ¨ç»“æœ
6. è¾“å‡ºæŠ¥å‘Šï¼šæ•´ç†æˆ CSV/JSON

---

## å…­ã€è¯„ä¼°æ ‡å‡†

- âœ… èƒ½ç”¨ curl è·å– HTTP å“åº”å¤´
- âœ… èƒ½ç”¨ nc/telnet è·å– SSH Banner
- âœ… èƒ½ç”¨ Nmap NSE è„šæœ¬æšä¸¾æœåŠ¡
- âœ… èƒ½ç”¨ Python/PowerShell è„šæœ¬è§£æ Nmap è¾“å‡º
- âœ… èƒ½è¾“å‡ºä¸€ä»½ç»“æ„åŒ–çš„æœåŠ¡æ¸…å•ï¼ˆCSVï¼‰

---

## ä¸ƒã€å‚è€ƒèµ„æ–™

- [Nmap NSE è„šæœ¬åº“](https://nmap.org/nsedoc/)
- [HTTP å“åº”å¤´å­—æ®µ](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers)
- [SSH Protocol Documentation](https://www.openssh.com/specs.html)

---

## å…«ã€å­¦ä¹ æˆæœè¾¾æˆæƒ…å†µï¼ˆç”±å­¦ä¹ è€…å¡«å†™ï¼‰

### æˆªå›¾ä¸è¯æ®

- [ ] curl å“åº”å¤´æˆªå›¾
- [ ] SSH Banner æˆªå›¾
- [ ] Nmap æšä¸¾ç»“æœæˆªå›¾
- [ ] ç”Ÿæˆçš„ CSV æ–‡ä»¶

### å…³é”®å‘ç°

**HTTP æœåŠ¡**ï¼š
- Serverï¼š
- ç‰ˆæœ¬ï¼š

**SSH æœåŠ¡**ï¼š
- Bannerï¼š
- ç‰ˆæœ¬ï¼š

### ç»“è®ºä¸åæ€

- **æˆ‘å‘ç°çš„æœåŠ¡ç‰ˆæœ¬**ï¼š
- **æˆ‘è¯†åˆ«çš„æ½œåœ¨æ¼æ´**ï¼š
- **æˆ‘ä¸‹ä¸€æ­¥è¦åšçš„éªŒè¯**ï¼š

---

**æ­å–œï¼ä½ å·²æŒæ¡æœåŠ¡æšä¸¾ä¸æŒ‡çº¹è¯†åˆ«çš„æ ¸å¿ƒæŠ€èƒ½ã€‚æ˜å¤©æˆ‘ä»¬å°†è¿›è¡Œç¬¬ 3 å‘¨ç»¼åˆå®éªŒï¼Œæ•´åˆæœ¬å‘¨æ‰€å­¦çŸ¥è¯†ï¼** ğŸ‰
