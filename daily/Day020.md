---
title: Day020：SQL 注入 - 综合实验室
tags:
  - 网络安全
  - SQL注入
  - 综合练习
categories:
  - 90天安全突击
stage: 筑基
abbrlink: d020
date: 2026-02-11
updated: 2026-01-28
---

# Day020：SQL 注入 - 综合实验室

## 基本信息

| 项目 | 内容 |
|------|------|
| **所属阶段** | 筑基（第一阶段） |
| **所属周次** | Week 3：SQL 注入入门 |
| **今日主题** | 综合实战：多场景练习 |
| **预计时间** | 3 小时 |
| **难度等级** | 进阶 |

---

## 今日痛点场景

> **场景**：这周你学了注入原理、手工注入、SQLMap、盲注、绕过……但都是零散的知识点。
>
> **问题**：遇到真实场景，能把这些技术串起来用吗？
>
> **今天的任务**：在多个靶场中综合练习，巩固本周所学。

---

## 今日目标

- [ ] 完成 DVWA 全部难度的 SQL 注入
- [ ] 在 SQLi-Labs 完成至少 5 关
- [ ] 独立完成从检测到数据提取的完整流程
- [ ] 总结自己的注入方法论

**闯关条件**：完成 DVWA 三个级别的 SQL 注入，并记录每个级别的 payload。

---

## 实战任务（先动手！）

### 实验 1：DVWA Low 级别（30 分钟）

**目标**：获取 users 表的所有用户名和密码哈希。

**已知信息**：
- 输入框接收 ID 参数
- 存在字符型注入

**步骤**：
1. 确认注入：`1'`
2. 判断列数：`1' ORDER BY 2 --`
3. UNION 注入：`1' UNION SELECT user,password FROM users --`

**记录你的 payload**：
```
_______________________________
```

---

### 实验 2：DVWA Medium 级别（45 分钟）

**目标**：同上。

**变化**：
- 使用下拉菜单选择 ID
- 后端对输入做了转义

**突破思路**：
1. 用 Burp Suite 拦截请求
2. 修改 POST 参数中的 id 值
3. 这是数字型注入（没有引号包裹）

**步骤**：
1. Burp 拦截，修改 `id=1` 为 `id=1 OR 1=1`
2. 判断列数：`id=1 ORDER BY 2`
3. UNION 注入：`id=1 UNION SELECT user,password FROM users`

**记录你的 payload**：
```
_______________________________
```

---

### 实验 3：DVWA High 级别（45 分钟）

**目标**：同上。

**变化**：
- ID 存储在 Session 中
- 需要在新窗口输入

**突破思路**：
1. 点击链接打开新窗口
2. 在新窗口的输入框中测试注入
3. 后端仍使用 LIMIT 1 限制返回

**步骤**：
1. 输入 `1' OR '1'='1' #` 测试
2. 使用 `#` 注释掉 LIMIT 1
3. UNION 注入：`1' UNION SELECT user,password FROM users #`

**记录你的 payload**：
```
_______________________________
```

---

### 实验 4：SQLi-Labs 挑战（60 分钟）

**SQLi-Labs** 是专门练习 SQL 注入的靶场，包含几十个不同类型的关卡。

**安装**：
```bash
docker run -d -p 8080:80 acgpiano/sqli-labs
```

访问 `http://localhost:8080`

**完成以下关卡**：

| 关卡 | 类型 | 提示 |
|------|------|------|
| Less-1 | 字符型 | 基础 UNION 注入 |
| Less-2 | 数字型 | 不需要闭合引号 |
| Less-5 | 布尔盲注 | 页面只显示正确/错误 |
| Less-9 | 时间盲注 | SLEEP 函数 |
| Less-11 | POST 注入 | 登录框 |

**记录每关的 payload**：
```
Less-1: ______________________
Less-2: ______________________
Less-5: ______________________
Less-9: ______________________
Less-11: _____________________
```

---

## 今日闯关检查

| 检查项 | 分数 |
|--------|------|
| DVWA Low 完成 | 15 分 |
| DVWA Medium 完成 | 20 分 |
| DVWA High 完成 | 25 分 |
| SQLi-Labs Less-1 完成 | 8 分 |
| SQLi-Labs Less-2 完成 | 8 分 |
| SQLi-Labs Less-5 完成 | 8 分 |
| SQLi-Labs Less-9 完成 | 8 分 |
| SQLi-Labs Less-11 完成 | 8 分 |

**60 分及格，80 分优秀，100 分满分**

你的得分：____

---

## SQL 注入方法论总结

通过本周学习，形成你自己的方法论：

### 第一步：检测注入

```
1. 输入单引号 ' 观察响应
2. 输入双引号 " 观察响应
3. 输入 1 AND 1=1 和 1 AND 1=2 对比
4. 观察报错信息
```

### 第二步：判断类型

```
- 数字型：id=1 AND 1=1
- 字符型：id=1' AND '1'='1
- 搜索型：keyword=' AND '%'='
```

### 第三步：确定利用方式

```
有回显 → UNION 注入
无回显 + 有差异 → 布尔盲注
无回显 + 无差异 → 时间盲注
有报错 → 报错注入
```

### 第四步：提取数据

```
1. 获取数据库版本：version()
2. 获取当前数据库：database()
3. 获取表名：information_schema.tables
4. 获取列名：information_schema.columns
5. 获取数据：SELECT 列 FROM 表
```

### 第五步：处理绕过

```
1. 尝试大小写混用
2. 尝试注释绕过
3. 尝试编码绕过
4. 尝试 SQLMap tamper
```

---

## 底层补课

### 不同数据库的差异

| 功能 | MySQL | PostgreSQL | Oracle | SQL Server |
|------|-------|------------|--------|------------|
| 注释 | `-- ` `#` | `-- ` | `-- ` | `-- ` |
| 字符串连接 | `CONCAT()` | `||` | `||` | `+` |
| 版本 | `version()` | `version()` | `SELECT * FROM v$version` | `@@version` |
| 当前库 | `database()` | `current_database()` | - | `db_name()` |
| 限制行数 | `LIMIT` | `LIMIT` | `ROWNUM` | `TOP` |

### SQL 注入防御

| 防御措施 | 说明 | 效果 |
|----------|------|------|
| 参数化查询 | 预编译 SQL | 最有效 |
| 输入验证 | 白名单验证 | 有效 |
| 转义特殊字符 | addslashes 等 | 部分有效 |
| WAF | Web 应用防火墙 | 可能被绕过 |
| 最小权限 | 数据库用户权限最小化 | 降低危害 |

---

## 避坑指南

| 坑点 | 症状 | 解决方案 |
|------|------|----------|
| 盲目使用 payload | 不成功不知道为什么 | 先理解目标的 SQL 语句结构 |
| 只会用工具 | 手工不会，工具失败就束手无策 | 打好手工基础 |
| 不记录 payload | 下次遇到同样情况忘了怎么做 | 建立自己的 payload 库 |

---

## 知识卡片速查

### SQL 注入检测速查

```sql
-- 基础检测
'
''
`
)
))
"
""
```

### 闭合方式速查

| 后端 SQL | 闭合方式 |
|----------|----------|
| `WHERE id='$id'` | `1' payload --` |
| `WHERE id="$id"` | `1" payload --` |
| `WHERE id=$id` | `1 payload` |
| `WHERE id=('$id')` | `1') payload --` |
| `WHERE id=("$id")` | `1") payload --` |

---

## 常见问题

**Q1：遇到不熟悉的场景怎么办？**

A1：
1. 先观察正常请求的响应
2. 逐步添加特殊字符，观察变化
3. 根据报错信息判断 SQL 结构
4. 不行就用 SQLMap 试试

**Q2：真实渗透中 SQL 注入常见吗？**

A2：虽然很多现代框架默认使用参数化查询，但 SQL 注入仍然常见于：
- 老旧系统
- 手写 SQL 的项目
- 拼接 SQL 的动态查询
- 存储过程中的注入

**Q3：学完这周算入门了吗？**

A3：入门了！你已经掌握了：
- 注入检测
- 手工注入
- 工具使用
- 盲注技术
- 绕过方法

后续还可以深入学习：二次注入、堆叠查询、Out-of-Band 技术等。

---

## 明日预告

**Day 021：SQL 注入 - Week 3 周末闯关**

明天你将：
- 完成综合考核
- 检验本周学习成果
- 输出学习总结

---

## 学习记录

| 项目 | 内容 |
|------|------|
| 实际学习日期 | |
| DVWA 完成度 | /3 |
| SQLi-Labs 完成度 | /5 |
| 今日收获 | |

---

> **导师点评**：
>
> 今天是综合练习日，把这周学的都用上了。
>
> 做靶场不是目的，**形成自己的方法论**才是目的。
>
> 遇到注入点，你脑子里应该有个流程：检测 → 判断类型 → 选择利用方式 → 提取数据 → 处理绕过。
>
> 这个流程内化了，你就不再是"脚本小子"，而是真正的渗透测试人员。
>
> 明天是周末闯关，好好准备！

```bash
echo "Day 020 Complete! 综合实战 GET！"
```
