---
title: Day061：内网渗透基础 - 概念与环境搭建
tags:
  - 网络安全
  - 渗透测试
  - 内网渗透
categories:
  - 90天安全突击
stage: 实战演练
abbrlink: 1128e
date: 2026-01-28
updated: 2026-01-28
---

# Day061：内网渗透基础 - 概念与环境搭建

## 📋 基本信息

| 项目 | 内容 |
|------|------|
| **所属阶段** | 🏆 实战演练（第三阶段） |
| **所属周次** | Week 11-12：内网渗透基础 |
| **今日主题** | 内网基础概念与环境搭建 |
| **预计时间** | 3-4 小时 |
| **难度等级** | ⭐⭐⭐ 中级 |

---

## 🔥 今日痛点场景

> **场景**：你通过 SQL 注入拿到了网站服务器的 Shell（WebShell），觉得自己很牛 X。结果发现这只是一台边缘服务器，真正有价值的数据库在内网深处。
>
> **问题**：你面对的是一个完全陌生的网络环境，里面有成百上千台机器，还有传说中的"域控制器"。你该往哪走？
>
> **今天的任务**：搞清楚内网长什么样，并在本地搭建一个微型内网靶场。

---

## 🎯 今日目标

完成今天的学习后，你应该能够：

- [ ] 理解内网核心概念（工作组 vs 域、DMZ）
- [ ] 搭建包含域控的内网实验环境
- [ ] 理解内网渗透的基本流程
- [ ] 进行最基础的本机信息收集

**闯关条件**：成功搭建 AD 域环境，并用一台 Win10 加入该域。

---

## ⚔️ 实战任务（先动手！）

### 任务 1：理解内网拓扑（15 分钟）

**阅读并理解以下拓扑图**：

```
                    Internet
                       │
                       ▼
┌──────────────────────┼──────────────────────┐
│  DMZ 区 (对外服务)   │   防火墙 (Firewall)  │
│                      │                      │
│   [Web 服务器] ◄─────┘                      │
│   192.168.1.10                              │
│   (双网卡: 10.0.0.10)                       │
└──────────┬──────────────────────────────────┘
           │
           ▼
┌──────────┼──────────────────────────────────┐
│  办公区 / 核心数据区 (内网)                 │
│                                             │
│   [域控制器 DC]      [文件服务器]           │
│   10.0.0.2           10.0.0.3               │
│                                             │
│   [员工 PC1]         [员工 PC2]             │
│   10.0.0.101         10.0.0.102             │
└─────────────────────────────────────────────┘
```

**思考**：
- 如果你攻破了 Web 服务器，你能直接访问员工 PC 吗？（通常不能，需要跳板）
- 谁是内网的老大？（域控制器）

---

### 任务 2：搭建 AD 域环境（120 分钟）

这是内网渗透的基石，必须亲手搭一次！

**准备虚拟机**：
1. **Windows Server 2019/2016** (作为域控 DC)
2. **Windows 10** (作为域内主机)

**操作步骤**：

1. **配置 DC IP**：
   - 将 Win Server IP 设为固定 IP，例如 `10.0.0.2`
   - DNS 指向自己 `127.0.0.1`

2. **安装 AD 域服务**：
   - 服务器管理器 -> 添加角色和功能 -> Active Directory 域服务
   - 安装完成后，点击旗帜图标 -> "将此服务器提升为域控制器"
   - 选择 "添加新林" -> 根域名填 `hack.local`
   - 一路默认，设置还原密码，安装并重启。

3. **配置 Win10 加入域**：
   - 将 Win10 DNS 设为 DC 的 IP (`10.0.0.2`)
   - 确保能 ping 通 `hack.local`
   - 系统属性 -> 更改设置 -> 更改 -> 隶属于 "域" -> 输入 `hack.local`
   - 输入域管理员账号密码（Administrator / 你的密码）
   - 欢迎加入域！重启。

**预期结果**：Win10 登录界面出现 "登录到: HACK" 选项。

---

### 任务 3：本机信息收集初体验（30 分钟）

假设你已经拿到了 Win10 的 Shell，现在要看看自己在哪里。

**在 Win10 的 CMD 中执行**：

```cmd
:: 1. 我是谁？
whoami
:: 如果显示 hack\username，说明是域用户

:: 2. 我在哪？(IP信息)
ipconfig /all
:: 重点看 DNS 后缀和 DNS 服务器(通常是 DC)

:: 3. 机器环境？
systeminfo
:: 重点看 "域" 一栏

:: 4. 域内还有谁？(需要域用户权限)
net view
net user /domain
net group "domain admins" /domain
```

**预期结果**：记录下你收集到的信息（域名、DC IP、域管账号）。

---

## ✅ 今日闯关检查

| 检查项 | 状态 |
|--------|------|
| 域控制器 (DC) 搭建成功 | ⬜ |
| Win10 成功加入域 | ⬜ |
| 在 Win10 上能用域账号登录 | ⬜ |
| `ipconfig /all` 显示 DNS 为 DC IP | ⬜ |
| `net user /domain` 能列出域用户 | ⬜ |

**全部打勾 = Day 061 通关！**

---

## 📖 底层补课（做完实验再看）

### 1. 工作组 (Workgroup) vs 域 (Domain)

- **工作组**：大家地位平等，各管各的。你要访问我的共享，得有我的账号。适合家里几台电脑。
- **域**：有一个"老大"（域控 DC）。老大集中管理所有账号密码。只要老大验证通过，你就能访问域内所有授权资源。企业里都用这个。

### 2. 为什么域控是终极目标？

因为域控（Domain Controller）存储了域内所有用户的哈希（KRBTGT、域管等）。
**拿下了域控 = 拿下了整个内网。**

### 3. DMZ (隔离区)

放在公网和内网之间的缓冲区。Web 服务器通常放在这里。
如果 DMZ 被攻破，黑客还需要通过防火墙才能进入核心内网。

---

## ⚠️ 避坑指南

| 坑点 | 症状 | 解决方案 |
|------|------|----------|
| 无法加入域 | 提示"找不到域控制器" | 90%是 DNS 没配对。Win10 的 DNS 必须填 DC 的 IP！ |
| 虚拟机网络不通 | ping 不通 | 确保两台机都在同一个网络模式（如都用 NAT 或都用 Host-Only） |
| 密码复杂度报错 | 创建用户失败 | Windows Server 默认开启强密码策略，密码要包含大小写数字符号 |

---

## 💡 知识卡片速查

### 常用内网命令

| 命令 | 作用 | 备注 |
|------|------|------|
| `ipconfig /all` | 查看网络配置 | 找 DNS（定位 DC） |
| `net user /domain` | 查看域用户 | 需要域权限 |
| `net group "domain admins" /domain` | 查看域管理员 | 找高价值目标 |
| `net time /domain` | 查看时间服务器 | 通常也是 DC |
| `nltest /dclist:hack.local` | 列出域控 | 简单粗暴 |

---

## ❓ 常见问题

**Q：家里电脑配置低，跑不动两个虚拟机怎么办？**
A：
1. 内存不够：Server 核心版（无 GUI）只要 512MB 内存，但配置难。
2. 只有一台电脑：可以只装 DC，用宿主机连它（不推荐，不安全）。
3. 云服务器：买按量付费的云主机搭内网（要钱）。
**推荐：加内存条，这是学安全最值的投资。**

---

## 🚀 明日预告

**Day 062：内网渗透 - 代理隧道入门（frp 实战）**

既然环境搭好了，明天我们就来学习：
- 怎么让外网的攻击机"钻"进内网？
- 什么是正向代理和反向代理？
- 手把手教你配置 frp 隧道。

---

## 📊 学习记录（学习者填写）

| 项目 | 内容 |
|------|------|
| 实际学习日期 | ____年__月__日 |
| 实际用时 | ____ 小时 |
| 遇到的问题 | |
| 解决方法 | |
| 域控 IP | |
| 域名 | |

---

> 💬 **导师点评**：
>
> 别觉得搭环境枯燥。**不懂网络架构的渗透测试，就是瞎猫碰死耗子。**
>
> 以后你在实战中遇到的 99% 都是域环境。今天亲手搭出来的域，就是你明天攻城略地的战场。
